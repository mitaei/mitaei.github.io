<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Azure RedHat OpenShift for IBM Product Master">
  <meta name="author" content="joseph.tingiris@mastechinfotrellis.com">
  <link rel="canonical" href="https://mitaei.github.io/atc/ipm-on-azure/">
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>IPM on Azure</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="docs/css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Home";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/atc/ipm-on-azure/";
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> IPM on Azure</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href=".">Home</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#azure-red-hat-openshift-aro">Azure Red Hat OpenShift (ARO)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#microsoft-azure">Microsoft Azure</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#red-hat-openshift-container-platform-ocp">Red Hat OpenShift Container Platform (OCP)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ibm-product-master-ipm">IBM Product Master (IPM)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-1-setup-azure-tenant">Step 1 - Setup Azure Tenant</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-11-create-a-new-microsoft-account">Step 1.1 - Create a new Microsoft Account</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-12-create-the-first-global-administrator">Step 1.2 - Create the first Global Administrator</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-13-verify-microsoft-365-admin-center-access">Step 1.3 - Verify Microsoft 365 Admin Center Access</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-14-verify-azure-active-directory-license">Step 1.4 - Verify Azure Active Directory License</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-2-setup-azure-subscription">Step 2 - Setup Azure Subscription</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-21-purchase-new-azure-subscription">Step 2.1 - Purchase New Azure Subscription</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-3-setup-operating-system-required-tools">Step 3 - Setup Operating System &amp; Required Tools</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-31-verify-operating-system">Step 3.1 - Verify Operating System</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-32-verify-bash">Step 3.2 - Verify bash</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-33-verify-gnu-awk">Step 3.3 - Verify GNU awk</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-34-verify-gnu-coreutils">Step 3.4 - Verify GNU coreutils</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-35-verify-gnu-grep">Step 3.5 - Verify GNU grep</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-36-verify-google-chrome-or-firefix">Step 3.6 - Verify Google Chrome or Firefix</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-37-verify-openssl">Step 3.7 - Verify OpenSSL</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-4-setup-required-aro-environment-variables">Step 4 - Setup Required ARO Environment Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-41-export-required-aro-environment-variables">Step 4.1 - Export Required ARO Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-42-verify-required-aro-environment-variables">Step 4.2 - Verify Required ARO Environment Variables</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-5-obtain-pull-secrets">Step 5 - Obtain Pull Secrets</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-51-obtain-red-hat-pull-secret">Step 5.1 - Obtain Red Hat Pull Secret</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-52-verify-red-hat-pull-secret">Step 5.2 - Verify Red Hat Pull Secret</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-6-setup-azure-cli">Step 6 - Setup Azure CLI</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-61-install-azure-cli">Step 6.1 - Install Azure CLI</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-62-show-default-subscription">Step 6.2 - Show Default Subscription</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-63-login-as-the-subscription-owner">Step 6.3 - Login as the Subscription Owner</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-7-setup-additional-subscription-owners">Step 7 - Setup Additional Subscription Owners</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-71-verify-subscription-owners">Step 7.1 - Verify Subscription Owners</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-8-verify-azure-tenant">Step 8 - Verify Azure Tenant</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-9-verify-azure-subscription">Step 9 - Verify Azure Subscription</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-91-verify-subscription-names">Step 9.1 - Verify Subscription Names</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-92-verify-subscription-location">Step 9.2 - Verify Subscription Location</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-93-verify-subscription-limits">Step 9.3 - Verify Subscription Limits</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-94-verify-subscription-quotas">Step 9.4 - Verify Subscription Quotas</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-95-verify-subscription-quota-for-standard-dv2-family-vcpus">Step 9.5 - Verify Subscription Quota for Standard Dv2 Family vCPUs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-96-verify-subscription-quota-for-standard-dsv3-family-vcpus">Step 9.6 - Verify Subscription Quota for Standard DSv3 Family vCPUs</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-10-setup-openshift-administrators">Step 10 - Setup OpenShift Administrators</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-101-verify-openshift-administrator-accounts">Step 10.1 - Verify OpenShift Administrator Accounts</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-102-verify-openshift-administrator-subscription-roles">Step 10.2 - Verify OpenShift Administrator Subscription Roles</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-11-setup-azure-resource-providers">Step 11 - Setup Azure Resource Providers</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-111-verify-provider-microsoftredhatopenshift">Step 11.1 - Verify Provider Microsoft.RedHatOpenShift</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-112-verify-provider-microsoftcompute">Step 11.2 - Verify Provider Microsoft.Compute</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-113-verify-provider-microsoftstorage">Step 11.3 - Verify Provider Microsoft.Storage</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-12-setup-resource-group">Step 12 - Setup Resource Group</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-121-verify-resource-group">Step 12.1 - Verify Resource Group</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-13-setup-virtual-network">Step 13 - Setup Virtual Network</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-131-verify-virtual-network">Step 13.1 - Verify Virtual Network</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-14-setup-azure-red-hat-openshift-subnets">Step 14 - Setup Azure Red Hat OpenShift Subnets</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-141-verify-master-subnet">Step 14.1 - Verify Master Subnet</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-142-verify-worker-subnet">Step 14.2 - Verify Worker Subnet</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-15-setup-additional-network-security-groups">Step 15 - Setup Additional Network Security Groups</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-151-verify-network-security-groups">Step 15.1 - Verify Network Security Groups</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-16-setup-additional-network-security-group-rules">Step 16 - Setup Additional Network Security Group Rules</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-161-verify-dmz-network-security-group-rules">Step 16.1 - Verify DMZ Network Security Group Rules</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-17-setup-additional-subnets">Step 17 - Setup Additional Subnets</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-171-verify-application-gateway-subnet">Step 17.1 - Verify Application Gateway Subnet</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-172-verify-database-subnet">Step 17.2 - Verify Database Subnet</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-173-verify-dmz-subnet">Step 17.3 - Verify DMZ Subnet</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-174-verify-trusted-subnet">Step 17.4 - Verify Trusted Subnet</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-18-setup-jump-server-virtual-machine">Step 18 - Setup Jump Server Virtual Machine</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-181-verify-jump-server-public-ip-address">Step 18.1 - Verify Jump Server Public IP Address</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-182-verify-jump-server-virtual-nic">Step 18.2 - Verify Jump Server Virtual NIC</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-183-verify-jump-server-availability-set">Step 18.3 - Verify Jump Server Availability Set</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-184-verify-jump-server-image-terms">Step 18.4 - Verify Jump Server Image Terms</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-185-verify-jump-server-virtual-machine">Step 18.5 - Verify Jump Server Virtual Machine</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-186-login-to-jump-server-virtual-machine">Step 18.6 - Login to Jump Server Virtual Machine</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-19-setup-vpn-gateway">Step 19 - Setup VPN Gateway</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-191-verify-vpn-gateway-subnet">Step 19.1 - Verify VPN Gateway Subnet</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-192-verify-vpn-gateway-public-ip-address">Step 19.2 - Verify VPN Gateway Public IP Address</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-193-verify-vpn-gateway">Step 19.3 - Verify VPN Gateway</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-20-setup-vpn-gateway-certificate-authentication">Step 20 - Setup VPN Gateway Certificate Authentication</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-201-verify-vpn-gateway-root-key">Step 20.1 - Verify VPN Gateway Root Key</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-202-verify-vpn-gateway-root-certificate">Step 20.2 - Verify VPN Gateway Root Certificate</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-203-verify-vpn-gateway-root-certificate-moduli">Step 20.3 - Verify VPN Gateway Root Certificate Moduli</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-204-verify-vpn-gateway-root-certificate-data">Step 20.4 - Verify VPN Gateway Root Certificate Data</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-21-setup-vpn-client-certificates">Step 21 - Setup VPN Client Certificates</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-211-export-vpn-client-aro-environment-variables">Step 21.1 - Export VPN Client ARO Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-212-verify-vpn-client-aro-environment-variables">Step 21.2 - Verify VPN Client ARO Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-213-verify-vpn-client-key">Step 21.3 - Verify VPN Client Key</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-214-verify-vpn-client-certificate-request">Step 21.4 - Verify VPN Client Certificate Request</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-215-verify-vpn-client-certificate-extensions">Step 21.5 - Verify VPN Client Certificate Extensions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-216-verify-vpn-client-certificate">Step 21.6 - Verify VPN Client Certificate</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-217-verify-vpn-client-certificate-moduli">Step 21.7 - Verify VPN Client Certificate Moduli</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-218-verify-vpn-client-pfx">Step 21.8 - Verify VPN Client PFX</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">IPM on Azure</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="azure-red-hat-openshift-for-ibm-product-master-draft">Azure Red Hat OpenShift for IBM Product Master [DRAFT]</h2>
<p>Sun 20 Sep 2020 11:24:22 PM EDT</p>
<h3 id="introduction">Introduction</h3>
<p>This document details the steps required to build Azure Red Hat OpenShift for IBM Product Master.</p>
<h4 id="azure-red-hat-openshift-aro">Azure Red Hat OpenShift (ARO)</h4>
<p>Azure Red Hat OpenShift is a fully managed offering of Red Hat OpenShift running in Microsoft Azure. This service is jointly managed and supported by both Microsoft and Red Hat.  To provide support, certain limitations apply.  For more details, see the Azure Red Hat OpenShift Service documentation.</p>
<h4 id="microsoft-azure">Microsoft Azure</h4>
<p>Microsoft Azure is a comprehensive cloud computing service managed by Microsoft. It provides software as a service (SaaS), platform as a service (PaaS), and infrastructure as a service (IaaS).</p>
<h4 id="red-hat-openshift-container-platform-ocp">Red Hat OpenShift Container Platform (OCP)</h4>
<p>Red Hat's OpenShift Container Platform is a hybrid cloud, enterprise Kubernetes application platform.  It is a platform as a service (Paas) built on Red Hat Enterprise Linux (RHEL), with Docker containers managed by Kubernetes.</p>
<h4 id="ibm-product-master-ipm">IBM Product Master (IPM)</h4>
<p>IBM Product Master provides trusted product information management (PIM) and collaborative master data management (MDM) capabilities. It creates an accurate and up-to-date repository of product and service information that can be used throughout organizations for strategic business initiatives</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://azure.microsoft.com/</li>
<li>https://www.openshift.com/</li>
<li>https://www.docker.com/</li>
<li>https://kubernetes.io/</li>
<li>https://docs.microsoft.com/en-us/azure/openshift/openshift-faq</li>
<li>https://docs.microsoft.com/en-us/azure/openshift/support-lifecycle</li>
<li>https://www.ibm.com/products/product-master</li>
</ul>
<h3 id="step-1-setup-azure-tenant">Step 1 - Setup Azure Tenant</h3>
<p>A tenant is Microsoft's representation of an organization. It's a dedicated instance of Azure Active Directory (AAD) that an organization or app developer receives when create a relationship with Microsoft, like signing up for Azure, Microsoft Intune, or Microsoft 365.</p>
<p>Before you can install Azure Red Hat OpenShift (ARO), Microsoft accounts must exist and have appropriate access to an AAD Tenant with an AAD Premium P1 License or better.</p>
<p>A Global Administrator must be involved in the project.</p>
<p>If you are the Global Administrator of an existing tenant, go to step 2.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-get-started-premium</li>
<li>https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-create-new-tenant</li>
</ul>
<h4 id="step-11-create-a-new-microsoft-account">Step 1.1 - Create a new Microsoft Account</h4>
<p>A Microsoft account represents a billing relationship.  The account consists of a user identity, one or more subscriptions, and an associated set of resources. The person who creates the account is the administrators for all subscriptions created in that account. That person is also the default Service Administrator for the subscription(s) and, for Microsoft 365, possesses the Global Administrator role.</p>
<p>The purpose of this step is to create a new Microsoft 365 (onmicrosoft.com) account, to establish a Global Administrator relationship for use with all Microsoft 365 services, including Azure.  An Azure Active Directory Premium P1 license is required for Azure Red Hat OpenShift (ARO).</p>
<p>Please note that <em>this step does not mandate a purchase of a Microsoft 365 Business Premium license</em>.   This is simply one way to create a new tenant and become a Global Administrator.  A license may be purchased now, or afterwards.</p>
<p>Go to the Microsoft 365 for Business store.</p>
<ul>
<li>https://www.microsoft.com/en-us/microsoft-365/business/compare-all-microsoft-365-business-products</li>
</ul>
<p>Proceed to purchase at least one (1) Microsoft 365 Business Premium license.  This will also include an Azure Active Directory (AAD) Premium P1 license, which is needed for Azure Red Hat OpenShift (ARO).</p>
<p>The Microsoft 365 Business Premium provides an AAD P1 license, and other 365 services.  If you do not wish to have all the 365 services, then a dedicated AAD Premium P1 (or better) may be purchased by a Billing or Global Administrator who has access to an existing tenant.</p>
<h4 id="step-12-create-the-first-global-administrator">Step 1.2 - Create the first Global Administrator</h4>
<p>The person who signed up for Microsoft online services automatically becomes the first Global Administrator.</p>
<p>Only global administrators can:</p>
<ul>
<li>Reset passwords for all users</li>
<li>Add and manage domains</li>
</ul>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/microsoft-365/admin/add-users/about-admin-roles?view=o365-worldwide</li>
</ul>
<h4 id="step-13-verify-microsoft-365-admin-center-access">Step 1.3 - Verify Microsoft 365 Admin Center Access</h4>
<p>The Microsoft 365 admin center is built for IT teams as a simplified way to manage your Microsoft 365 services. The admin center provides a tailored experience based on the unique needs of your role or organization, improves efficiency for everyday tasks, and provides actionable insights that help you make data-driven decisions to deliver a better experience for your users.</p>
<p>The Microsoft 365 admin center is the common entry point for all Microsoft 365 admins and can be accessed at</p>
<ul>
<li>https://admin.microsoft.com/</li>
</ul>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/microsoft-365/admin/admin-overview/about-the-admin-center?view=o365-worldwide</li>
</ul>
<h4 id="step-14-verify-azure-active-directory-license">Step 1.4 - Verify Azure Active Directory License</h4>
<p>To verify the license, go to the Azure Active Directory Overview:</p>
<ul>
<li>https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview</li>
</ul>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-whatis</li>
</ul>
<h3 id="step-2-setup-azure-subscription">Step 2 - Setup Azure Subscription</h3>
<p>An Azure subscription is a trust relationship with Azure Active Directory. A subscription trusts AAD to authenticate users, services, and devices.</p>
<p>Azure subscriptions help organize access to Azure resources. They also help control how resource usage is reported, billed, and paid for. Each subscription can have a different billing and payment method.  Every Azure service belongs to a subscription, and the subscription ID is required for these procedures.</p>
<p>There are multiple choices when configuring Azure subscriptions.  A tenant may have multiple Azure subscriptions that are paid via different payment methods.  That is out of scope for this document.</p>
<p>Here we will focus on a single tenant with a single subscription.  A Global Administrator should do the following steps, become the Subscription Owner, and then assign the appropriate subscription roles to the OpenShift Administrators and Service Principals.</p>
<h4 id="step-21-purchase-new-azure-subscription">Step 2.1 - Purchase New Azure Subscription</h4>
<p>The Microsoft account that purchases the Azure subscription will be the Subscription owner.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://azure.microsoft.com/</li>
</ul>
<h3 id="step-3-setup-operating-system-required-tools">Step 3 - Setup Operating System &amp; Required Tools</h3>
<p>The remaining procedures in this document depend on the following operating system and tools.</p>
<ul>
<li>Linux or Windows Subsystem for Linux<ul>
<li>CentOS 7+, Debian 9+, Fedora 31+, RHEL 7+, or Ubuntu 18+</li>
</ul>
</li>
<li>bash</li>
<li>GNU awk (gawk)</li>
<li>GNU coreutils (sort, etc)</li>
<li>GNU grep</li>
<li>Google Chrome or Firefox</li>
<li>OpenSSL</li>
</ul>
<h4 id="step-31-verify-operating-system">Step 3.1 - Verify Operating System</h4>
<p><strong><em>Commands:</em></strong></p>
<pre><code>uname -a
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># uname -a
</code></pre>

<pre><code>Linux jt 5.7.17-200.fc32.x86_64 #1 SMP Fri Aug 21 15:23:46 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
</code></pre>

<h4 id="step-32-verify-bash">Step 3.2 - Verify bash</h4>
<p><strong><em>Commands:</em></strong></p>
<pre><code>bash --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># bash --version
</code></pre>

<pre><code>GNU bash, version 5.0.17(1)-release (x86_64-redhat-linux-gnu)
Copyright (C) 2019 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;

This is free software; you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
</code></pre>

<h4 id="step-33-verify-gnu-awk">Step 3.3 - Verify GNU awk</h4>
<p><strong><em>Commands:</em></strong></p>
<pre><code>awk --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># awk --version
</code></pre>

<pre><code>GNU Awk 5.0.1, API: 3.0 (GNU MPFR 4.0.2-p9, GNU MP 6.1.2)
Copyright (C) 1989, 1991-2019 Free Software Foundation.

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see http://www.gnu.org/licenses/.
</code></pre>

<h4 id="step-34-verify-gnu-coreutils">Step 3.4 - Verify GNU coreutils</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.gnu.org/software/coreutils/</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">base64 --version
basename --version
dirname --version
sort --version
head --version
tail --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># base64 --version
</code></pre>

<pre><code>base64 (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Simon Josefsson.
</code></pre>

<pre><code># basename --version
</code></pre>

<pre><code>basename (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by David MacKenzie.
</code></pre>

<pre><code># dirname --version
</code></pre>

<pre><code>dirname (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by David MacKenzie and Jim Meyering.
</code></pre>

<pre><code># sort --version
</code></pre>

<pre><code>sort (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Mike Haertel and Paul Eggert.
</code></pre>

<pre><code># head --version
</code></pre>

<pre><code>head (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by David MacKenzie and Jim Meyering.
</code></pre>

<pre><code># tail --version
</code></pre>

<pre><code>tail (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Paul Rubin, David MacKenzie, Ian Lance Taylor,
and Jim Meyering.
</code></pre>

<h4 id="step-35-verify-gnu-grep">Step 3.5 - Verify GNU grep</h4>
<p><strong><em>Command(s):</em></strong></p>
<pre><code>grep --version
egrep --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># grep --version
</code></pre>

<pre><code>grep (GNU grep) 3.3
Copyright (C) 2018 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Mike Haertel and others; see
&lt;https://git.sv.gnu.org/cgit/grep.git/tree/AUTHORS&gt;.
</code></pre>

<pre><code># egrep --version
</code></pre>

<pre><code>grep (GNU grep) 3.3
Copyright (C) 2018 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Mike Haertel and others; see
&lt;https://git.sv.gnu.org/cgit/grep.git/tree/AUTHORS&gt;.
</code></pre>

<h4 id="step-36-verify-google-chrome-or-firefix">Step 3.6 - Verify Google Chrome or Firefix</h4>
<p><strong><em>Commands:</em></strong></p>
<pre><code>firefox --version
google-chrome --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># firefox --version
</code></pre>

<pre><code>Mozilla Firefox 80.0
</code></pre>

<pre><code># google-chrome --version
</code></pre>

<pre><code>Google Chrome 85.0.4183.83 
</code></pre>

<h4 id="step-37-verify-openssl">Step 3.7 - Verify OpenSSL</h4>
<p><strong><em>Commands:</em></strong></p>
<pre><code>openssl version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># openssl version
</code></pre>

<pre><code>OpenSSL 1.1.1g FIPS  21 Apr 2020
</code></pre>

<h3 id="step-4-setup-required-aro-environment-variables">Step 4 - Setup Required ARO Environment Variables</h3>
<p>There are many prerequisites for a successful installation of Azure Red Hat OpenShift.</p>
<p>The necessary bash environment variables are required to execute the steps in this document.</p>
<p>Before proceeding, please take your time ensuring the values are correct.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.gnu.org/software/bash/manual/html_node/Environment.html</li>
</ul>
<h4 id="step-41-export-required-aro-environment-variables">Step 4.1 - Export Required ARO Environment Variables</h4>
<p>These bash environment variables are required must be exported.  They are reused for multiple steps.</p>
<p><em>These are example values that must be changed for your installation.</em></p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.gnu.org/software/bash/manual/html_node/Environment.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code>export ARO='test'
export ARO_APPLICATION_NAME='test-app'
export ARO_CLUSTER_NAME='test-cluster'
export ARO_DOMAIN_NAME='test.mitaei.net'
export ARO_LOCATION_NAME='eastus'
export ARO_REDHAT_PULL_SECRET_FILE='./secrets/test-redhat-pull-secret.txt'
export ARO_RESOURCE_GROUP_NAME='test-eastus'
export ARO_SERVICE_PRINCIPAL_NAME='http://test-app'
export ARO_SERVICE_PRINCIPAL_PASSWORD='S3rv1c3Pr1cip4lP4ssw0rd!'
export ARO_SUBNET_AGW_ADDRESS_PREFIX='10.11.4.0/25'
export ARO_SUBNET_AGW_NAME='test-vnet-agw-subnet'
export ARO_SUBNET_AGW_NSG_NAME='test-vnet-agw-subnet-nsg'
export ARO_SUBNET_DB_ADDRESS_PREFIX='10.11.4.128/25'
export ARO_SUBNET_DB_NAME='test-vnet-db-subnet'
export ARO_SUBNET_DB_NSG_NAME='test-vnet-db-subnet-nsg'
export ARO_SUBNET_DMZ_ADDRESS_PREFIX='10.11.5.0/25'
export ARO_SUBNET_DMZ_NAME='test-vnet-dmz-subnet'
export ARO_SUBNET_DMZ_NSG_NAME='test-vnet-dmz-subnet-nsg'
export ARO_SUBNET_MASTER_ADDRESS_PREFIX='10.11.0.0/23'
export ARO_SUBNET_MASTER_NAME='test-vnet-master-subnet'
export ARO_SUBNET_MASTER_NSG_NAME='test-vnet-master-subnet-nsg'
export ARO_SUBNET_TRUSTED_ADDRESS_PREFIX='10.11.5.128/25'
export ARO_SUBNET_TRUSTED_NAME='test-vnet-trusted-subnet'
export ARO_SUBNET_TRUSTED_NSG_NAME='test-vnet-trusted-subnet-nsg'
export ARO_SUBNET_VGW_ADDRESS_PREFIX='10.11.6.0/25'
export ARO_SUBNET_VGW_NAME='GatewaySubnet'
export ARO_SUBNET_VGW_NSG_NAME='GatewaySubnet-nsg'
export ARO_SUBNET_WORKER_ADDRESS_PREFIX='10.11.2.0/23'
export ARO_SUBNET_WORKER_NAME='test-vnet-worker-subnet'
export ARO_SUBNET_WORKER_NSG_NAME='test-vnet-worker-subnet-nsg'
export ARO_SUBSCRIPTION_ID='12c7070f-83e5-453b-96d0-90770d2cf942'
export ARO_SUBSCRIPTION_NAME='Azure subscription for mitaei'
export ARO_TENANT_ID='25fe96e7-85ec-4e6a-b93f-779b16ff751d'
export ARO_TENANT_NAME='mitaei.net'
export ARO_VGW_NAME='test-vpn'
export ARO_VGW_PKI_BITS='2048'
export ARO_VGW_PKI_CLIENT='example'
export ARO_VGW_PKI_CLIENT_CRT_FILE='./pki/test-vpn-client-example.crt'
export ARO_VGW_PKI_CLIENT_KEY_FILE='./pki/test-vpn-client-example.key'
export ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE='!example!'
export ARO_VGW_PKI_CLIENT_NAME='test-vpn-client-example'
export ARO_VGW_PKI_CLIENT_PFX_FILE='./pki/test-vpn-client-example.pfx'
export ARO_VGW_PKI_CLIENT_REQ_FILE='./pki/test-vpn-client-example.req'
export ARO_VGW_PKI_CLIENT_SERIAL_FILE='./pki/test-vpn-client-example.serial'
export ARO_VGW_PKI_DIR='./pki'
export ARO_VGW_PKI_ROOT_CA_SERIAL_FILE='./pki/test-vpn-root.serial'
export ARO_VGW_PKI_ROOT_CRT_FILE='./pki/test-vpn-root.crt'
export ARO_VGW_PKI_ROOT_CRT_FILE_NAME='test-vpn-root.crt'
export ARO_VGW_PKI_ROOT_KEY_FILE='./pki/test-vpn-root.key'
export ARO_VGW_PKI_ROOT_KEY_FILE_NAME='test-vpn-root.key'
export ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE='Pk1P4ssphr4s3!!'
export ARO_VGW_POOL_ADDRESS_PREFIX='172.16.11.0/24'
export ARO_VGW_PUBLIC_ADDRESS_NAME='test-vpn-public-ip'
export ARO_VGW_REDUNDANCY='true'
export ARO_VGW_SKU='VpnGw1AZ'
export ARO_VGW_TYPE='RouteBased'
export ARO_VM_JUMP_ADMIN_NAME='test-vm-jumpbox-admin'
export ARO_VM_JUMP_IMAGE_MARKETPLACE='true'
export ARO_VM_JUMP_IMAGE_URN='cognosys:docker-ce-with-centos-8-0-free:docker-ce-with-centos-8-0-free:1.2019.0710'
export ARO_VM_JUMP_NAME='test-vm-jumpbox'
export ARO_VM_JUMP_PUBLIC_ADDRESS_NAME='test-vm-jumpbox-public-ip'
export ARO_VM_JUMP_SIZE='Standard_B1ms'
export ARO_VNET_ADDRESS_PREFIX='10.11.0.0/21'
export ARO_VNET_NAME='test-vnet'
export ARO_VPN_GATEWAY_NAME='test-vpn'
export ARO_VPN_GATEWAY_PKI_CERTIFICATE_FILE='./pki/test-vpn.crt'
export ARO_VPN_GATEWAY_PKI_CERTIFICATE_FILE_NAME='test-vpn.crt'
export ARO_VPN_GATEWAY_PKI_KEY_FILE='./pki/test-vpn.key'
export ARO_VPN_GATEWAY_PKI_KEY_FILE_PASSPHRASE='Pk1P4ssphr4s3!!'
export ARO_VPN_GATEWAY_POOL_ADDRESS_PREFIX='172.16.11.0/24'
export ARO_VPN_GATEWAY_PUBLIC_ADDRESS_NAME='test-vpn-public-ip'
export ARO_VPN_GATEWAY_REDUNDANCY='true'
export ARO_VPN_GATEWAY_SKU='VpnGw1AZ'
export ARO_VPN_GATEWAY_TYPE='RouteBased'
export ARO_ADMINISTRATORS=(joseph.tingiris@mitaei.net arun.babu@mitaei.net sivaprasad.k@mitaei.net)
export ARO_SUBSCRIPTION_OWNERS=(joseph.tingiris@mitaei.net christy.walsh@mitaei.net arun.babu@mitaei.net sivaprasad.k@mitaei.net)
export ARO_RESOURCE_PROVIDERS=(Microsoft.RedHatOpenShift Microsoft.Compute Microsoft.Storage)
export ARO_VERIFY_QUOTA_NAMEs=()
export ARO_VERIFY_QUOTA_NAMES+=('Standard Dv2 Family vCPUs')
export ARO_VERIFY_QUOTA_NAMES+=('Standard DSv3 Family vCPUs')
</code></pre>

<h4 id="step-42-verify-required-aro-environment-variables">Step 4.2 - Verify Required ARO Environment Variables</h4>
<p>Ensure the ARO bash environment variables are globally available.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://man7.org/linux/man-pages/man1/env.1.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">env | grep ^ARO | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO=test
ARO_APPLICATION_NAME=test-app
ARO_CLUSTER_NAME=test-cluster
ARO_DOMAIN_NAME=test.mitaei.net
ARO_LOCATION_NAME=eastus
ARO_REDHAT_PULL_SECRET_FILE=./secrets/test-redhat-pull-secret.txt
ARO_RESOURCE_GROUP_NAME=test-eastus
ARO_SERVICE_PRINCIPAL_NAME=http://test-app
ARO_SERVICE_PRINCIPAL_PASSWORD=S3rv1c3Pr1cip4lP4ssw0rd!
ARO_SUBNET_AGW_ADDRESS_PREFIX=10.11.4.0/25
ARO_SUBNET_AGW_NAME=test-vnet-agw-subnet
ARO_SUBNET_AGW_NSG_NAME=test-vnet-agw-subnet-nsg
ARO_SUBNET_DB_ADDRESS_PREFIX=10.11.4.128/25
ARO_SUBNET_DB_NAME=test-vnet-db-subnet
ARO_SUBNET_DB_NSG_NAME=test-vnet-db-subnet-nsg
ARO_SUBNET_DMZ_ADDRESS_PREFIX=10.11.5.0/25
ARO_SUBNET_DMZ_NAME=test-vnet-dmz-subnet
ARO_SUBNET_DMZ_NSG_NAME=test-vnet-dmz-subnet-nsg
ARO_SUBNET_MASTER_ADDRESS_PREFIX=10.11.0.0/23
ARO_SUBNET_MASTER_NAME=test-vnet-master-subnet
ARO_SUBNET_MASTER_NSG_NAME=test-vnet-master-subnet-nsg
ARO_SUBNET_TRUSTED_ADDRESS_PREFIX=10.11.5.128/25
ARO_SUBNET_TRUSTED_NAME=test-vnet-trusted-subnet
ARO_SUBNET_TRUSTED_NSG_NAME=test-vnet-trusted-subnet-nsg
ARO_SUBNET_VGW_ADDRESS_PREFIX=10.11.6.0/25
ARO_SUBNET_VGW_NAME=GatewaySubnet
ARO_SUBNET_VGW_NSG_NAME=GatewaySubnet-nsg
ARO_SUBNET_WORKER_ADDRESS_PREFIX=10.11.2.0/23
ARO_SUBNET_WORKER_NAME=test-vnet-worker-subnet
ARO_SUBNET_WORKER_NSG_NAME=test-vnet-worker-subnet-nsg
ARO_SUBSCRIPTION_ID=12c7070f-83e5-453b-96d0-90770d2cf942
ARO_SUBSCRIPTION_NAME=Azure subscription for mitaei
ARO_TENANT_ID=25fe96e7-85ec-4e6a-b93f-779b16ff751d
ARO_TENANT_NAME=mitaei.net
ARO_VGW_NAME=test-vpn
ARO_VGW_PKI_BITS=2048
ARO_VGW_PKI_CLIENT=example
ARO_VGW_PKI_CLIENT_CRT_FILE=./pki/test-vpn-client-example.crt
ARO_VGW_PKI_CLIENT_KEY_FILE=./pki/test-vpn-client-example.key
ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE=!example!
ARO_VGW_PKI_CLIENT_NAME=test-vpn-client-example
ARO_VGW_PKI_CLIENT_PFX_FILE=./pki/test-vpn-client-example.pfx
ARO_VGW_PKI_CLIENT_REQ_FILE=./pki/test-vpn-client-example.req
ARO_VGW_PKI_CLIENT_SERIAL_FILE=./pki/test-vpn-client-example.serial
ARO_VGW_PKI_DIR=./pki
ARO_VGW_PKI_ROOT_CA_SERIAL_FILE=./pki/test-vpn-root.serial
ARO_VGW_PKI_ROOT_CRT_FILE=./pki/test-vpn-root.crt
ARO_VGW_PKI_ROOT_CRT_FILE_NAME=test-vpn-root.crt
ARO_VGW_PKI_ROOT_KEY_FILE=./pki/test-vpn-root.key
ARO_VGW_PKI_ROOT_KEY_FILE_NAME=test-vpn-root.key
ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE=Pk1P4ssphr4s3!!
ARO_VGW_POOL_ADDRESS_PREFIX=172.16.11.0/24
ARO_VGW_PUBLIC_ADDRESS_NAME=test-vpn-public-ip
ARO_VGW_REDUNDANCY=true
ARO_VGW_SKU=VpnGw1AZ
ARO_VGW_TYPE=RouteBased
ARO_VM_JUMP_ADMIN_NAME=test-vm-jumpbox-admin
ARO_VM_JUMP_IMAGE_MARKETPLACE=true
ARO_VM_JUMP_IMAGE_URN=cognosys:docker-ce-with-centos-8-0-free:docker-ce-with-centos-8-0-free:1.2019.0710
ARO_VM_JUMP_NAME=test-vm-jumpbox
ARO_VM_JUMP_PUBLIC_ADDRESS_NAME=test-vm-jumpbox-public-ip
ARO_VM_JUMP_SIZE=Standard_B1ms
ARO_VNET_ADDRESS_PREFIX=10.11.0.0/21
ARO_VNET_NAME=test-vnet
ARO_VPN_GATEWAY_NAME=test-vpn
ARO_VPN_GATEWAY_PKI_CERTIFICATE_FILE=./pki/test-vpn.crt
ARO_VPN_GATEWAY_PKI_CERTIFICATE_FILE_NAME=test-vpn.crt
ARO_VPN_GATEWAY_PKI_KEY_FILE=./pki/test-vpn.key
ARO_VPN_GATEWAY_PKI_KEY_FILE_PASSPHRASE=Pk1P4ssphr4s3!!
ARO_VPN_GATEWAY_POOL_ADDRESS_PREFIX=172.16.11.0/24
ARO_VPN_GATEWAY_PUBLIC_ADDRESS_NAME=test-vpn-public-ip
ARO_VPN_GATEWAY_REDUNDANCY=true
ARO_VPN_GATEWAY_SKU=VpnGw1AZ
ARO_VPN_GATEWAY_TYPE=RouteBased
</code></pre>

<h3 id="step-5-obtain-pull-secrets">Step 5 - Obtain Pull Secrets</h3>
<p>Pull secrets are required when referencing images across OpenShift Container Platform projects or from secured registries.</p>
<h4 id="step-51-obtain-red-hat-pull-secret">Step 5.1 - Obtain Red Hat Pull Secret</h4>
<p>A Red Hat pull secret enables access to Red Hat container registries that contain additional OpenShift content.</p>
<p>This step must be done manually.  It is optional but recommended.</p>
<p>Go to the Red Hat OpenShift cluster manager portal:</p>
<ul>
<li>https://cloud.redhat.com/openshift/install/azure/aro-provisioned</li>
</ul>
<h4 id="step-52-verify-red-hat-pull-secret">Step 5.2 - Verify Red Hat Pull Secret</h4>
<p><strong><em>Commands:</em></strong></p>
<pre><code>ls -ld &quot;${ARO_REDHAT_PULL_SECRET_FILE}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>-rw-rw----+ 1 jtingiris mit 2835 Sep 17 09:13 ./secrets/test-redhat-pull-secret.txt
</code></pre>

<h3 id="step-6-setup-azure-cli">Step 6 - Setup Azure CLI</h3>
<p>The Azure command-line interface (Azure CLI) is a set of commands used to create and manage Azure resources. The Azure CLI is available across Azure services and is designed to get you working quickly with Azure, with an emphasis on automation.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/what-is-azure-cli?view=azure-cli-latest</li>
</ul>
<h4 id="step-61-install-azure-cli">Step 6.1 - Install Azure CLI</h4>
<p>The Azure CLI is available to install in Windows, macOS and Linux environments. It can also be run in a Docker container and Azure Cloud Shell.</p>
<p>To install, please follow the link in the References section.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az --version
</code></pre>

<pre><code>azure-cli                         2.11.1

core                              2.11.1
telemetry                          1.0.5 *

Extensions:
resource-graph                     1.1.0
aro                                1.0.0

Python location '/usr/bin/python3'
Extensions directory '/home/jtingiris/.azure/cliextensions'

Python (Linux) 3.8.5 (default, Aug 12 2020, 00:00:00) 
[GCC 10.2.1 20200723 (Red Hat 10.2.1-1)]

Legal docs and information: aka.ms/AzureCliLegal



Please let us know how we are doing: https://aka.ms/azureclihats
and let us know if you're interested in trying out our newest features: https://aka.ms/CLIUXstudy
</code></pre>

<h4 id="step-62-show-default-subscription">Step 6.2 - Show Default Subscription</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_list</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az account list --query '[?isDefault == `true`]'
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az account list --query '[?isDefault == `true`]'
</code></pre>

<pre><code>[
  {
    &quot;cloudName&quot;: &quot;AzureCloud&quot;,
    &quot;homeTenantId&quot;: &quot;25fe96e7-85ec-4e6a-b93f-779b16ff751d&quot;,
    &quot;id&quot;: &quot;12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
    &quot;isDefault&quot;: true,
    &quot;managedByTenants&quot;: [],
    &quot;name&quot;: &quot;Azure subscription for mitaei&quot;,
    &quot;state&quot;: &quot;Enabled&quot;,
    &quot;tenantId&quot;: &quot;25fe96e7-85ec-4e6a-b93f-779b16ff751d&quot;,
    &quot;user&quot;: {
      &quot;name&quot;: &quot;joseph.tingiris@mitaei.net&quot;,
      &quot;type&quot;: &quot;user&quot;
    }
  }
]
</code></pre>

<h4 id="step-63-login-as-the-subscription-owner">Step 6.3 - Login as the Subscription Owner</h4>
<p>The Azure Subscription Owner must perform the following steps.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli?view=azure-cli-latest</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az login
export AZ_USER=$(az account show --query 'user.name' --output tsv)
az role assignment list --role Owner --query &quot;[?principalName=='${AZ_USER}'].principalName&quot; --output tsv
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>joseph.tingiris@mitaei.net
</code></pre>

<h3 id="step-7-setup-additional-subscription-owners">Step 7 - Setup Additional Subscription Owners</h3>
<p>This step is optional, but recommended.  There should be at least two (2) Subscription Owners.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/role/assignment?view=azure-cli-latest#az_role_assignment_create</li>
</ul>
<h4 id="step-71-verify-subscription-owners">Step 7.1 - Verify Subscription Owners</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/role/assignment?view=azure-cli-latest#az_role_assignment_list</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">az role assignment list --role Owner --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az role assignment list --role Owner --output table
</code></pre>

<pre><code>Principal                   Role    Scope
--------------------------  ------  ---------------------------------------------------
sivaprasad.k@mitaei.net     Owner   /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
arun.babu@mitaei.net        Owner   /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
christy.walsh@mitaei.net    Owner   /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
joseph.tingiris@mitaei.net  Owner   /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
</code></pre>

<h3 id="step-8-verify-azure-tenant">Step 8 - Verify Azure Tenant</h3>
<p>Go to the Microsoft admin center and login with a Microsoft account that is the Global administrator.</p>
<ul>
<li>https://admin.microsoft.com/</li>
</ul>
<p>A Global Administrator will have access to all portions of the admin center.</p>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az account show --query '[{tenantId:tenantId}, {homeTenantId:homeTenantId}]'
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az account show --query '[{tenantId:tenantId}, {homeTenantId:homeTenantId}]'
</code></pre>

<pre><code>[
  {
    &quot;tenantId&quot;: &quot;25fe96e7-85ec-4e6a-b93f-779b16ff751d&quot;
  },
  {
    &quot;homeTenantId&quot;: &quot;25fe96e7-85ec-4e6a-b93f-779b16ff751d&quot;
  }
]
</code></pre>

<h3 id="step-9-verify-azure-subscription">Step 9 - Verify Azure Subscription</h3>
<p>The Azure Subscription can also be verified by going to:</p>
<ul>
<li>https://portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade</li>
</ul>
<h4 id="step-91-verify-subscription-names">Step 9.1 - Verify Subscription Names</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-list</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az account list --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az account list --output table
</code></pre>

<pre><code>Name                           CloudName    SubscriptionId                        State    IsDefault
-----------------------------  -----------  ------------------------------------  -------  -----------
N/A(tenant level account)      AzureCloud   fe47e621-b8dd-44c8-ba00-c07e41e4b3d1  Enabled  False
N/A(tenant level account)      AzureCloud   300a380f-b8d0-46c1-be0e-3b8e1af971b6  Enabled  False
AP_BASE                        AzureCloud   54f592d8-63d3-48f3-9f92-a15651f96255  Enabled  False
Azure subscription for mitaei  AzureCloud   12c7070f-83e5-453b-96d0-90770d2cf942  Enabled  True
</code></pre>

<pre><code># az account show --subscription &quot;12c7070f-83e5-453b-96d0-90770d2cf942&quot; --query &quot;[{subscription_name:name},{subscription_id:id}]&quot;
</code></pre>

<pre><code>[
  {
    &quot;subscription_name&quot;: &quot;Azure subscription for mitaei&quot;
  },
  {
    &quot;subscription_id&quot;: &quot;12c7070f-83e5-453b-96d0-90770d2cf942&quot;
  }
]
</code></pre>

<h4 id="step-92-verify-subscription-location">Step 9.2 - Verify Subscription Location</h4>
<p>Azure Red Hat OpenShift is only available in certain Microsoft geographies, or locations.  Please use the links in the references of this section to determine the most suitable regions for the installation.  The region name will be used throughout this document.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://azure.microsoft.com/en-us/global-infrastructure/services/?products=openshift</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az account list-locations --query \&quot;[?name=='${ARO_LOCATION_NAME}']\&quot; --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az account list-locations --query &quot;[?name=='eastus']&quot; --output table
</code></pre>

<pre><code>Name    DisplayName    RegionalDisplayName
------  -------------  ---------------------
eastus  East US        (US) East US
</code></pre>

<h4 id="step-93-verify-subscription-limits">Step 9.3 - Verify Subscription Limits</h4>
<p>The Azure Red Hat OpenShift (ARO) cluster uses several Microsoft Azure components, and the default Azure subscription and service limits, quotas, and constraints affect the ability to install ARO clusters.</p>
<p>A default ARO cluster requires a minimum of 40 Total Regional vCPUs and 36 Standard DSv3 Family vCPUs.</p>
<p>Default limits vary by offer category types, such as Free Trial and Pay-As-You-Go, and by series, such as Dv2, F, and G. For example, the default for Enterprise Agreement subscriptions is 350 cores.</p>
<p>If an existing Azure Subscription is used then check the limits for the subscription type and if necessary, increase quota limits before the installation of an Azure OpenShift cluster.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits</li>
<li>https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules</li>
<li>https://docs.microsoft.com/en-us/azure/networking/check-usage-against-limits</li>
<li>https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az-vm-list-usage</li>
<li>https://docs.openshift.com/container-platform/4.5/installing/installing_azure/installing-azure-account.html</li>
</ul>
<p>ARO minimum limits are required for:</p>
<ul>
<li>Standard Dv2 Family vCPUs</li>
<li>Standard DSv3 Family vCPUs</li>
</ul>
<h4 id="step-94-verify-subscription-quotas">Step 9.4 - Verify Subscription Quotas</h4>
<p>Requesting a quota increase can take 24-48 hours to complete.  The Subscription Owner should do this step.</p>
<p>Ensure the quota increase requests a minimum of 50 for the following VM families, 100 is preferred.</p>
<p>Dv2 Series
DSv3 Series</p>
<p>An increase in the VM series quotas automatically increases the total regional vCPU limit by the same amount.</p>
<p>Please use the links in the references of this section for Microsoft's directions on how to request a quota increase for a specific subscription.</p>
<p>A support case will be opened, and Microsoft will communicate directly to the person who requested the increase.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/azure-portal/supportability/per-vm-quota-requests</li>
<li>https://docs.microsoft.com/en-us/azure/azure-portal/supportability/regional-quota-requests</li>
</ul>
<p>Verify subscription quotas for:</p>
<ul>
<li>Standard Dv2 Family vCPUs</li>
<li>Standard DSv3 Family vCPUs</li>
</ul>
<h4 id="step-95-verify-subscription-quota-for-standard-dv2-family-vcpus">Step 9.5 - Verify Subscription Quota for Standard Dv2 Family vCPUs</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az_vm_list_usage</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">az vm list-usage --location ${ARO_LOCATION_NAME} --query &quot;[?localName=='Standard Dv2 Family vCPUs']&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az vm list-usage --location eastus --query &quot;[?localName=='Standard Dv2 Family vCPUs']&quot;
</code></pre>

<pre><code>[
  {
    &quot;currentValue&quot;: &quot;0&quot;,
    &quot;limit&quot;: &quot;100&quot;,
    &quot;localName&quot;: &quot;Standard Dv2 Family vCPUs&quot;,
    &quot;name&quot;: {
      &quot;localizedValue&quot;: &quot;Standard Dv2 Family vCPUs&quot;,
      &quot;value&quot;: &quot;standardDv2Family&quot;
    }
  }
]
</code></pre>

<h4 id="step-96-verify-subscription-quota-for-standard-dsv3-family-vcpus">Step 9.6 - Verify Subscription Quota for Standard DSv3 Family vCPUs</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az_vm_list_usage</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">az vm list-usage --location ${ARO_LOCATION_NAME} --query &quot;[?localName=='Standard DSv3 Family vCPUs']&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az vm list-usage --location eastus --query &quot;[?localName=='Standard DSv3 Family vCPUs']&quot;
</code></pre>

<pre><code>[
  {
    &quot;currentValue&quot;: &quot;36&quot;,
    &quot;limit&quot;: &quot;100&quot;,
    &quot;localName&quot;: &quot;Standard DSv3 Family vCPUs&quot;,
    &quot;name&quot;: {
      &quot;localizedValue&quot;: &quot;Standard DSv3 Family vCPUs&quot;,
      &quot;value&quot;: &quot;standardDSv3Family&quot;
    }
  }
]
</code></pre>

<h3 id="step-10-setup-openshift-administrators">Step 10 - Setup OpenShift Administrators</h3>
<p>Identify the people who will be responsible for administering the OpenShift cluster.  These individuals will need Microsoft accounts and elevated roles and responsibilities.</p>
<h4 id="step-101-verify-openshift-administrator-accounts">Step 10.1 - Verify OpenShift Administrator Accounts</h4>
<p>Ensure the OpenShift Administrator accounts exist and have the appropriate subscription roles.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/ad/user?view=azure-cli-latest#az_ad_user_show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>for ARO_ADMINISTRATOR in ${ARO_ADMINISTRATORS[@]}; do az ad user show --id ${ARO_ADMINISTRATOR} --query userPrincipalName --output tsv; done
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az ad user show --id joseph.tingiris@mitaei.net --query userPrincipalName --output tsv
</code></pre>

<pre><code>joseph.tingiris@mitaei.net
</code></pre>

<pre><code># az ad user show --id arun.babu@mitaei.net --query userPrincipalName --output tsv
</code></pre>

<pre><code>arun.babu@mitaei.net
</code></pre>

<pre><code># az ad user show --id sivaprasad.k@mitaei.net --query userPrincipalName --output tsv
</code></pre>

<pre><code>sivaprasad.k@mitaei.net
</code></pre>

<h4 id="step-102-verify-openshift-administrator-subscription-roles">Step 10.2 - Verify OpenShift Administrator Subscription Roles</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/role/assignment?view=azure-cli-latest#az_role_assignment_list</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>for ARO_ADMINISTRATOR in ${ARO_ADMINISTRATORS[@]}; do az role assignment list --assignee ${ARO_ADMINISTRATOR} --output table; echo; done
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az role assignment list --assignee joseph.tingiris@mitaei.net --output table
</code></pre>

<pre><code>Principal                   Role                       Scope
--------------------------  -------------------------  ---------------------------------------------------
joseph.tingiris@mitaei.net  User Access Administrator  /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
joseph.tingiris@mitaei.net  Owner                      /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
joseph.tingiris@mitaei.net  Contributor                /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
</code></pre>

<pre><code># az role assignment list --assignee arun.babu@mitaei.net --output table
</code></pre>

<pre><code>Principal             Role                       Scope
--------------------  -------------------------  ---------------------------------------------------
arun.babu@mitaei.net  User Access Administrator  /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
arun.babu@mitaei.net  Owner                      /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
arun.babu@mitaei.net  Contributor                /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
</code></pre>

<pre><code># az role assignment list --assignee sivaprasad.k@mitaei.net --output table
</code></pre>

<pre><code>Principal                Role                       Scope
-----------------------  -------------------------  ---------------------------------------------------
sivaprasad.k@mitaei.net  User Access Administrator  /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
sivaprasad.k@mitaei.net  Owner                      /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
sivaprasad.k@mitaei.net  Contributor                /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
</code></pre>

<h3 id="step-11-setup-azure-resource-providers">Step 11 - Setup Azure Resource Providers</h3>
<p>Make sure you are logged in to Azure via az (az login) with a Contributor or Owner role.</p>
<p>This step will fail for OpenShift Admins with only the User Access Administrator.  They will receive a message saying they do not have authorization.</p>
<h4 id="step-111-verify-provider-microsoftredhatopenshift">Step 11.1 - Verify Provider Microsoft.RedHatOpenShift</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az provider show -n Microsoft.RedHatOpenShift --output table

</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az provider show --namespace Microsoft.RedHatOpenShift --output table
</code></pre>

<pre><code>Namespace                  RegistrationPolicy    RegistrationState
-------------------------  --------------------  -------------------
Microsoft.RedHatOpenShift  RegistrationRequired  Registered
</code></pre>

<h4 id="step-112-verify-provider-microsoftcompute">Step 11.2 - Verify Provider Microsoft.Compute</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az provider show -n Microsoft.Compute --output table

</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az provider show --namespace Microsoft.Compute --output table
</code></pre>

<pre><code>Namespace          RegistrationPolicy    RegistrationState
-----------------  --------------------  -------------------
Microsoft.Compute  RegistrationRequired  Registered
</code></pre>

<h4 id="step-113-verify-provider-microsoftstorage">Step 11.3 - Verify Provider Microsoft.Storage</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az provider show -n Microsoft.Storage --output table

</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az provider show --namespace Microsoft.Storage --output table
</code></pre>

<pre><code>Namespace          RegistrationPolicy    RegistrationState
-----------------  --------------------  -------------------
Microsoft.Storage  RegistrationRequired  Registered
</code></pre>

<h3 id="step-12-setup-resource-group">Step 12 - Setup Resource Group</h3>
<p>An Azure resource group is a logical group in which Azure resources are deployed and managed.</p>
<p>A resource group location must be specified. This location is where resource group metadata is stored, it is also where the Azure resources are hosted.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest#az-group-create</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az group create --name ${ARO_RESOURCE_GROUP_NAME} --location ${ARO_LOCATION_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<h4 id="step-121-verify-resource-group">Step 12.1 - Verify Resource Group</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest#az-group-show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az group show --name ${ARO_RESOURCE_GROUP_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az group show --name test-eastus
</code></pre>

<pre><code>{
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/test-eastus&quot;,
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;managedBy&quot;: null,
  &quot;name&quot;: &quot;test-eastus&quot;,
  &quot;properties&quot;: {
    &quot;provisioningState&quot;: &quot;Succeeded&quot;
  },
  &quot;tags&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Resources/resourceGroups&quot;
}
</code></pre>

<h3 id="step-13-setup-virtual-network">Step 13 - Setup Virtual Network</h3>
<p>An Azure Virtual Network (VNet) is the fundamental building block for private networks in Azure. VNet enables many types of Azure resources, such as Azure Virtual Machines (VM), to securely communicate with each other, the internet, and on-premises networks. VNet is similar to a traditional network that you'd operate in your own data center, but brings with it additional benefits of Azure's infrastructure such as scale, availability, and isolation.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>env | grep ^ARO_VNET | sort
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_VNET_ADDRESS_PREFIX=10.11.0.0/21
ARO_VNET_NAME=test-vnet
</code></pre>

<h4 id="step-131-verify-virtual-network">Step 13.1 - Verify Virtual Network</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest#az-network-vnet-show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network vnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VNET_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet show --resource-group test-eastus --name test-vnet --output table
</code></pre>

<pre><code>EnableDdosProtection    EnableVmProtection    Location    Name       ProvisioningState    ResourceGroup    ResourceGuid
----------------------  --------------------  ----------  ---------  -------------------  ---------------  ------------------------------------
False                   False                 eastus      test-vnet  Succeeded            test-eastus      07635501-237e-4c71-89b0-573ccc270697
</code></pre>

<h3 id="step-14-setup-azure-red-hat-openshift-subnets">Step 14 - Setup Azure Red Hat OpenShift Subnets</h3>
<p>Azure Red Hat OpenShift clusters require a virtual network with two empty subnets, for the master and worker nodes.   The networks must be in the same resource group.  The network numbers should be IPv4 RFC1918 compliant and prefixed.</p>
<p>Additional subnets are needed for related virtual machines and a VPN.  The VPN subnet must be named GatewaySubnet.</p>
<p>It is suggested the virtual network (vnet) prefix be /21 and each (master and worker) vnet subnet prefix be /23, which will allow for a total of 510 master nodes and 510 worker nodes.  The additional subnets within the /21 prefix will be used for a VPN Gateway subnet and future growth.</p>
<p><em>NOTE: In 2018, Microsoft started automatically enabling Network Watcher when a new vnet is created.  There is not strictly required for ARO and there is an additional cost associated.  This will be seen as a new resource group named NetworkWatcherRG and a new vnet named NetworkWatercher</em><region>; Please see the references in this section for more details._</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x</li>
<li>https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview</li>
<li>https://azure.microsoft.com/en-us/updates/azure-network-watcher-will-be-enabled-by-default-for-subscriptions-containing-virtual-networks/</li>
<li>https://azure.microsoft.com/en-us/pricing/details/network-watcher/</li>
<li>https://tools.ietf.org/html/rfc1918</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>env | grep ^ARO_SUBNET | egrep -e 'MASTER|WORKER' | sort
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_SUBNET_MASTER_ADDRESS_PREFIX=10.11.0.0/23
ARO_SUBNET_MASTER_NAME=test-vnet-master-subnet
ARO_SUBNET_MASTER_NSG_NAME=test-vnet-master-subnet-nsg
ARO_SUBNET_WORKER_ADDRESS_PREFIX=10.11.2.0/23
ARO_SUBNET_WORKER_NAME=test-vnet-worker-subnet
ARO_SUBNET_WORKER_NSG_NAME=test-vnet-worker-subnet-nsg
</code></pre>

<h4 id="step-141-verify-master-subnet">Step 14.1 - Verify Master Subnet</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_MASTER_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet subnet show --resource-group test-eastus --vnet-name test-vnet --name test-vnet-master-subnet --output table
</code></pre>

<pre><code>AddressPrefix    Name                     PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  -----------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.11.0.0/23     test-vnet-master-subnet  Enabled                           Disabled                             Succeeded            test-eastus
</code></pre>

<h4 id="step-142-verify-worker-subnet">Step 14.2 - Verify Worker Subnet</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_WORKER_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet subnet show --resource-group test-eastus --vnet-name test-vnet --name test-vnet-worker-subnet --output table
</code></pre>

<pre><code>AddressPrefix    Name                     PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  -----------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.11.2.0/23     test-vnet-worker-subnet  Enabled                           Enabled                              Succeeded            test-eastus
</code></pre>

<h3 id="step-15-setup-additional-network-security-groups">Step 15 - Setup Additional Network Security Groups</h3>
<p>Azure Network Security Groups filter network traffic to and from Azure resources in an Azure virtual network. A Network Security Group contains security rules that allow/deny network traffic to/from several types of Azure resources.</p>
<p><em>NOTE:</em></p>
<ul>
<li><em>The Network Security Groups for the Master &amp; Worker subnets will be automatically created when ARO is setup.</em></li>
<li><em>The Network Security Group for the GatewaySubnet will be created when the VPN Gateway is setup.</em></li>
</ul>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>env | egrep -e 'ARO_SUBNET(.*)NSG' | egrep -ve 'MASTER|WORKER|GATEWAY' | sort
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_SUBNET_AGW_NSG_NAME=test-vnet-agw-subnet-nsg
ARO_SUBNET_DB_NSG_NAME=test-vnet-db-subnet-nsg
ARO_SUBNET_DMZ_NSG_NAME=test-vnet-dmz-subnet-nsg
ARO_SUBNET_TRUSTED_NSG_NAME=test-vnet-trusted-subnet-nsg
ARO_SUBNET_VGW_NSG_NAME=GatewaySubnet-nsg
</code></pre>

<h4 id="step-151-verify-network-security-groups">Step 15.1 - Verify Network Security Groups</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/nsg?view=azure-cli-latest#az_network_nsg_show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_AGW_NSG_NAME} --output table
az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_DB_NSG_NAME} --output table
az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_DMZ_NSG_NAME} --output table
az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_TRUSTED_NSG_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network nsg show --resource-group test-eastus --name test-vnet-agw-subnet-nsg --output table
</code></pre>

<pre><code>Location    Name                      ProvisioningState    ResourceGroup    ResourceGuid
----------  ------------------------  -------------------  ---------------  ------------------------------------
eastus      test-vnet-agw-subnet-nsg  Succeeded            test-eastus      2099686c-df3e-4bea-b6bd-48b252b62e87
</code></pre>

<pre><code># az network nsg show --resource-group test-eastus --name test-vnet-db-subnet-nsg --output table
</code></pre>

<pre><code>Location    Name                     ProvisioningState    ResourceGroup    ResourceGuid
----------  -----------------------  -------------------  ---------------  ------------------------------------
eastus      test-vnet-db-subnet-nsg  Succeeded            test-eastus      d31cbe87-00fc-4734-9d00-bfc78ef76a49
</code></pre>

<pre><code># az network nsg show --resource-group test-eastus --name test-vnet-dmz-subnet-nsg --output table
</code></pre>

<pre><code>Location    Name                      ProvisioningState    ResourceGroup    ResourceGuid
----------  ------------------------  -------------------  ---------------  ------------------------------------
eastus      test-vnet-dmz-subnet-nsg  Succeeded            test-eastus      42853b6a-9f5e-44ac-a400-a926857ce16d
</code></pre>

<pre><code># az network nsg show --resource-group test-eastus --name test-vnet-trusted-subnet-nsg --output table
</code></pre>

<pre><code>Location    Name                          ProvisioningState    ResourceGroup    ResourceGuid
----------  ----------------------------  -------------------  ---------------  ------------------------------------
eastus      test-vnet-trusted-subnet-nsg  Succeeded            test-eastus      2596272f-0cba-4279-b4a3-81bbc9d0279a
</code></pre>

<h3 id="step-16-setup-additional-network-security-group-rules">Step 16 - Setup Additional Network Security Group Rules</h3>
<p>Network security group security rules are evaluated by priority using the 5-tuple information (source, source port, destination, destination port, and protocol) to allow or deny the traffic. A flow record is created for existing connections. Communication is allowed or denied based on the connection state of the flow record. The flow record allows a network security group to be stateful. </p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview</li>
</ul>
<h4 id="step-161-verify-dmz-network-security-group-rules">Step 16.1 - Verify DMZ Network Security Group Rules</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/nsg/rule?view=azure-cli-latest#az_network_nsg_rule_show</li>
</ul>
<pre><code># az network nsg show --resource-group test-eastus --name test-vnet-dmz-subnet-nsg --query securityRules --output table
</code></pre>

<pre><code>Protocol    SourcePortRange    DestinationPortRange    SourceAddressPrefix    DestinationAddressPrefix    Access    Priority    Direction    ProvisioningState    Name      ResourceGroup
----------  -----------------  ----------------------  ---------------------  --------------------------  --------  ----------  -----------  -------------------  --------  ---------------
Tcp         *                  22                      *                      *                           Allow     1000        Inbound      Succeeded            AllowSSH  test-eastus
</code></pre>

<h3 id="step-17-setup-additional-subnets">Step 17 - Setup Additional Subnets</h3>
<p>Azure Red Hat OpenShift clusters require a virtual network with two empty subnets, for the master and worker nodes.   The networks must be in the same resource group.  The network numbers should be IPv4 RFC1918 compliant and prefixed.</p>
<p>It is suggested the virtual network (vnet) prefix be /21 and each (master and worker) vnet subnet prefix be /23, which will allow for a total of 510 master nodes and 510 worker nodes.</p>
<p><em>NOTE: In 2018, Microsoft started automatically enabling Network Watcher when a new subnet is created.  There is not strictly required for ARO and there is an additional cost associated.  This will be seen as a new resource group named NetworkWatcherRG and a new vnet named NetworkWatercher</em><region>; Please see the references in this section for more details._</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x</li>
<li>https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview</li>
<li>https://azure.microsoft.com/en-us/updates/azure-network-watcher-will-be-enabled-by-default-for-subscriptions-containing-virtual-networks/</li>
<li>https://azure.microsoft.com/en-us/pricing/details/network-watcher/</li>
<li>https://tools.ietf.org/html/rfc1918</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>env | egrep -e 'ARO_SUBNET(.*)NSG' | egrep -ve 'MASTER|WORKER|GATEWAY' | sort
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_SUBNET_AGW_ADDRESS_PREFIX=10.11.4.0/25
ARO_SUBNET_AGW_NAME=test-vnet-agw-subnet
ARO_SUBNET_AGW_NSG_NAME=test-vnet-agw-subnet-nsg
ARO_SUBNET_DB_ADDRESS_PREFIX=10.11.4.128/25
ARO_SUBNET_DB_NAME=test-vnet-db-subnet
ARO_SUBNET_DB_NSG_NAME=test-vnet-db-subnet-nsg
ARO_SUBNET_DMZ_ADDRESS_PREFIX=10.11.5.0/25
ARO_SUBNET_DMZ_NAME=test-vnet-dmz-subnet
ARO_SUBNET_DMZ_NSG_NAME=test-vnet-dmz-subnet-nsg
ARO_SUBNET_TRUSTED_ADDRESS_PREFIX=10.11.5.128/25
ARO_SUBNET_TRUSTED_NAME=test-vnet-trusted-subnet
ARO_SUBNET_TRUSTED_NSG_NAME=test-vnet-trusted-subnet-nsg
ARO_SUBNET_VGW_ADDRESS_PREFIX=10.11.6.0/25
ARO_SUBNET_VGW_NAME=GatewaySubnet
ARO_SUBNET_VGW_NSG_NAME=GatewaySubnet-nsg
</code></pre>

<h4 id="step-171-verify-application-gateway-subnet">Step 17.1 - Verify Application Gateway Subnet</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_AGW_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet subnet show --resource-group test-eastus --vnet-name test-vnet --name test-vnet-agw-subnet --output table
</code></pre>

<pre><code>AddressPrefix    Name                  PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  --------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.11.4.0/25     test-vnet-agw-subnet  Enabled                           Enabled                              Succeeded            test-eastus
</code></pre>

<h4 id="step-172-verify-database-subnet">Step 17.2 - Verify Database Subnet</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_DB_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet subnet show --resource-group test-eastus --vnet-name test-vnet --name test-vnet-db-subnet --output table
</code></pre>

<pre><code>AddressPrefix    Name                 PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  -------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.11.4.128/25   test-vnet-db-subnet  Enabled                           Enabled                              Succeeded            test-eastus
</code></pre>

<h4 id="step-173-verify-dmz-subnet">Step 17.3 - Verify DMZ Subnet</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_DMZ_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet subnet show --resource-group test-eastus --vnet-name test-vnet --name test-vnet-dmz-subnet --output table
</code></pre>

<pre><code>AddressPrefix    Name                  PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  --------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.11.5.0/25     test-vnet-dmz-subnet  Enabled                           Enabled                              Succeeded            test-eastus
</code></pre>

<h4 id="step-174-verify-trusted-subnet">Step 17.4 - Verify Trusted Subnet</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_TRUSTED_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet subnet show --resource-group test-eastus --vnet-name test-vnet --name test-vnet-trusted-subnet --output table
</code></pre>

<pre><code>AddressPrefix    Name                      PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  ------------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.11.5.128/25   test-vnet-trusted-subnet  Enabled                           Enabled                              Succeeded            test-eastus
</code></pre>

<h3 id="step-18-setup-jump-server-virtual-machine">Step 18 - Setup Jump Server Virtual Machine</h3>
<p>A jump server, jump host or jump box is a system on a network used to access and manage devices in a separate security zone. A jump server is a hardened and monitored device that spans two dissimilar security zones and provides a controlled means of access between them. The most common example is managing a host in a DMZ from trusted networks or computers.</p>
<p>All hosts within the DMZ may be prevented from connecting to the internal network by the Network Security Group (firewall) that separates them, unless the Network Security Group (firewall) permits the connection.</p>
<p>In the following steps, the jump server (jumpbox) will be put on the DMZ subnet, with tcp port 22 opened from the Internet, and it will be allowed to communicate with the other internal subnets.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/virtual-machines/linux/create-cli-complete</li>
<li>https://en.wikipedia.org/wiki/Jump_server</li>
<li>https://en.wikipedia.org/wiki/DMZ_(computing)</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>env | grep JUMP | sort
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_VM_JUMP_ADMIN_NAME=test-vm-jumpbox-admin
ARO_VM_JUMP_IMAGE_MARKETPLACE=true
ARO_VM_JUMP_IMAGE_URN=cognosys:docker-ce-with-centos-8-0-free:docker-ce-with-centos-8-0-free:1.2019.0710
ARO_VM_JUMP_NAME=test-vm-jumpbox
ARO_VM_JUMP_PUBLIC_ADDRESS_NAME=test-vm-jumpbox-public-ip
ARO_VM_JUMP_SIZE=Standard_B1ms
</code></pre>

<h4 id="step-181-verify-jump-server-public-ip-address">Step 18.1 - Verify Jump Server Public IP Address</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az_network_public_ip_show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network public-ip show --name ${ARO_VM_JUMP_PUBLIC_ADDRESS_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network public-ip show --name test-vm-jumpbox-public-ip --resource-group test-eastus
</code></pre>

<pre><code>{
  &quot;ddosSettings&quot;: null,
  &quot;dnsSettings&quot;: null,
  &quot;etag&quot;: &quot;W/\&quot;897a5a29-3d93-419c-a2ef-707fd11614fe\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/test-eastus/providers/Microsoft.Network/publicIPAddresses/test-vm-jumpbox-public-ip&quot;,
  &quot;idleTimeoutInMinutes&quot;: 4,
  &quot;ipAddress&quot;: &quot;40.71.92.76&quot;,
  &quot;ipConfiguration&quot;: {
    &quot;etag&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/test-eastus/providers/Microsoft.Network/networkInterfaces/test-vm-jumpbox-nic/ipConfigurations/ipconfig1&quot;,
    &quot;name&quot;: null,
    &quot;privateIpAddress&quot;: null,
    &quot;privateIpAllocationMethod&quot;: null,
    &quot;provisioningState&quot;: null,
    &quot;publicIpAddress&quot;: null,
    &quot;resourceGroup&quot;: &quot;test-eastus&quot;,
    &quot;subnet&quot;: null
  },
  &quot;ipTags&quot;: [],
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;name&quot;: &quot;test-vm-jumpbox-public-ip&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;publicIpAddressVersion&quot;: &quot;IPv4&quot;,
  &quot;publicIpAllocationMethod&quot;: &quot;Dynamic&quot;,
  &quot;publicIpPrefix&quot;: null,
  &quot;resourceGroup&quot;: &quot;test-eastus&quot;,
  &quot;resourceGuid&quot;: &quot;e8355a50-19c1-47b0-bfbb-a719f6e0ee51&quot;,
  &quot;sku&quot;: {
    &quot;name&quot;: &quot;Basic&quot;
  },
  &quot;tags&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Network/publicIPAddresses&quot;,
  &quot;zones&quot;: null
}
</code></pre>

<h4 id="step-182-verify-jump-server-virtual-nic">Step 18.2 - Verify Jump Server Virtual NIC</h4>
<p>A network interface enables an Azure Virtual Machine to communicate with internet, Azure, and on-premises resources.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/nic?view=azure-cli-latest#az_network_nic_show</li>
<li>https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-network-interface</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az network nic show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME}-nic --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network nic show --resource-group test-eastus --name test-vm-jumpbox-nic --output table
</code></pre>

<pre><code>EnableAcceleratedNetworking    EnableIpForwarding    Location    MacAddress         Name                 Primary    ProvisioningState    ResourceGroup    ResourceGuid
-----------------------------  --------------------  ----------  -----------------  -------------------  ---------  -------------------  ---------------  ------------------------------------
False                          False                 eastus      00-0D-3A-12-B3-FC  test-vm-jumpbox-nic  True       Succeeded            test-eastus      b642cd28-3d23-427a-82cc-7ba755438991
</code></pre>

<h4 id="step-183-verify-jump-server-availability-set">Step 18.3 - Verify Jump Server Availability Set</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/vm/availability-set?view=azure-cli-latest#az_vm_availability_set_create</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az vm availability-set show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME}-as --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az vm availability-set show --resource-group test-eastus --name test-vm-jumpbox-as --output table
</code></pre>

<pre><code>Location    Name                PlatformFaultDomainCount    PlatformUpdateDomainCount    ResourceGroup
----------  ------------------  --------------------------  ---------------------------  ---------------
eastus      test-vm-jumpbox-as  2                           5                            test-eastus
</code></pre>

<h4 id="step-184-verify-jump-server-image-terms">Step 18.4 - Verify Jump Server Image Terms</h4>
<p>In this document, the image being used for the Jump Server is a free Azure Marketplace image.  The terms must be accepted.</p>
<p>The URN is:</p>
<ul>
<li>cognosys:docker-ce-with-centos-8-0-free:docker-ce-with-centos-8-0-free:1.2019.0710</li>
</ul>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/vm/image/terms?view=azure-cli-latest#az_vm_image_terms_show</li>
<li>https://azuremarketplace.microsoft.com/en-us/marketplace/apps/cognosys.docker-ce-with-centos-8-0-free?tab=Overview</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az vm image terms show --urn ${ARO_VM_JUMP_IMAGE_URN} --query '[{accepted:accepted, name:name, plan:plan, product:product, publisher:publisher, type:type}]' --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az vm image terms show --urn cognosys:docker-ce-with-centos-8-0-free:docker-ce-with-centos-8-0-free:1.2019.0710 --query '[{accepted:accepted, name:name, plan:plan, product:product, publisher:publisher, type:type}]' --output table
</code></pre>

<pre><code>Accepted    Name                            Plan                            Product                         Publisher
----------  ------------------------------  ------------------------------  ------------------------------  -----------
True        docker-ce-with-centos-8-0-free  docker-ce-with-centos-8-0-free  docker-ce-with-centos-8-0-free  cognosys
</code></pre>

<h4 id="step-185-verify-jump-server-virtual-machine">Step 18.5 - Verify Jump Server Virtual Machine</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az_vm_show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>az vm show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME}
az vm show -d -g ${ARO_RESOURCE_GROUP_NAME} -n ${ARO_VM_JUMP_NAME} --query publicIps -o tsv
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az vm show --resource-group test-eastus --name test-vm-jumpbox
</code></pre>

<pre><code>{
  &quot;additionalCapabilities&quot;: null,
  &quot;availabilitySet&quot;: {
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/test-eastus/providers/Microsoft.Compute/availabilitySets/TEST-VM-JUMPBOX-AS&quot;,
    &quot;resourceGroup&quot;: &quot;test-eastus&quot;
  },
  &quot;billingProfile&quot;: null,
  &quot;diagnosticsProfile&quot;: null,
  &quot;evictionPolicy&quot;: null,
  &quot;extensionsTimeBudget&quot;: null,
  &quot;hardwareProfile&quot;: {
    &quot;vmSize&quot;: &quot;Standard_B1ms&quot;
  },
  &quot;host&quot;: null,
  &quot;hostGroup&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/test-eastus/providers/Microsoft.Compute/virtualMachines/test-vm-jumpbox&quot;,
  &quot;identity&quot;: null,
  &quot;instanceView&quot;: null,
  &quot;licenseType&quot;: null,
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;name&quot;: &quot;test-vm-jumpbox&quot;,
  &quot;networkProfile&quot;: {
    &quot;networkInterfaces&quot;: [
      {
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/test-eastus/providers/Microsoft.Network/networkInterfaces/test-vm-jumpbox-nic&quot;,
        &quot;primary&quot;: true,
        &quot;resourceGroup&quot;: &quot;test-eastus&quot;
      }
    ]
  },
  &quot;osProfile&quot;: {
    &quot;adminPassword&quot;: null,
    &quot;adminUsername&quot;: &quot;test-vm-jumpbox-admin&quot;,
    &quot;allowExtensionOperations&quot;: true,
    &quot;computerName&quot;: &quot;test-vm-jumpbox&quot;,
    &quot;customData&quot;: null,
    &quot;linuxConfiguration&quot;: {
      &quot;disablePasswordAuthentication&quot;: true,
      &quot;patchSettings&quot;: {
        &quot;patchMode&quot;: &quot;ImageDefault&quot;
      },
      &quot;provisionVmAgent&quot;: true,
      &quot;ssh&quot;: {
        &quot;publicKeys&quot;: [
          {
            &quot;keyData&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDec9G5K26hxFj+Ha0gQChwhSW4fT6mlZrb0066h+moGMJKMJ2YiHMaNMUULFT8SkJch4KYjQfqgJE8YnSGRHPzmUWwF/v7AwcozIlwralduUdYNIScDnzaFCBa55pLQwCWIN7zXFCdtEG935XwaV+A+tOgokiGvGXMAUj/Dz0A5ClIhbD/i3dr2AFKuuSwMGpFc1EqZDh72ZsYTcDaZT5hhPPUCUyTqOfEJuWQYeE3DAuA1EoI2tmBQWNl2S1jtdHa/69BBAmA6t0MZXuMKpk0udzQjw/d6b64hKYHDDlfxaTEBnt1Vbd8Rv5bxJSI1y2QgCutRZwVa/dt1X71fwpAq4yr0H8JCrabKrIumgqyZ6VQyCTVu3AXZ3E/yMQmJhLK2RvPHrHp8DedZ3su62zvU9aUACyd6b89R6S4eYOmIE+nNG/M/yqS2Ru3GPUalsQXE5/auCsg6rPetxMNoEbZz5qTfJUfq3Xx61WQuLrAsyvEiIiM5rrgA/FhYbthxKKacYr0b6oi6HQW6KQ3JnPMm/QF2UxDxoNOG+NHi2UBfgiXLEHZQ3YnkS4QkB9aCK4YJyOJ5I/34gAGcUIPQ8nkUSky7btjsQlHNB6pHPI+8Xd2SntRmfgBwJwOUS+LqjK4OCCpkqUTSopXQ8vL8L/e2gw+8QIdTYe47/P0IG5zVQ== jtingiris@jt\n&quot;,
            &quot;path&quot;: &quot;/home/test-vm-jumpbox-admin/.ssh/authorized_keys&quot;
          }
        ]
      }
    },
    &quot;requireGuestProvisionSignal&quot;: true,
    &quot;secrets&quot;: [],
    &quot;windowsConfiguration&quot;: null
  },
  &quot;plan&quot;: {
    &quot;name&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
    &quot;product&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
    &quot;promotionCode&quot;: null,
    &quot;publisher&quot;: &quot;cognosys&quot;
  },
  &quot;priority&quot;: null,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;proximityPlacementGroup&quot;: null,
  &quot;resourceGroup&quot;: &quot;test-eastus&quot;,
  &quot;resources&quot;: null,
  &quot;securityProfile&quot;: null,
  &quot;storageProfile&quot;: {
    &quot;dataDisks&quot;: [],
    &quot;imageReference&quot;: {
      &quot;exactVersion&quot;: &quot;1.2019.0710&quot;,
      &quot;id&quot;: null,
      &quot;offer&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
      &quot;publisher&quot;: &quot;cognosys&quot;,
      &quot;sku&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
      &quot;version&quot;: &quot;1.2019.0710&quot;
    },
    &quot;osDisk&quot;: {
      &quot;caching&quot;: &quot;ReadWrite&quot;,
      &quot;createOption&quot;: &quot;FromImage&quot;,
      &quot;diffDiskSettings&quot;: null,
      &quot;diskSizeGb&quot;: 30,
      &quot;encryptionSettings&quot;: null,
      &quot;image&quot;: null,
      &quot;managedDisk&quot;: {
        &quot;diskEncryptionSet&quot;: null,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/TEST-EASTUS/providers/Microsoft.Compute/disks/test-vm-jumpbox_OsDisk_1_d3cba19386b146898ff2ec6a13e92c61&quot;,
        &quot;resourceGroup&quot;: &quot;TEST-EASTUS&quot;,
        &quot;storageAccountType&quot;: &quot;Premium_LRS&quot;
      },
      &quot;name&quot;: &quot;test-vm-jumpbox_OsDisk_1_d3cba19386b146898ff2ec6a13e92c61&quot;,
      &quot;osType&quot;: &quot;Linux&quot;,
      &quot;vhd&quot;: null,
      &quot;writeAcceleratorEnabled&quot;: null
    }
  },
  &quot;tags&quot;: {},
  &quot;type&quot;: &quot;Microsoft.Compute/virtualMachines&quot;,
  &quot;virtualMachineScaleSet&quot;: null,
  &quot;vmId&quot;: &quot;1eaa170c-4f08-4383-a9a5-8aebd23b256c&quot;,
  &quot;zones&quot;: null
}
</code></pre>

<pre><code># az vm show -d -g test-eastus -n test-vm-jumpbox --query publicIps -o tsv
</code></pre>

<pre><code>40.71.92.76
</code></pre>

<h4 id="step-186-login-to-jump-server-virtual-machine">Step 18.6 - Login to Jump Server Virtual Machine</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az_vm_show</li>
</ul>
<p><strong><em>Commands:</em></strong></p>
<pre><code>export ARO_VM_JUMP_IP=$(az vm show -d -g ${ARO_RESOURCE_GROUP_NAME} -n ${ARO_VM_JUMP_NAME} --query publicIps -o tsv)
echo &quot;${ARO_VM_JUMP_IP}&quot;
ssh -i ~/.ssh/id_rsa.pub ${ARO_VM_JUMP_ADMIN_NAME}@${ARO_VM_JUMP_IP} 'hostname &amp;&amp; uptime'
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>40.71.92.76
test-vm-jumpbox
 03:26:23 up 3 days, 12:54,  0 users,  load average: 0.02, 0.02, 0.00
</code></pre>

<h3 id="step-19-setup-vpn-gateway">Step 19 - Setup VPN Gateway</h3>
<p>A VPN gateway is a specific type of virtual network gateway that is used to send encrypted traffic between an Azure virtual network and a remote location, over the public Internet.</p>
<p>This document will focus on creating the newer, Resrouce Manager deployment model with Azure certificate authentication.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways</li>
<li>https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about</li>
<li>https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal</li>
<li>https://docs.microsoft.com/en-us/azure/vpn-gateway/create-routebased-vpn-gateway-cli</li>
</ul>
<h4 id="step-191-verify-vpn-gateway-subnet">Step 19.1 - Verify VPN Gateway Subnet</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_VGW_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet subnet show --resource-group test-eastus --vnet-name test-vnet --name GatewaySubnet --output table
</code></pre>

<pre><code>AddressPrefix    Name           PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  -------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.11.6.0/25     GatewaySubnet  Enabled                           Enabled                              Succeeded            test-eastus
</code></pre>

<h4 id="step-192-verify-vpn-gateway-public-ip-address">Step 19.2 - Verify VPN Gateway Public IP Address</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az_network_public_ip_show</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">az network public-ip show --name ${ARO_VGW_PUBLIC_ADDRESS_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network public-ip show --name test-vpn-public-ip --resource-group test-eastus --output table
</code></pre>

<pre><code>Name                ResourceGroup    Location    Zones    Address       AddressVersion    AllocationMethod    IdleTimeoutInMinutes    ProvisioningState
------------------  ---------------  ----------  -------  ------------  ----------------  ------------------  ----------------------  -------------------
test-vpn-public-ip  test-eastus      eastus      1        52.146.16.51  IPv4              Static              4                       Succeeded
</code></pre>

<h4 id="step-193-verify-vpn-gateway">Step 19.3 - Verify VPN Gateway</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway?view=azure-cli-latest#az_network_vnet_gateway_show</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">az network vnet-gateway show --name ${ARO_VGW_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># az network vnet-gateway show --name test-vpn --resource-group test-eastus --output table
</code></pre>

<pre><code>ActiveActive    EnableBgp    EnablePrivateIpAddress    GatewayType    Location    Name      ProvisioningState    ResourceGroup    ResourceGuid                          VpnGatewayGeneration    VpnType
--------------  -----------  ------------------------  -------------  ----------  --------  -------------------  ---------------  ------------------------------------  ----------------------  ----------
False           False        False                     Vpn            eastus      test-vpn  Succeeded            test-eastus      c3808606-15b0-4577-beac-5ef1ba033ff0  Generation1             RouteBased
</code></pre>

<h3 id="step-20-setup-vpn-gateway-certificate-authentication">Step 20 - Setup VPN Gateway Certificate Authentication</h3>
<p>When using the native VPN Gateway Azure Certificate Authentication, a client certificate is used to authenticate the connecting user. Client certificates are generated from a trusted Root Certificate and then installed on each client computer.</p>
<p>The validation of the Client Certificate is performed by the VPN Gateway and happens during establishment of the point-to-site (P2S) VPN connection.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal</li>
</ul>
<h4 id="step-201-verify-vpn-gateway-root-key">Step 20.1 - Verify VPN Gateway Root Key</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">openssl rsa -in ${ARO_VGW_PKI_ROOT_KEY_FILE} -noout -passin env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># openssl rsa -in ./pki/test-vpn-root.key -noout -passin env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE &amp;&amp; echo ./pki/test-vpn-root.key OK || echo ./pki/test-vpn-root.key FAILED
</code></pre>

<pre><code></code></pre>

<h4 id="step-202-verify-vpn-gateway-root-certificate">Step 20.2 - Verify VPN Gateway Root Certificate</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">openssl x509 -in &quot;${ARO_VGW_PKI_ROOT_CRT_FILE}&quot; -noout -text
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># openssl x509 -in &quot;./pki/test-vpn-root.crt&quot; -noout -text
</code></pre>

<pre><code>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            0f:68:84:2f:5f:6a:b7:84:53:70:07:1f:db:99:f4:06:bf:fd:28:b0
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN = test-vpn
        Validity
            Not Before: Sep 19 17:15:34 2020 GMT
            Not After : Sep 17 17:15:34 2030 GMT
        Subject: CN = test-vpn
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:b0:61:28:b2:55:89:7a:11:d2:33:0c:52:a8:bc:
                    bd:5d:6b:6a:5f:ba:38:f8:e0:20:d3:ea:91:6c:bd:
                    21:f2:d3:70:80:32:70:2d:e0:bc:79:69:35:4a:aa:
                    41:2d:37:0f:eb:8a:be:3c:98:2b:2f:54:b0:3f:68:
                    b6:0d:5e:6d:f1:0f:78:1f:bd:c4:45:9e:d2:03:2a:
                    20:e3:05:82:89:d6:b2:f1:cb:a2:4d:5d:61:0e:a4:
                    6d:34:b3:6e:7f:10:44:8c:7c:74:84:fe:8a:82:ed:
                    37:aa:c9:88:54:87:a3:22:5b:63:de:ad:f3:86:ad:
                    80:19:32:91:6e:94:51:14:25:c1:c3:df:fd:c0:d1:
                    e6:b1:22:36:ac:5c:bb:98:f0:74:98:41:96:6e:c7:
                    f8:76:9a:d7:a1:bb:48:11:1e:69:54:c9:2c:46:b1:
                    32:b0:c0:19:a6:33:9f:0c:71:f5:41:b7:4e:57:1e:
                    7e:42:33:d5:89:db:18:67:1c:e8:54:7b:50:b4:14:
                    bf:78:17:c3:ef:11:b6:3f:a7:57:9f:f8:16:87:ff:
                    17:06:3c:c6:d7:d6:45:c2:0a:ec:99:d8:35:53:f7:
                    a5:85:d0:b3:ae:ca:94:a2:b9:40:d6:35:1e:eb:a0:
                    ec:4e:e6:0e:4d:5b:6f:94:af:48:b3:d1:06:5e:5b:
                    c4:2f
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                C1:D4:7C:0F:FA:85:E6:D7:22:F0:BC:47:AC:4D:7A:BD:9E:42:58:88
            X509v3 Authority Key Identifier: 
                keyid:C1:D4:7C:0F:FA:85:E6:D7:22:F0:BC:47:AC:4D:7A:BD:9E:42:58:88

            X509v3 Basic Constraints: critical
                CA:TRUE
    Signature Algorithm: sha256WithRSAEncryption
         7f:72:23:7e:5c:65:f0:34:03:79:f6:0b:ae:a4:6d:06:77:b9:
         ef:c5:93:4c:1a:ed:70:45:a7:e0:42:33:b7:b8:7e:d5:95:7b:
         d0:22:85:c9:49:8a:26:5f:d6:b9:90:1a:2a:54:f7:d8:2d:4f:
         56:93:9f:93:91:4f:c1:85:3e:0d:70:9b:5a:00:84:7b:13:3b:
         47:d3:00:0f:2b:01:df:9c:cb:61:9a:c1:cd:b4:ed:f4:24:bc:
         5f:66:d1:d0:8d:57:ee:ab:47:b8:b5:d6:6f:be:0d:b1:07:9e:
         00:f5:a1:a2:b2:6e:f9:f6:b8:59:5a:13:64:a2:c3:6e:a5:ee:
         c3:8f:88:ce:5b:ea:0f:7b:3b:08:6f:dd:17:fe:00:d4:a7:6d:
         66:78:30:80:95:0c:1b:c6:7f:b3:82:5a:cc:0d:39:74:b6:4c:
         0c:da:af:fc:3a:79:cc:ab:06:22:2a:b8:68:97:27:4f:10:b4:
         2f:43:c0:29:51:fa:7c:a2:92:0a:e6:6f:a7:d7:22:82:6a:b0:
         e4:77:c9:b8:ef:6e:57:75:f6:0b:e9:60:79:59:a0:1e:2b:e1:
         1d:94:d4:3f:35:7f:24:35:a8:57:85:bb:98:33:85:a2:97:81:
         d8:c6:e9:99:26:52:af:fd:82:0f:56:64:8c:cf:ac:e1:41:46:
         52:45:e5:6b
</code></pre>

<h4 id="step-203-verify-vpn-gateway-root-certificate-moduli">Step 20.3 - Verify VPN Gateway Root Certificate Moduli</h4>
<p>This step verifies the modulus for the root certificate and key match.</p>
<p>Mismatched moduli will prevent a successful connection to the VPN Gateway.</p>
<p><em>If the md5sums are different, then do not proceed.</em></p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</li>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">echo -n &quot;md5sum for ./pki/test-vpn-root.key = &quot;; openssl rsa -noout -modulus -in &quot;./pki/test-vpn-root.key&quot; -passin env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE | md5sum
echo -n &quot;md5sum for ./pki/test-vpn-root.crt = &quot;; openssl x509 -noout -modulus -in &quot;./pki/test-vpn-root.crt&quot; | md5sum
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># echo -n &quot;md5sum for ./pki/test-vpn-root.key = &quot;; openssl rsa -noout -modulus -in &quot;./pki/test-vpn-root.key&quot; -passin env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE | md5sum
</code></pre>

<pre><code>md5sum for ./pki/test-vpn-root.key = d7a262d5c6023fc9cc0cf33feae2ca3d  -
</code></pre>

<pre><code># echo -n &quot;md5sum for ./pki/test-vpn-root.crt = &quot;; openssl x509 -noout -modulus -in &quot;./pki/test-vpn-root.crt&quot; | md5sum
</code></pre>

<pre><code>md5sum for ./pki/test-vpn-root.crt = d7a262d5c6023fc9cc0cf33feae2ca3d  -
</code></pre>

<h4 id="step-204-verify-vpn-gateway-root-certificate-data">Step 20.4 - Verify VPN Gateway Root Certificate Data</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway?view=azure-cli-latest#az_network_vnet_gateway_show</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">AZ_UPLOAD_OK=false; while read AZ_VERIFY_CERTIFICATE_NAME; do echo &quot;found ${ARO_VGW_NAME} root certificate name = ${AZ_VERIFY_CERTIFICATE_NAME}&quot;; if [ &quot;${AZ_VERIFY_CERTIFICATE_NAME}&quot; == &quot;${ARO_VGW_PKI_ROOT_CRT_FILE_NAME}&quot; ]; then AZ_UPLOAD_OK=true; fi; done &lt;&lt;&lt; &quot;$(az network vnet-gateway show --name ${ARO_VGW_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --query vpnClientConfiguration.vpnClientRootCertificates[].[name] --output tsv)&quot;; if ${AZ_UPLOAD_OK}; then echo &quot;verified ${ARO_VGW_PKI_ROOT_CRT_FILE_NAME} exists as a root certificate name for ${ARO_VGW_NAME}&quot;; else echo &quot;failed to verify ${ARO_VGW_PKI_ROOT_CRT_FILE_NAME} exists as a root certificate name for ${ARO_VGW_NAME}&quot;; fi
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>found test-vpn root certificate name = test-vpn-root.crt
verified test-vpn-root.crt exists as a root certificate name for test-vpn
</code></pre>

<h3 id="step-21-setup-vpn-client-certificates">Step 21 - Setup VPN Client Certificates</h3>
<p>VPN Clients must present an X.509 version 3 certificate when connecting. Each user should have their own bundle of certificate files.</p>
<p>This step outlines a procedure to create them with OpenSSL v1.1.1.  It will need to be re-run for everyone who requires connectivity.</p>
<p>The Azure VPN Gateway supports both IKEv2 (ipsec) and OpenVPN (ssl) client connections.  Various VPN client software support these technologies.  It is most convenient to distribute a PKCS#12 file to the user, so they can connect to the VPN Gateway and access the private Azure Red Hat OpenShift cluster.</p>
<p>In cryptography, PKCS #12 defines an archive file format for storing many cryptography objects as a single file.  PKCS#12 evolved from Microsoft's Personal Information Exchange (PFX) standard and is used to exchange public and private objects.  It is commonly used to bundle a private key with its X.509 certificate or to bundle all the members of a chain of trust.</p>
<p>The terms PKCS #12 (pkcs12) and PFX (pfx) are often used interchangeably.</p>
<p><em>Successful execution of the commands in this step depends upon the previously created VPN Gateway Root Certificate files and exported environment variables.</em></p>
<p>At minimum, these environment variables must be properly set beforehand:</p>
<ul>
<li>ARO_VGW_NAME</li>
<li>ARO_VGW_PKI_BITS</li>
<li>ARO_VGW_PKI_DIR</li>
<li>ARO_VGW_PKI_ROOT_KEY_FILE</li>
<li>ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE</li>
</ul>
<p>Successful completion of the following steps will produce six (6) files, in this order:</p>
<ul>
<li>VPN Client Key (.key)</li>
<li>VPN Client Certificate Request (.req)</li>
<li>VPN Client Certificate Extensions (.ext)</li>
<li>VPN Client Certificate (.crt)</li>
<li>VPN Client Certificate Serial (.serial)</li>
<li>VPN Client Certificate Bundle (.pfx)</li>
</ul>
<p>The resulting PFX file is should be given to the user.</p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://en.wikipedia.org/wiki/X.509</li>
<li>https://en.wikipedia.org/wiki/PKCS_12</li>
<li>https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-how-to-vpn-client-install-azure-cert</li>
<li>https://www.openssl.org/</li>
</ul>
<h4 id="step-211-export-vpn-client-aro-environment-variables">Step 21.1 - Export VPN Client ARO Environment Variables</h4>
<p>These environment variables should be exported each time a new set of client certificate files are created.</p>
<p><em>These are example values that must be changed for your installation.</em></p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.gnu.org/software/bash/manual/html_node/Environment.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">export ARO_VGW_PKI_CLIENT='example'
export ARO_VGW_PKI_CLIENT_NAME=&quot;${ARO_VGW_NAME}-client-${ARO_VGW_PKI_CLIENT}&quot;
export ARO_VGW_PKI_CLIENT_EXT_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.ext&quot;
export ARO_VGW_PKI_CLIENT_KEY_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.key&quot;
export ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE='!'&quot;${ARO_VGW_PKI_CLIENT}&quot;'!'
export ARO_VGW_PKI_CLIENT_REQ_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.req&quot;
export ARO_VGW_PKI_CLIENT_CRT_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.crt&quot;
export ARO_VGW_PKI_CLIENT_SERIAL_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.serial&quot;
export ARO_VGW_PKI_CLIENT_PFX_FILE='${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.pfx'
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">- successfully setting enivronment variables does not produce any output
</code></pre>

<h4 id="step-212-verify-vpn-client-aro-environment-variables">Step 21.2 - Verify VPN Client ARO Environment Variables</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.gnu.org/software/bash/manual/html_node/Looping-Constructs.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">VERIFY_VARIABLES=(ARO_VGW_PKI_CLIENT_NAME ARO_VGW_PKI_CLIENT_EXT_FILE ARO_VGW_PKI_CLIENT_KEY_FILE ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE ARO_VGW_PKI_CLIENT_REQ_FILE ARO_VGW_PKI_CLIENT_CRT_FILE ARO_VGW_PKI_CLIENT_SERIAL_FILE ARO_VGW_PKI_CLIENT_PFX_FILE ARO_VGW_NAME ARO_VGW_PKI_BITS ARO_VGW_PKI_DIR ARO_VGW_PKI_ROOT_KEY_FILE ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE)
for VERIFY_VARIABLE in ${VERIFY_VARIABLES[@]}; do if [ &quot;${!VERIFY_VARIABLE}&quot; == &quot;&quot; ]; then echo &quot;ERROR: Environment Variable ${VERIFY_VARIABLE} is NOT set&quot;; else echo &quot;${VERIFY_VARIABLE}=${!VERIFY_VARIABLE}&quot;; fi; done; unset VERIFY_VARIABLE
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># VERIFY_VARIABLES=(ARO_VGW_PKI_CLIENT_NAME ARO_VGW_PKI_CLIENT_EXT_FILE ARO_VGW_PKI_CLIENT_KEY_FILE ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE ARO_VGW_PKI_CLIENT_REQ_FILE ARO_VGW_PKI_CLIENT_CRT_FILE ARO_VGW_PKI_CLIENT_SERIAL_FILE ARO_VGW_PKI_CLIENT_PFX_FILE ARO_VGW_NAME ARO_VGW_PKI_BITS ARO_VGW_PKI_DIR ARO_VGW_PKI_ROOT_KEY_FILE ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE)
</code></pre>

<pre><code class="diff">- successfully setting enivronment variables does not produce any output
</code></pre>

<pre><code># for VERIFY_VARIABLE in ${VERIFY_VARIABLES[@]}; do if [ &quot;${!VERIFY_VARIABLE}&quot; == &quot;&quot; ]; then echo &quot;ERROR: Environment Variable ${VERIFY_VARIABLE} is NOT set&quot;; aborting; else echo &quot;${VERIFY_VARIABLE}=${!VERIFY_VARIABLE}&quot;; fi; done; unset VERIFY_VARIABLE VERIFY_VARIABLES
</code></pre>

<pre><code>ARO_VGW_PKI_CLIENT_NAME=test-vpn-client-example
ARO_VGW_PKI_CLIENT_EXT_FILE=./pki/test-vpn-client-example.ext
ARO_VGW_PKI_CLIENT_KEY_FILE=./pki/test-vpn-client-example.key
ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE=!example!
ARO_VGW_PKI_CLIENT_REQ_FILE=./pki/test-vpn-client-example.req
ARO_VGW_PKI_CLIENT_CRT_FILE=./pki/test-vpn-client-example.crt
ARO_VGW_PKI_CLIENT_SERIAL_FILE=./pki/test-vpn-client-example.serial
ARO_VGW_PKI_CLIENT_PFX_FILE=./pki/test-vpn-client-example.pfx
ARO_VGW_NAME=test-vpn
ARO_VGW_PKI_BITS=2048
ARO_VGW_PKI_DIR=./pki
ARO_VGW_PKI_ROOT_KEY_FILE=./pki/test-vpn-root.key
ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE=Pk1P4ssphr4s3!!
</code></pre>

<h4 id="step-213-verify-vpn-client-key">Step 21.3 - Verify VPN Client Key</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">openssl rsa -in &quot;${ARO_VGW_PKI_CLIENT_KEY_FILE}&quot; -noout -passin env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># openssl rsa -in &quot;./pki/test-vpn-client-example.key&quot; -noout -passin env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE
</code></pre>

<pre><code class="diff">- no output produced when command is successful
</code></pre>

<h4 id="step-214-verify-vpn-client-certificate-request">Step 21.4 - Verify VPN Client Certificate Request</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">openssl req -in &quot;${ARO_VGW_PKI_CLIENT_REQ_FILE}&quot; -noout -text
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># openssl req -in &quot;./pki/test-vpn-client-example.req&quot; -noout -text
</code></pre>

<pre><code>Certificate Request:
    Data:
        Version: 1 (0x0)
        Subject: CN = test-vpn-client-example
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:c8:57:97:93:5e:12:f8:c1:3e:da:76:93:f0:7c:
                    d9:f4:2e:06:72:29:5e:f3:34:de:38:f6:88:53:75:
                    33:b2:c4:0f:bb:0d:f2:4a:9c:11:bb:b1:a6:04:f5:
                    78:d0:c8:9b:d4:bd:0c:26:c8:77:1b:c3:21:23:9d:
                    b9:56:19:3a:0f:d3:74:51:ca:b6:26:82:d1:38:dd:
                    40:3a:ae:d6:9d:c2:ce:ae:2c:cc:2f:94:a9:fc:c8:
                    09:43:94:c6:88:96:e8:bc:38:0c:0f:ab:25:c8:38:
                    ee:90:3c:34:99:cf:eb:c4:7d:49:d3:a7:e7:83:82:
                    01:53:c2:cf:1b:16:bd:f0:0a:e3:8a:d7:9c:ca:01:
                    36:3c:19:a4:74:19:dd:bb:37:d4:67:dc:8a:92:b2:
                    bf:3c:93:53:eb:21:0b:15:d1:00:45:67:36:f1:19:
                    68:a2:10:1b:5d:24:c6:13:f3:46:f3:99:43:53:c8:
                    0b:bf:b8:7f:ef:db:10:05:da:23:1e:23:8e:17:49:
                    1c:32:c3:cf:af:f9:55:54:27:1d:14:cb:90:34:63:
                    f4:30:e9:8f:17:b8:94:81:03:e9:ad:b8:4b:ff:c1:
                    b5:dc:08:57:96:3b:10:bc:53:89:61:10:3c:64:2b:
                    74:05:bf:df:23:0c:79:c9:e0:4b:01:48:8e:0d:33:
                    b1:03
                Exponent: 65537 (0x10001)
        Attributes:
            a0:00
    Signature Algorithm: sha256WithRSAEncryption
         6a:bb:28:6f:4d:bb:0a:7b:9b:54:b2:d0:ad:f7:26:16:d5:d6:
         2a:9c:d0:3b:98:76:7c:a6:72:9a:02:33:5a:de:c0:c8:4e:6b:
         0d:45:be:ca:fd:24:d4:20:d9:6e:05:fa:9f:81:b8:d0:fe:6e:
         58:9d:c3:53:b1:06:f1:45:a9:42:e2:9e:4d:9b:05:94:16:83:
         65:73:03:f7:ff:7d:18:ba:04:ec:9d:a0:b5:52:57:ec:2f:b7:
         14:b3:cd:76:c1:6f:80:2f:06:d4:e2:1b:5c:3e:2a:00:cf:a6:
         dc:c4:03:76:50:76:21:d9:5f:c5:8e:1d:60:10:d0:ec:e5:c2:
         32:ac:c9:53:04:88:fc:f3:5b:62:b2:fc:a8:93:64:29:be:98:
         a8:d3:24:ce:cf:a7:c7:fb:a3:6d:aa:ca:b7:38:72:2a:f7:4d:
         d0:14:4f:9a:01:63:74:6c:05:72:a0:fa:f7:5e:c0:d0:3b:7c:
         45:b6:a1:ef:a0:23:5a:d0:07:bf:a9:8b:8f:92:9a:78:6a:2f:
         11:01:2a:44:2e:9c:58:d9:31:2b:a3:fa:5c:b8:f1:a0:97:90:
         58:35:35:fb:c5:a5:76:7d:09:6a:d1:39:38:c1:60:f7:7a:31:
         f7:93:3e:36:37:85:5e:9a:70:d3:50:d8:49:cc:3c:e9:b5:e3:
         a8:2d:d2:47
</code></pre>

<h4 id="step-215-verify-vpn-client-certificate-extensions">Step 21.5 - Verify VPN Client Certificate Extensions</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">grep ^authorityKeyIdentifier=keyid,issuer &quot;${ARO_VGW_PKI_CLIENT_EXT_FILE}&quot; &amp;&amp; grep ^extendedKeyUsage=clientAuth &quot;${ARO_VGW_PKI_CLIENT_EXT_FILE}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># grep ^authorityKeyIdentifier=keyid,issuer &quot;./pki/test-vpn-client-example.ext&quot; &amp;&amp; grep ^extendedKeyUsage=clientAuth &quot;./pki/test-vpn-client-example.ext&quot;
</code></pre>

<pre><code>authorityKeyIdentifier=keyid,issuer
extendedKeyUsage=clientAuth
</code></pre>

<h4 id="step-216-verify-vpn-client-certificate">Step 21.6 - Verify VPN Client Certificate</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">openssl x509 -in &quot;${ARO_VGW_PKI_CLIENT_CRT_FILE}&quot; -noout -text
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># openssl x509 -in &quot;./pki/test-vpn-client-example.crt&quot; -noout -text
</code></pre>

<pre><code>Certificate:
    Data:
        Version: 1 (0x0)
        Serial Number:
            51:a4:28:83:73:db:0a:ab:c3:9e:21:29:66:25:ef:b1:fb:a5:bc:14
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN = test-vpn
        Validity
            Not Before: Sep 20 04:38:40 2020 GMT
            Not After : Sep 20 04:38:40 2023 GMT
        Subject: CN = test-vpn-client-example
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:c8:57:97:93:5e:12:f8:c1:3e:da:76:93:f0:7c:
                    d9:f4:2e:06:72:29:5e:f3:34:de:38:f6:88:53:75:
                    33:b2:c4:0f:bb:0d:f2:4a:9c:11:bb:b1:a6:04:f5:
                    78:d0:c8:9b:d4:bd:0c:26:c8:77:1b:c3:21:23:9d:
                    b9:56:19:3a:0f:d3:74:51:ca:b6:26:82:d1:38:dd:
                    40:3a:ae:d6:9d:c2:ce:ae:2c:cc:2f:94:a9:fc:c8:
                    09:43:94:c6:88:96:e8:bc:38:0c:0f:ab:25:c8:38:
                    ee:90:3c:34:99:cf:eb:c4:7d:49:d3:a7:e7:83:82:
                    01:53:c2:cf:1b:16:bd:f0:0a:e3:8a:d7:9c:ca:01:
                    36:3c:19:a4:74:19:dd:bb:37:d4:67:dc:8a:92:b2:
                    bf:3c:93:53:eb:21:0b:15:d1:00:45:67:36:f1:19:
                    68:a2:10:1b:5d:24:c6:13:f3:46:f3:99:43:53:c8:
                    0b:bf:b8:7f:ef:db:10:05:da:23:1e:23:8e:17:49:
                    1c:32:c3:cf:af:f9:55:54:27:1d:14:cb:90:34:63:
                    f4:30:e9:8f:17:b8:94:81:03:e9:ad:b8:4b:ff:c1:
                    b5:dc:08:57:96:3b:10:bc:53:89:61:10:3c:64:2b:
                    74:05:bf:df:23:0c:79:c9:e0:4b:01:48:8e:0d:33:
                    b1:03
                Exponent: 65537 (0x10001)
    Signature Algorithm: sha256WithRSAEncryption
         43:e8:e3:f9:8c:19:47:0e:07:87:e2:58:b4:ab:a7:6b:09:19:
         ee:f6:d7:77:07:77:9a:39:ca:8d:93:2a:6c:29:eb:72:8d:8e:
         fd:a1:20:a5:20:36:4b:35:da:8a:5a:a9:3f:42:2d:e7:55:c6:
         e8:17:eb:df:c6:a5:9d:04:4a:ed:b2:7f:68:6b:1d:62:42:a9:
         c5:4b:c6:2c:dc:be:b6:99:fe:7d:8d:0c:82:17:d3:52:07:b5:
         17:cc:4b:3a:1b:83:09:0f:eb:80:41:c4:9f:98:31:11:4f:88:
         97:8f:7c:09:dd:bf:d5:50:31:20:cf:fa:21:6f:5a:e1:f6:b7:
         26:bd:0f:f6:a2:63:08:1c:37:39:db:ed:ae:4c:a7:b6:0b:fd:
         ca:85:09:44:8f:c5:b8:12:12:f4:7a:bf:a8:54:13:b0:a3:3a:
         80:a2:1f:11:1e:c5:96:a2:35:3c:70:6c:c6:8a:74:71:4a:20:
         1f:76:14:5d:cf:6e:31:1f:39:ed:5a:66:f6:f9:9c:ae:7b:6f:
         14:ec:3b:58:f2:7a:95:2d:68:f0:7b:83:56:1d:6c:9b:76:94:
         5c:0a:1c:9b:c5:57:bd:89:2d:b1:35:ac:62:2e:b1:70:3e:e0:
         2d:fa:51:46:b1:4b:7d:d2:ab:3b:43:a2:2b:9c:7a:99:53:e7:
         39:63:43:e1
</code></pre>

<h4 id="step-217-verify-vpn-client-certificate-moduli">Step 21.7 - Verify VPN Client Certificate Moduli</h4>
<p>This step verifies the modulus for the client certificate, request, and key match.</p>
<p>Mismatched moduli will prevent a successful connection to the VPN Gateway.</p>
<p><em>If the md5sums are different, then do not proceed.</em></p>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</li>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html</li>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">echo -n &quot;md5sum for ./pki/test-vpn-client-example.key = &quot;; openssl rsa -noout -modulus -in &quot;./pki/test-vpn-client-example.key&quot; -passin env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE | md5sum
echo -n &quot;md5sum for ./pki/test-vpn-client-example.crt = &quot;; openssl x509 -noout -modulus -in &quot;./pki/test-vpn-client-example.crt&quot; | md5sum
echo -n &quot;md5sum for ./pki/test-vpn-client-example.req = &quot;; openssl req -noout -modulus -in &quot;./pki/test-vpn-client-example.req&quot; | md5sum
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># echo -n &quot;md5sum for ./pki/test-vpn-client-example.key = &quot;; openssl rsa -noout -modulus -in &quot;./pki/test-vpn-client-example.key&quot; -passin env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE | md5sum
</code></pre>

<pre><code>md5sum for ./pki/test-vpn-client-example.key = f644adfa6fe3cca77bbbc830deaa8cd3  -
</code></pre>

<pre><code># echo -n &quot;md5sum for ./pki/test-vpn-client-example.crt = &quot;; openssl x509 -noout -modulus -in &quot;./pki/test-vpn-client-example.crt&quot; | md5sum
</code></pre>

<pre><code>md5sum for ./pki/test-vpn-client-example.crt = f644adfa6fe3cca77bbbc830deaa8cd3  -
</code></pre>

<pre><code># echo -n &quot;md5sum for ./pki/test-vpn-client-example.req = &quot;; openssl req -noout -modulus -in &quot;./pki/test-vpn-client-example.req&quot; | md5sum
</code></pre>

<pre><code>md5sum for ./pki/test-vpn-client-example.req = f644adfa6fe3cca77bbbc830deaa8cd3  -
</code></pre>

<h4 id="step-218-verify-vpn-client-pfx">Step 21.8 - Verify VPN Client PFX</h4>
<p><strong><em>References:</em></strong></p>
<ul>
<li>https://www.openssl.org/docs/man1.1.1/man1/openssl-pkcs12.html</li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="shell">openssl x509 -in &quot;${ARO_VGW_PKI_CLIENT_PFX_FILE}&quot; -noout -text
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># openssl x509 -in &quot;./pki/test-vpn-client-example.pfx&quot; -noout -text
</code></pre>

<pre><code>Bag Attributes
    localKeyID: 9F 0F F9 2F FF 3A B7 14 69 C5 C4 66 8D 14 F3 4C C7 AF F3 D7 
subject=CN = test-vpn-client-example

issuer=CN = test-vpn

-----BEGIN CERTIFICATE-----
MIIDKjCCAhKgAwIBAgIUUaQog3PbCqvDniEpZiXvsfulvBMwDQYJKoZIhvcNAQEL
BQAwEzERMA8GA1UEAwwIdGVzdC12cG4wHhcNMjAwOTE5MTkxNjA1WhcNMjMwOTE5
MTkxNjA1WjAiMSAwHgYDVQQDDBd0ZXN0LXZwbi1jbGllbnQtZXhhbXBsZTCCASIw
DQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALI83D0ALwUJIudLl8MEZVrT6rPE
WgciZ7Jncx922lkXlqkIujSnSULY87H8Z2g6P6SlHHCAYu4O6+5v+ik23LrqkD+u
X7O/+pQmnXFJWgXq0SF/CWWR74QAxMMdo/hj1ViVjrvt/P7UnwzHLY3fhFVglLAW
deRSDSoAlbNjb4rejKBWjWoyyPPym9of75cFsWdGIMUc271Ou+77PX0kOk5NZvfS
Tt75TpdpTeQmPrUFs+930KJUpBw51E3KipTHuBIN1oQaQVsb7c5oMPduxgJioB3R
aQDVAznfAXgZc9bVSAbnr3guMR4ACGG5DvJ7B0rbZJ15vV8m57TaKr9E+W0CAwEA
AaNnMGUwHwYDVR0jBBgwFoAUwdR8D/qF5tci8LxHrE16vZ5CWIgwCQYDVR0TBAIw
ADATBgNVHSUEDDAKBggrBgEFBQcDAjAiBgNVHREEGzAZghd0ZXN0LXZwbi1jbGll
bnQtZXhhbXBsZTANBgkqhkiG9w0BAQsFAAOCAQEAB+hGAQ9N/y/0UcNpoRKyD3vY
pugUgLWQl/CxKf6moBWmB4mQfd+fwJXqSs1FOaouTASLdvjqNUVRGiXqr/V5pola
k9GqgoblGX663wyOR8U7l6x/WjyplDBRjs3II/73xvt+lteJRVk4nP88TLVroagF
w7tDax/r4gU6whJ8Vl8kTlkIvCa8lpiqzHpWnckeyHPZ4cZhDH/t52nk337eMefQ
3JhH98hfYX7CIn0lWwjo2O1WvNd5Tl6VJJLSD0uW6xJ6eZxEljsX+Qe+UI1Nlasy
dF2u2ovM4c7R5Whpeupm7ein0ckCzqpb2zFFfqyQ3o9ON8Y2Hm0lh6SYL5zWOw==
-----END CERTIFICATE-----
Bag Attributes: &lt;No Attributes&gt;
subject=CN = test-vpn

issuer=CN = test-vpn

-----BEGIN CERTIFICATE-----
MIIDBzCCAe+gAwIBAgIUD2iEL19qt4RTcAcf25n0Br/9KLAwDQYJKoZIhvcNAQEL
BQAwEzERMA8GA1UEAwwIdGVzdC12cG4wHhcNMjAwOTE5MTcxNTM0WhcNMzAwOTE3
MTcxNTM0WjATMREwDwYDVQQDDAh0ZXN0LXZwbjCCASIwDQYJKoZIhvcNAQEBBQAD
ggEPADCCAQoCggEBALBhKLJViXoR0jMMUqi8vV1ral+6OPjgINPqkWy9IfLTcIAy
cC3gvHlpNUqqQS03D+uKvjyYKy9UsD9otg1ebfEPeB+9xEWe0gMqIOMFgonWsvHL
ok1dYQ6kbTSzbn8QRIx8dIT+ioLtN6rJiFSHoyJbY96t84atgBkykW6UURQlwcPf
/cDR5rEiNqxcu5jwdJhBlm7H+Haa16G7SBEeaVTJLEaxMrDAGaYznwxx9UG3Tlce
fkIz1YnbGGcc6FR7ULQUv3gXw+8Rtj+nV5/4Fof/FwY8xtfWRcIK7JnYNVP3pYXQ
s67KlKK5QNY1Huug7E7mDk1bb5SvSLPRBl5bxC8CAwEAAaNTMFEwHQYDVR0OBBYE
FMHUfA/6hebXIvC8R6xNer2eQliIMB8GA1UdIwQYMBaAFMHUfA/6hebXIvC8R6xN
er2eQliIMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAH9yI35c
ZfA0A3n2C66kbQZ3ue/Fk0wa7XBFp+BCM7e4ftWVe9AihclJiiZf1rmQGipU99gt
T1aTn5ORT8GFPg1wm1oAhHsTO0fTAA8rAd+cy2Gawc207fQkvF9m0dCNV+6rR7i1
1m++DbEHngD1oaKybvn2uFlaE2Siw26l7sOPiM5b6g97Owhv3Rf+ANSnbWZ4MICV
DBvGf7OCWswNOXS2TAzar/w6ecyrBiIquGiXJ08QtC9DwClR+nyikgrmb6fXIoJq
sOR3ybjvbld19gvpYHlZoB4r4R2U1D81fyQ1qFeFu5gzhaKXgdjG6ZkmUq/9gg9W
ZIzPrOFBRlJF5Ws=
-----END CERTIFICATE-----
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="about/" class="btn btn-neutral float-right" title="About">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>2020 Mastech InfoTrellis</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="about/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.1.2
Build Date UTC : 2020-09-21 03:46:12.839896+00:00
-->
