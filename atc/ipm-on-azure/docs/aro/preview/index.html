<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="joseph.tingiris@mastechinfotrellis.com">
  <link rel="canonical" href="https://mitaei.github.io/atc/ipm-on-azure/docs/aro/preview/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Preview - IPM on Azure</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/mit-extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Preview";
    var mkdocs_page_input_path = "preview.md";
    var mkdocs_page_url = "/atc/ipm-on-azure/docs/aro/preview/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52523818-5', 'mitaei.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> IPM on Azure</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Index</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../tldr/">TLDR</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">IPM on Azure</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Preview</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p style="text-align: right"><img align="center" src="/img/mit.png"></p>

<p>&nbsp;</p>
<h1 id="azure-red-hat-openshift-for-ibm-product-master">Azure Red Hat OpenShift for IBM Product Master</h1>
<h3 id="draft">[DRAFT]</h3>
<p><em>This document is functional, though still in active development and undergoing frequent changes.</em></p>
<p><em>Revision: Sat 26 Sep 2020 10:58:31 PM EDT</em>
&nbsp;<br></p>
<h3 id="introduction">Introduction</h3>
<p>This document details the steps required to automate the build of a secure, private Azure Red Hat OpenShift v4.x (ARO) infrastructure for IBM Product Master v12.x.</p>
<p>The procedure to install IBM Product Master is an accompanying document.</p>
<h4 id="azure">Azure</h4>
<p>Microsoft Azure is a comprehensive cloud computing service managed by Microsoft. It provides software as a service (SaaS), platform as a service (PaaS), and infrastructure as a service (IaaS).</p>
<h4 id="openshift-container-platform">OpenShift Container Platform</h4>
<p>Red Hat's OpenShift Container Platform (OCP) is a hybrid cloud, enterprise Kubernetes application platform.  It is a platform as a service (Paas) built on Red Hat Enterprise Linux (RHEL), with Docker containers managed by Kubernetes.</p>
<h4 id="azure-red-hat-openshift">Azure Red Hat OpenShift</h4>
<p>Azure Red Hat OpenShift (ARO) is a fully managed offering of Red Hat OpenShift running in Microsoft Azure. This service is jointly managed and supported by both Microsoft and Red Hat.  For more details, see the Azure Red Hat OpenShift Service documentation.</p>
<h4 id="ibm-product-master">IBM Product Master</h4>
<p>IBM Product Master (IPM) provides trusted Product Information Management (PIM) and collaborative Master Data Management (MDM) capabilities. It creates an accurate and up-to-date repository of product and service information that can be used throughout organizations for strategic business initiatives</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openshift.com/blog/introducing-azure-red-hat-openshift-on-openshift-4">https://www.openshift.com/blog/introducing-azure-red-hat-openshift-on-openshift-4</a></li>
<li><a href="https://docs.openshift.com/aro/4/architecture/architecture.html">https://docs.openshift.com/aro/4/architecture/architecture.html</a></li>
<li><a href="https://azure.microsoft.com/">https://azure.microsoft.com/</a></li>
<li><a href="https://www.openshift.com/">https://www.openshift.com/</a></li>
<li><a href="https://www.docker.com/">https://www.docker.com/</a></li>
<li><a href="https://kubernetes.io/">https://kubernetes.io/</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/openshift/openshift-faq">https://docs.microsoft.com/en-us/azure/openshift/openshift-faq</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/openshift/support-lifecycle">https://docs.microsoft.com/en-us/azure/openshift/support-lifecycle</a></li>
<li><a href="https://www.ibm.com/products/product-master">https://www.ibm.com/products/product-master</a></li>
</ul>
<h3 id="usage">Usage</h3>
<p>This document provides a step-by-step approach.</p>
<p><strong><em>Each step is dependent upon the successful completion of previous steps.</em></strong></p>
<p>The steps are structured and all follow this same pattern.</p>
<h6 id="description"><em>Description</em></h6>
<ul>
<li>Many steps will have a detailed description that will provide additional context.  In the interest of brevity, not all steps will have detailed descriptions.</li>
</ul>
<h6 id="references"><em>Reference(s)</em></h6>
<ul>
<li>Most steps will have relevant, linked references.  All references given are to supporting documentation.</li>
</ul>
<h6 id="commands"><em>Command(s)</em></h6>
<ul>
<li>These are the bash commands that must be run.  The expectation is that they will be copy/paste.  For that reason, the majority of commands rely on pre-set environment variables.  The environment variables provide for portability, flexibility, and a consistent experience.  If there are problems running any commands then it's most likely the environment variables are incorrect.</li>
</ul>
<h6 id="example-output"><em>Example Output</em></h6>
<ul>
<li>When there is output from a command, the example output will be given.  Please compare the outputs to ensure consistency.  It may be helpful.</li>
</ul>
<h3 id="1-azure-tenant">1 - Azure Tenant</h3>
<p>A tenant is Microsoft's representation of an organization.  It is a dedicated instance of Azure Active Directory (AAD) that is received when creating a new relationship with Microsoft, like signing up for Azure, Microsoft Intune, or Microsoft 365.</p>
<p>Before Azure Red Hat OpenShift (ARO) can be installed, Microsoft accounts must exist and have appropriate access to an AAD tenant with an AAD Premium P1 License or better.  A Global Administrator must be involved in the project.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are the Global Administrator of an existing tenant, go to step 2.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-get-started-premium">https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-get-started-premium</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-create-new-tenant">https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-create-new-tenant</a></li>
</ul>
<h4 id="11-create-microsoft-account">1.1 - Create Microsoft Account</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://support.microsoft.com/en-us/help/4558219/microsoft-account-what-is">https://support.microsoft.com/en-us/help/4558219/microsoft-account-what-is</a></li>
<li><a href="https://en.wikipedia.org/wiki/Microsoft_account">https://en.wikipedia.org/wiki/Microsoft_account</a></li>
</ul>
<h4 id="12-create-global-administrator">1.2 - Create Global Administrator</h4>
<p>The person who signed up for Microsoft online services automatically becomes the first Global Administrator.</p>
<p>Only global administrators can:</p>
<ul>
<li>Add and manage domains</li>
<li>Assign the Global Administrator role to other users</li>
<li>Reset passwords for all users</li>
</ul>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/microsoft-365/admin/add-users/about-admin-roles?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/admin/add-users/about-admin-roles?view=o365-worldwide</a></li>
</ul>
<h4 id="13-verify-admin-center-access">1.3 - Verify Admin Center Access</h4>
<p>The Microsoft 365 admin center simplifies management of Microsoft 365 services. The admin center provides a tailored experience based on the the role of the logged in user.  It is the common entry point for all Microsoft administrators.</p>
<ul>
<li><a href="https://admin.microsoft.com/">https://admin.microsoft.com/</a></li>
</ul>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/microsoft-365/admin/admin-overview/about-the-admin-center?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/admin/admin-overview/about-the-admin-center?view=o365-worldwide</a></li>
</ul>
<h4 id="14-verify-aad-license">1.4 - Verify AAD License</h4>
<p>The Azure Active Directory license can be verified by visiting the Directory Overview section on the Azure Portal.</p>
<ul>
<li><a href="https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview">https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview</a></li>
</ul>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-whatis">https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-whatis</a></li>
</ul>
<h3 id="2-azure-subscription">2 - Azure Subscription</h3>
<p>An Azure subscription is a trust relationship with Azure Active Directory. A subscription trusts AAD to authenticate users, services, and devices.</p>
<p>Azure subscriptions help organize access to Azure resources. They also help control how resource usage is reported, billed, and paid for. Each subscription can have a different billing and payment method.  Every Azure service belongs to a subscription, and the subscription ID is required during the installation of ARO.</p>
<p>There are multiple choices when configuring Azure subscriptions.  A tenant may have multiple Azure subscriptions that are paid via different payment methods.  Here we will focus on a single tenant with a single subscription.</p>
<p>A Global Administrator should do the following steps, become the Subscription Owner, and then assign the appropriate subscription roles to the OpenShift Administrators.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/microsoft-365/enterprise/subscriptions-licenses-accounts-and-tenants-for-microsoft-cloud-offerings?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/enterprise/subscriptions-licenses-accounts-and-tenants-for-microsoft-cloud-offerings?view=o365-worldwide</a></li>
</ul>
<h4 id="21-create-azure-subscription">2.1 - Create Azure Subscription</h4>
<p>An Azure subscription may be purchased directly from Microsoft through the Azure website, through a Microsoft representative, or as part of a managed service from a Microsoft Partner.</p>
<p>The Microsoft account that purchases the Azure subscription will automtically be assigned the Owner role.  Additional Owners may be added later.</p>
<p>To learn more about the Azure purchase options, visit this link.</p>
<ul>
<li><a href="https://azure.microsoft.com/en-us/pricing/purchase-options/">https://azure.microsoft.com/en-us/pricing/purchase-options/</a></li>
</ul>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://azure.microsoft.com/">https://azure.microsoft.com/</a></li>
</ul>
<h3 id="3-operating-system">3 - Operating System</h3>
<p>The ARO build procedures in this document depend upon a GNU/Linux Operating System (OS) and related tools.  Special care has been taken to ensure the commands given will work on any GNU/Linux distribution.  As of this writing, they have been successfully tested on Fedora 31+, Debian 9+, and Ubuntu 18+.</p>
<ul>
<li>Linux or Windows Subsystem for Linux<ul>
<li>CentOS 7+, Debian 9+, Fedora 31+, RHEL 7+, or Ubuntu 18+</li>
</ul>
</li>
<li>GNU bash</li>
<li>GNU awk (gawk)</li>
<li>GNU coreutils (sort, etc)</li>
<li>GNU grep</li>
<li>GNU wget</li>
<li>Google Chrome or Firefox</li>
<li>OpenSSL</li>
</ul>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.gnu.org/gnu/linux-and-gnu">https://www.gnu.org/gnu/linux-and-gnu</a></li>
</ul>
<h4 id="31-verify-operating-system">3.1 - Verify Operating System</h4>
<p>The purpose of this step is to verify the Operating System is GNU/Linux and the dependent tools used in this document are installed.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man2/uname.2.html">https://man7.org/linux/man-pages/man2/uname.2.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/Uname">https://en.wikipedia.org/wiki/Uname</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">uname -a
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Linux jt 5.7.17-200.fc32.x86_64 #1 SMP Fri Aug 21 15:23:46 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
</code></pre>

<h4 id="32-verify-gnu-bash">3.2 - Verify GNU bash</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.man7.org/linux/man-pages/man1/bash.1.html">https://www.man7.org/linux/man-pages/man1/bash.1.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">https://en.wikipedia.org/wiki/Bash_(Unix_shell)</a></li>
<li><a href="https://www.gnu.org/software/bash/">https://www.gnu.org/software/bash/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">bash --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">GNU bash, version 5.0.17(1)-release (x86_64-redhat-linux-gnu)
Copyright (C) 2019 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;

This is free software; you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
</code></pre>

<h4 id="33-verify-gnu-awk">3.3 - Verify GNU awk</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man1/awk.1p.html">https://man7.org/linux/man-pages/man1/awk.1p.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/AWK">https://en.wikipedia.org/wiki/AWK</a></li>
<li><a href="https://www.gnu.org/software/gawk/">https://www.gnu.org/software/gawk/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">awk --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">GNU Awk 5.0.1, API: 3.0 (GNU MPFR 4.0.2-p9, GNU MP 6.1.2)
Copyright (C) 1989, 1991-2019 Free Software Foundation.

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see http://www.gnu.org/licenses/.
</code></pre>

<h4 id="34-verify-gnu-coreutils">3.4 - Verify GNU coreutils</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.gnu.org/software/coreutils/">https://www.gnu.org/software/coreutils/</a></li>
<li><a href="https://en.wikipedia.org/wiki/GNU_Core_Utilities">https://en.wikipedia.org/wiki/GNU_Core_Utilities</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">base64 --version
basename --version
dirname --version
sort --version
head --version
tail --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">base64 (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Simon Josefsson.
</code></pre>

<pre><code class="bash">basename (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by David MacKenzie.
</code></pre>

<pre><code class="bash">dirname (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by David MacKenzie and Jim Meyering.
</code></pre>

<pre><code class="bash">sort (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Mike Haertel and Paul Eggert.
</code></pre>

<pre><code class="bash">head (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by David MacKenzie and Jim Meyering.
</code></pre>

<pre><code class="bash">tail (GNU coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Paul Rubin, David MacKenzie, Ian Lance Taylor,
and Jim Meyering.
</code></pre>

<h4 id="35-verify-gnu-grep">3.5 - Verify GNU grep</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man1/grep.1.html">https://man7.org/linux/man-pages/man1/grep.1.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/Grep">https://en.wikipedia.org/wiki/Grep</a></li>
<li><a href="https://www.gnu.org/software/grep/">https://www.gnu.org/software/grep/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">egrep --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">grep (GNU grep) 3.3
Copyright (C) 2018 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;https://gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Mike Haertel and others; see
&lt;https://git.sv.gnu.org/cgit/grep.git/tree/AUTHORS&gt;.
</code></pre>

<h4 id="36-verify-gnu-wget">3.6 - Verify GNU wget</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man1/wget.1.html">https://man7.org/linux/man-pages/man1/wget.1.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/Wget">https://en.wikipedia.org/wiki/Wget</a></li>
<li><a href="https://www.gnu.org/software/wget/">https://www.gnu.org/software/wget/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">wget --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">GNU Wget 1.20.3 built on linux-gnu.

-cares +digest +gpgme +https +ipv6 +iri +large-file +metalink +nls 
+ntlm +opie +psl +ssl/gnutls 

Wgetrc: 
    /etc/wgetrc (system)
Locale: 
    /usr/share/locale 
Compile: 
    gcc -DHAVE_CONFIG_H -DSYSTEM_WGETRC=&quot;/etc/wgetrc&quot; 
    -DLOCALEDIR=&quot;/usr/share/locale&quot; -I. -I../lib -I../lib 
    -I/usr/include/p11-kit-1 -DHAVE_LIBGNUTLS -DNDEBUG -O2 -g -pipe 
    -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 
    -Wp,-D_GLIBCXX_ASSERTIONS -fexceptions -fstack-protector-strong 
    -grecord-gcc-switches 
    -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 
    -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic 
    -fasynchronous-unwind-tables -fstack-clash-protection 
    -fcf-protection 
Link: 
    gcc -I/usr/include/p11-kit-1 -DHAVE_LIBGNUTLS -DNDEBUG -O2 -g -pipe 
    -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 
    -Wp,-D_GLIBCXX_ASSERTIONS -fexceptions -fstack-protector-strong 
    -grecord-gcc-switches 
    -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 
    -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic 
    -fasynchronous-unwind-tables -fstack-clash-protection 
    -fcf-protection -Wl,-z,relro -Wl,--as-needed -Wl,-z,now 
    -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -lmetalink -lpcre2-8 
    -luuid -lidn2 -lnettle -lgnutls -lz -lpsl -L/usr/lib64 -lgpgme 
    ftp-opie.o gnutls.o http-ntlm.o ../lib/libgnu.a 

Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
&lt;http://www.gnu.org/licenses/gpl.html&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Originally written by Hrvoje Niksic &lt;hniksic@xemacs.org&gt;.
Please send bug reports and questions to &lt;bug-wget@gnu.org&gt;.
</code></pre>

<h4 id="37-verify-browser">3.7 - Verify Browser</h4>
<p>Either Google Chrome or Firefox is needed for a few steps.  Other browsers will probably work, too, though haven't been tested.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.mozilla.org/">https://www.mozilla.org/</a></li>
<li><a href="https://www.google.com/chrome/">https://www.google.com/chrome/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">firefox --version
google-chrome --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Mozilla Firefox 80.0
</code></pre>

<pre><code class="bash">Google Chrome 85.0.4183.83 
</code></pre>

<h4 id="38-verify-openssl">3.8 - Verify OpenSSL</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/">https://www.openssl.org/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">OpenSSL 1.1.1g FIPS  21 Apr 2020
</code></pre>

<h3 id="4-environment-variables">4 - Environment Variables</h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This document depends heavily on the bash shell.  There are required bash environment variables that are necessary to execute most steps in this document.  The environment variables must be exported prior to running the Command(s).</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><em>Subsequent steps in this document will <strong>not</strong> work unless the bash shell environment is properly setup.</em></p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">https://www.gnu.org/software/bash/manual/html_node/Environment.html</a></li>
</ul>
<h4 id="41-unset-environment-variables">4.1 - Unset Environment Variables</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unsetting the ARO environment variables can help prevent issues when, or if they have changed in the configuration file.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">https://www.gnu.org/software/bash/manual/html_node/Environment.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">for ARO in $(env | grep ^ARO | awk -F= &quot;{print \$1}&quot; | sort -V); do echo unset $ARO; unset $ARO; done
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>unset ARO
unset ARO_ADMINISTRATORS_GROUP_NAME
unset ARO_APPLICATION_NAME
unset ARO_CLUSTER_DOMAIN_NAME
unset ARO_CLUSTER_NAME
unset ARO_CLUSTER_VISIBILITY_API
unset ARO_CLUSTER_VISIBILITY_INGRESS
unset ARO_CLUSTER_VM_MASTER_SIZE
unset ARO_CLUSTER_VM_WORKER_COUNT
unset ARO_CLUSTER_VM_WORKER_DISK_GB
unset ARO_CLUSTER_VM_WORKER_SIZE
unset ARO_DOMAIN_NAME
unset ARO_LOCATION_NAME
unset ARO_REDHAT_PULL_SECRET_DIR
unset ARO_REDHAT_PULL_SECRET_FILE
unset ARO_RESOURCE_GROUP_NAME
unset ARO_SERVICE_PRINCIPAL_NAME
unset ARO_SERVICE_PRINCIPAL_PASSWORD
unset ARO_SUBNET_AGW_CIDR
unset ARO_SUBNET_AGW_NAME
unset ARO_SUBNET_AGW_NSG_NAME
unset ARO_SUBNET_DB_CIDR
unset ARO_SUBNET_DB_NAME
unset ARO_SUBNET_DB_NSG_NAME
unset ARO_SUBNET_DMZ_CIDR
unset ARO_SUBNET_DMZ_NAME
unset ARO_SUBNET_DMZ_NSG_NAME
unset ARO_SUBNET_MASTER_CIDR
unset ARO_SUBNET_MASTER_NAME
unset ARO_SUBNET_MASTER_NSG_NAME
unset ARO_SUBNET_POD_CIDR
unset ARO_SUBNET_SERVICE_CIDR
unset ARO_SUBNET_TRUSTED_CIDR
unset ARO_SUBNET_TRUSTED_NAME
unset ARO_SUBNET_TRUSTED_NSG_NAME
unset ARO_SUBNET_VGW_CIDR
unset ARO_SUBNET_VGW_NAME
unset ARO_SUBNET_VGW_POOL_CIDR
unset ARO_SUBNET_VGW_POOL_NAME
unset ARO_SUBNET_VGW_POOL_NSG_NAME
unset ARO_SUBNET_WORKER_CIDR
unset ARO_SUBNET_WORKER_NAME
unset ARO_SUBNET_WORKER_NSG_NAME
unset ARO_SUBSCRIPTION_ID
unset ARO_SUBSCRIPTION_NAME
unset ARO_TENANT_ID
unset ARO_TENANT_NAME
unset ARO_VGW_NAME
unset ARO_VGW_PKI_BITS
unset ARO_VGW_PKI_CLIENT
unset ARO_VGW_PKI_CLIENT_CRT_FILE
unset ARO_VGW_PKI_CLIENT_EXT_FILE
unset ARO_VGW_PKI_CLIENT_KEY_FILE
unset ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE
unset ARO_VGW_PKI_CLIENT_NAME
unset ARO_VGW_PKI_CLIENT_PFX_FILE
unset ARO_VGW_PKI_CLIENT_REQ_FILE
unset ARO_VGW_PKI_CLIENT_SERIAL_FILE
unset ARO_VGW_PKI_DIR
unset ARO_VGW_PKI_ROOT_CA_SERIAL_FILE
unset ARO_VGW_PKI_ROOT_CRT_FILE
unset ARO_VGW_PKI_ROOT_CRT_NAME
unset ARO_VGW_PKI_ROOT_KEY_FILE
unset ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE
unset ARO_VGW_PKI_ROOT_KEY_NAME
unset ARO_VGW_PUBLIC_ADDRESS_NAME
unset ARO_VGW_REDUNDANCY
unset ARO_VGW_SKU
unset ARO_VGW_TYPE
unset ARO_VM_JUMP_ADMIN_NAME
unset ARO_VM_JUMP_IMAGE_MARKETPLACE
unset ARO_VM_JUMP_IMAGE_URN
unset ARO_VM_JUMP_NAME
unset ARO_VM_JUMP_PUBLIC_ADDRESS_NAME
unset ARO_VM_JUMP_SIZE
unset ARO_VNET_CIDR
unset ARO_VNET_NAME
</code></pre>

<h4 id="42-set-environment-variables">4.2 - Set Environment Variables</h4>
<p>The following bash shell environment variables are required.  They are reused for multiple steps.</p>
<p>It is recommended that the environment variables be maintained in a configuration file, i.e. <strong><em>ipm.env</em></strong></p>
<p>Maintaining a configuration file will make them easier to use and update.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong><em>Before proceeding, please take your time ensuring the environment variable values are correct.</em></strong> <em>These are example values that must be changed.</em></p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">https://www.gnu.org/software/bash/manual/html_node/Environment.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">cat &quot;ipm.env&quot; &amp;&amp; source &quot;ipm.env&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code># NOTE:
#
# These variables may be set statically or dynamically.
#
# This example shows both, static and dynamic variables.
# For the dynamic variables, the order of variables is important
# because many values rely on the value of another variable.
#
# Please check, and double check the values.
#
# Each of these are required.

export ARO=ipm
export ARO_DOMAIN_NAME=mitaei.net
export ARO_ADMINISTRATORS_GROUP_NAME=&quot;OpenShift Administrators&quot;
export ARO_APPLICATION_NAME=${ARO}-app
export ARO_CLUSTER_DOMAIN_NAME=&quot;${ARO}.${ARO_DOMAIN_NAME}&quot;
export ARO_CLUSTER_NAME=${ARO}-cluster
export ARO_CLUSTER_VISIBILITY_API=&quot;Private&quot;
export ARO_CLUSTER_VISIBILITY_INGRESS=&quot;Private&quot;
export ARO_CLUSTER_VM_MASTER_SIZE=&quot;Standard_D8s_v3&quot;
export ARO_CLUSTER_VM_WORKER_COUNT=3
export ARO_CLUSTER_VM_WORKER_DISK_GB=128
export ARO_CLUSTER_VM_WORKER_SIZE=&quot;Standard_D8s_v3&quot;
export ARO_LOCATION_NAME=eastus # region
export ARO_REDHAT_PULL_SECRET_DIR=&quot;${PWD}/secrets&quot;
export ARO_REDHAT_PULL_SECRET_FILE=&quot;${ARO_REDHAT_PULL_SECRET_DIR}/${ARO}-redhat-pull-secret.txt&quot;
export ARO_RESOURCE_GROUP_NAME=&quot;${ARO}-${ARO_LOCATION_NAME}&quot;
export ARO_SERVICE_PRINCIPAL_NAME=&quot;http://${ARO_APPLICATION_NAME}&quot;
export ARO_SERVICE_PRINCIPAL_PASSWORD=&quot;S3rv1c3Pr1cip4lP4ssw0rd!&quot;
export ARO_SUBSCRIPTION_ID=$(az account show --query 'id' --output tsv 2&gt; /dev/null)
export ARO_SUBSCRIPTION_NAME=&quot;Azure subscription for mitaei&quot;
export ARO_TENANT_ID=$(az account show --query 'tenantId' --output tsv 2&gt; /dev/null)
export ARO_TENANT_NAME=${ARO_DOMAIN_NAME}

# CIDRs

# VNet - 10.10.0.0/16
export ARO_VNET_CIDR=10.10.0.0/16
export ARO_VNET_NAME=${ARO}-vnet

# Master - 10.10.0.0/23
export ARO_SUBNET_MASTER_CIDR=10.10.0.0/23
export ARO_SUBNET_MASTER_NAME=${ARO_VNET_NAME}-master-subnet
export ARO_SUBNET_MASTER_NSG_NAME=${ARO_SUBNET_MASTER_NAME}-nsg

# Worker - 10.10.2.0/23
export ARO_SUBNET_WORKER_CIDR=10.10.2.0/23
export ARO_SUBNET_WORKER_NAME=${ARO_VNET_NAME}-worker-subnet
export ARO_SUBNET_WORKER_NSG_NAME=${ARO_SUBNET_WORKER_NAME}-nsg

# Unused - 10.10.4.0/23

# Unused - 10.10.6.0/23

# Unused - 10.10.8.0/23

# VPN Gateway - 10.10.10.0/24
export ARO_SUBNET_VGW_CIDR=10.10.10.0/24
export ARO_SUBNET_VGW_NAME=GatewaySubnet # this MUST be named GatewaySubnet

# Application Gateway - 10.10.11.0/24
export ARO_SUBNET_AGW_CIDR=10.10.11.0/24
export ARO_SUBNET_AGW_NAME=${ARO_VNET_NAME}-agw-subnet
export ARO_SUBNET_AGW_NSG_NAME=${ARO_SUBNET_AGW_NAME}-nsg

# Database - 10.10.12.0/24
export ARO_SUBNET_DB_CIDR=10.10.12.0/24
export ARO_SUBNET_DB_NAME=${ARO_VNET_NAME}-db-subnet
export ARO_SUBNET_DB_NSG_NAME=${ARO_SUBNET_DB_NAME}-nsg

# DMZ - 10.10.13.0/24
export ARO_SUBNET_DMZ_CIDR=10.10.13.0/24
export ARO_SUBNET_DMZ_NAME=${ARO_VNET_NAME}-dmz-subnet
export ARO_SUBNET_DMZ_NSG_NAME=${ARO_SUBNET_DMZ_NAME}-nsg

# Trusted 10.10.14.0/24
export ARO_SUBNET_TRUSTED_CIDR=10.10.14.0/24
export ARO_SUBNET_TRUSTED_NAME=${ARO_VNET_NAME}-trusted-subnet
export ARO_SUBNET_TRUSTED_NSG_NAME=${ARO_SUBNET_TRUSTED_NAME}-nsg

# Service - 10.11.0.0/16
export ARO_SUBNET_SERVICE_CIDR=10.11.0.0/16

# Pod - 10.12.0.0/14 (must be /18 or larger)
export ARO_SUBNET_POD_CIDR=10.12.0.0/14

# VPN Gateway Pool - 172.16.13.0/24
export ARO_SUBNET_VGW_POOL_CIDR=172.16.13.0/24 # this subnet cannot overlap with the VNet
export ARO_SUBNET_VGW_POOL_NAME=${ARO_VNET_NAME}-vpn-pool-subnet
export ARO_SUBNET_VGW_POOL_NSG_NAME=${ARO_SUBNET_VGW_NAME}-nsg

# VPN Gateway (P2S)
export ARO_VGW_NAME=${ARO}-vpn
export ARO_VGW_PKI_DIR=&quot;${PWD}/pki&quot;
export ARO_VGW_PKI_BITS=2048
export ARO_VGW_PKI_CLIENT='example'
export ARO_VGW_PKI_CLIENT_NAME=&quot;${ARO_VGW_NAME}-client-${ARO_VGW_PKI_CLIENT}&quot;
export ARO_VGW_PKI_CLIENT_CRT_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.crt&quot;
export ARO_VGW_PKI_CLIENT_EXT_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.ext&quot;
export ARO_VGW_PKI_CLIENT_KEY_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.key&quot;
export ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE='!'&quot;${ARO_VGW_PKI_CLIENT}&quot;'!'
export ARO_VGW_PKI_CLIENT_PFX_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.pfx&quot;
export ARO_VGW_PKI_CLIENT_REQ_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.req&quot;
export ARO_VGW_PKI_CLIENT_SERIAL_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.serial&quot;
export ARO_VGW_PKI_ROOT_CA_SERIAL_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_NAME}-root.serial&quot;
export ARO_VGW_PKI_ROOT_CRT_NAME=&quot;${ARO_VGW_NAME}-root.crt&quot;
export ARO_VGW_PKI_ROOT_CRT_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_ROOT_CRT_NAME}&quot;
export ARO_VGW_PKI_ROOT_KEY_NAME=&quot;${ARO_VGW_NAME}-root.key&quot;
export ARO_VGW_PKI_ROOT_KEY_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_ROOT_KEY_NAME}&quot;
export ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE=&quot;Pk1P4ssphr4s3!!&quot;
export ARO_VGW_PUBLIC_ADDRESS_NAME=${ARO_VGW_NAME}-public-ip
export ARO_VGW_REDUNDANCY=true # more costly; set to false for lower environments
export ARO_VGW_SKU=&quot;VpnGw1&quot; # Not Redundant; reverse the order for redundant
export ARO_VGW_SKU=&quot;VpnGw1AZ&quot; # Redundant; reverse the order for not redundant
export ARO_VGW_TYPE=RouteBased

# Additonal, non_ARO VMs
export ARO_VM_JUMP_NAME=${ARO}-vm-jumpbox
export ARO_VM_JUMP_ADMIN_NAME=${ARO_VM_JUMP_NAME}-admin
export ARO_VM_JUMP_IMAGE_MARKETPLACE=true
export ARO_VM_JUMP_IMAGE_URN=&quot;cognosys:docker-ce-with-centos-8-0-free:docker-ce-with-centos-8-0-free:1.2019.0710&quot;
#export ARO_VM_JUMP_IP=$(az vm show -d -g ${ARO_RESOURCE_GROUP_NAME} -n ${ARO_VM_JUMP_NAME} --query publicIps -o tsv)
export ARO_VM_JUMP_PUBLIC_ADDRESS_NAME=${ARO_VM_JUMP_NAME}-public-ip
export ARO_VM_JUMP_SIZE=&quot;Standard_B1ms&quot;

#
# arrays
#

# Microsoft account UPNs for the OpenShift Administrators
export ARO_ADMINISTRATORS=()
export ARO_ADMINISTRATORS+=(openshift-admin@${ARO_DOMAIN_NAME})
export ARO_ADMINISTRATORS+=(arun.babu@mitaei.net)
export ARO_ADMINISTRATORS+=(joseph.tingiris@mitaei.net)
export ARO_ADMINISTRATORS+=(sivaprasad.k@mitaei.net)

# Microsoft Resource Providers needed for ARO
export ARO_RESOURCE_PROVIDERS=()
export ARO_RESOURCE_PROVIDERS+=(Microsoft.Compute)
export ARO_RESOURCE_PROVIDERS+=(Microsoft.RedHatOpenShift)
export ARO_RESOURCE_PROVIDERS+=(Microsoft.Storage)

# Microsoft account UPNs for who will be made Azure Subscription Owners
export ARO_SUBSCRIPTION_OWNERS=()
export ARO_SUBSCRIPTION_OWNERS+=(christy.walsh@mitaei.net)
export ARO_SUBSCRIPTION_OWNERS+=(joseph.tingiris@mitaei.net)

# Microsoft VM Family Quotas that will be verified (to have enough vCPUs for ARO)
export ARO_VERIFY_QUOTA_NAMES=()
export ARO_VERIFY_QUOTA_NAMES+=('Standard DSv3 Family vCPUs')
export ARO_VERIFY_QUOTA_NAMES+=('Standard Dv2 Family vCPUs')

# helpful aliases

alias env_aro='env | grep ^ARO | sort -V'
alias unset_aro='for ARO in $(env | grep ^ARO | awk -F= &quot;{print \$1}&quot; | sort -V); do echo unset $ARO; unset $ARO; done'
</code></pre>

<h4 id="43-verify-environment-variables">4.3 - Verify Environment Variables</h4>
<p>Ensure the ARO variables are avaialble in the bash shell environment that you're working in.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man1/env.1.html">https://man7.org/linux/man-pages/man1/env.1.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | grep ^ARO | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">ARO=ipm
ARO_ADMINISTRATORS_GROUP_NAME=OpenShift Administrators
ARO_APPLICATION_NAME=ipm-app
ARO_CLUSTER_DOMAIN_NAME=ipm.mitaei.net
ARO_CLUSTER_NAME=ipm-cluster
ARO_CLUSTER_VISIBILITY_API=Private
ARO_CLUSTER_VISIBILITY_INGRESS=Private
ARO_CLUSTER_VM_MASTER_SIZE=Standard_D8s_v3
ARO_CLUSTER_VM_WORKER_COUNT=3
ARO_CLUSTER_VM_WORKER_DISK_GB=128
ARO_CLUSTER_VM_WORKER_SIZE=Standard_D8s_v3
ARO_DOMAIN_NAME=mitaei.net
ARO_LOCATION_NAME=eastus
ARO_REDHAT_PULL_SECRET_DIR=/home/jtingiris/prj/mit/aei/secrets
ARO_REDHAT_PULL_SECRET_FILE=/home/jtingiris/prj/mit/aei/secrets/ipm-redhat-pull-secret.txt
ARO_RESOURCE_GROUP_NAME=ipm-eastus
ARO_SERVICE_PRINCIPAL_NAME=http://ipm-app
ARO_SERVICE_PRINCIPAL_PASSWORD=S3rv1c3Pr1cip4lP4ssw0rd!
ARO_SUBNET_AGW_CIDR=10.10.11.0/24
ARO_SUBNET_AGW_NAME=ipm-vnet-agw-subnet
ARO_SUBNET_AGW_NSG_NAME=ipm-vnet-agw-subnet-nsg
ARO_SUBNET_DB_CIDR=10.10.12.0/24
ARO_SUBNET_DB_NAME=ipm-vnet-db-subnet
ARO_SUBNET_DB_NSG_NAME=ipm-vnet-db-subnet-nsg
ARO_SUBNET_DMZ_CIDR=10.10.13.0/24
ARO_SUBNET_DMZ_NAME=ipm-vnet-dmz-subnet
ARO_SUBNET_DMZ_NSG_NAME=ipm-vnet-dmz-subnet-nsg
ARO_SUBNET_MASTER_CIDR=10.10.0.0/23
ARO_SUBNET_MASTER_NAME=ipm-vnet-master-subnet
ARO_SUBNET_MASTER_NSG_NAME=ipm-vnet-master-subnet-nsg
ARO_SUBNET_POD_CIDR=10.12.0.0/14
ARO_SUBNET_SERVICE_CIDR=10.11.0.0/16
ARO_SUBNET_TRUSTED_CIDR=10.10.14.0/24
ARO_SUBNET_TRUSTED_NAME=ipm-vnet-trusted-subnet
ARO_SUBNET_TRUSTED_NSG_NAME=ipm-vnet-trusted-subnet-nsg
ARO_SUBNET_VGW_CIDR=10.10.10.0/24
ARO_SUBNET_VGW_NAME=GatewaySubnet
ARO_SUBNET_VGW_POOL_CIDR=172.16.13.0/24
ARO_SUBNET_VGW_POOL_NAME=ipm-vnet-vpn-pool-subnet
ARO_SUBNET_VGW_POOL_NSG_NAME=GatewaySubnet-nsg
ARO_SUBNET_WORKER_CIDR=10.10.2.0/23
ARO_SUBNET_WORKER_NAME=ipm-vnet-worker-subnet
ARO_SUBNET_WORKER_NSG_NAME=ipm-vnet-worker-subnet-nsg
ARO_SUBSCRIPTION_ID=12c7070f-83e5-453b-96d0-90770d2cf942
ARO_SUBSCRIPTION_NAME=Azure subscription for mitaei
ARO_TENANT_ID=25fe96e7-85ec-4e6a-b93f-779b16ff751d
ARO_TENANT_NAME=mitaei.net
ARO_VGW_NAME=ipm-vpn
ARO_VGW_PKI_BITS=2048
ARO_VGW_PKI_CLIENT=example
ARO_VGW_PKI_CLIENT_CRT_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.crt
ARO_VGW_PKI_CLIENT_EXT_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.ext
ARO_VGW_PKI_CLIENT_KEY_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.key
ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE=!example!
ARO_VGW_PKI_CLIENT_NAME=ipm-vpn-client-example
ARO_VGW_PKI_CLIENT_PFX_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.pfx
ARO_VGW_PKI_CLIENT_REQ_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.req
ARO_VGW_PKI_CLIENT_SERIAL_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.serial
ARO_VGW_PKI_DIR=/home/jtingiris/prj/mit/aei/pki
ARO_VGW_PKI_ROOT_CA_SERIAL_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.serial
ARO_VGW_PKI_ROOT_CRT_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.crt
ARO_VGW_PKI_ROOT_CRT_NAME=ipm-vpn-root.crt
ARO_VGW_PKI_ROOT_KEY_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.key
ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE=Pk1P4ssphr4s3!!
ARO_VGW_PKI_ROOT_KEY_NAME=ipm-vpn-root.key
ARO_VGW_PUBLIC_ADDRESS_NAME=ipm-vpn-public-ip
ARO_VGW_REDUNDANCY=true
ARO_VGW_SKU=VpnGw1AZ
ARO_VGW_TYPE=RouteBased
ARO_VM_JUMP_ADMIN_NAME=ipm-vm-jumpbox-admin
ARO_VM_JUMP_IMAGE_MARKETPLACE=true
ARO_VM_JUMP_IMAGE_URN=cognosys:docker-ce-with-centos-8-0-free:docker-ce-with-centos-8-0-free:1.2019.0710
ARO_VM_JUMP_NAME=ipm-vm-jumpbox
ARO_VM_JUMP_PUBLIC_ADDRESS_NAME=ipm-vm-jumpbox-public-ip
ARO_VM_JUMP_SIZE=Standard_B1ms
ARO_VNET_CIDR=10.10.0.0/16
ARO_VNET_NAME=ipm-vnet
</code></pre>

<h3 id="5-required-directories">5 - Required Directories</h3>
<p>This documentation provides commands that create files.  To better organize the output files, the directories must exist or be created.</p>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep &quot;ARO.*DIR&quot; | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_REDHAT_PULL_SECRET_DIR=/home/jtingiris/prj/mit/aei/secrets
ARO_VGW_PKI_DIR=/home/jtingiris/prj/mit/aei/pki
</code></pre>

<h4 id="51-create-required-directories">5.1 - Create Required Directories</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man1/mkdir.1.html">https://man7.org/linux/man-pages/man1/mkdir.1.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">mkdir -p &quot;${ARO_VGW_PKI_DIR}&quot;
mkdir -p &quot;${ARO_REDHAT_PULL_SECRET_DIR}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="52-verify-required-directories">5.2 - Verify Required Directories</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man1/ls.1.html">https://man7.org/linux/man-pages/man1/ls.1.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">ls -ld &quot;${ARO_VGW_PKI_DIR}&quot;
ls -ld &quot;${ARO_REDHAT_PULL_SECRET_DIR}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">drwxrws---+ 2 jtingiris mit 24 Sep 26 22:34 /home/jtingiris/prj/mit/aei/pki
</code></pre>

<pre><code class="bash">drwxrws---+ 2 jtingiris mit 4096 Sep 26 11:51 /home/jtingiris/prj/mit/aei/secrets
</code></pre>

<h3 id="6-azure-cli">6 - Azure CLI</h3>
<p>The Azure CLI is a Command Line Interface (CLI) used to create and manage Azure resources.  The Azure CLI works with all Azure services.  It is designed to more quickly work with Azure, with an emphasis on automation.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/what-is-azure-cli?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/what-is-azure-cli?view=azure-cli-latest</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">which az
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>/usr/bin/az
</code></pre>

<h4 id="61-install-azure-cli">6.1 - Install Azure CLI</h4>
<p>The Azure CLI is available to install on Windows, macOS and Linux environments. It can also be run in a Docker container and Azure Cloud Shell.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To install the Azure CLI, please follow the link in the Reference(s) section.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az --version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">azure-cli                         2.12.0

core                              2.12.0
telemetry                          1.0.6

Extensions:
resource-graph                     1.1.0
aro                                1.0.0

Python location '/usr/bin/python3'
Extensions directory '/home/jtingiris/.azure/cliextensions'

Python (Linux) 3.8.5 (default, Aug 12 2020, 00:00:00) 
[GCC 10.2.1 20200723 (Red Hat 10.2.1-1)]

Legal docs and information: aka.ms/AzureCliLegal


Your CLI is up-to-date.

Please let us know how we are doing: https://aka.ms/azureclihats
and let us know if you're interested in trying out our newest features: https://aka.ms/CLIUXstudy
</code></pre>

<h4 id="62-subscription-owner-login">6.2 - Subscription Owner Login</h4>
<p>The Azure Subscription Owner must perform the remaining steps in this documentation.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli?view=azure-cli-latest</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az login
export AZ_USER=$(az account show --query 'user.name' --output tsv)
az role assignment list --role Owner --query &quot;[?principalName=='${AZ_USER}'].principalName&quot; --output tsv
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">joseph.tingiris@mitaei.net
</code></pre>

<h4 id="63-verify-azure-tenant">6.3 - Verify Azure Tenant</h4>
<p>One way to verify the Azure Tenant is to obtain the Tenant ID with az.  Another way is to login to the Azure AAD portal.</p>
<p>The Tenant ID must match what is in the environment configuration file.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_show">https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_show</a></li>
<li><a href="https://aad.portal.azure.com/">https://aad.portal.azure.com/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az account show --query '[{tenantId:tenantId}, {homeTenantId:homeTenantId}]'
export AZ_TENANT_ID=$(az account show --query 'tenantId' --output tsv 2&gt; /dev/null)
if [ &quot;${ARO_TENANT_ID}&quot; != &quot;${AZ_TENANT_ID}&quot; ];then; echo &quot;ERROR! ARO_TENANT_ID (${ARO_TENANT_ID}) does not match this tenant id (${AZ_TENANT_ID})&quot;; fi
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">[
  {
    &quot;tenantId&quot;: &quot;25fe96e7-85ec-4e6a-b93f-779b16ff751d&quot;
  },
  {
    &quot;homeTenantId&quot;: &quot;25fe96e7-85ec-4e6a-b93f-779b16ff751d&quot;
  }
]
</code></pre>

<h4 id="64-set-default-subscription">6.4 - Set Default Subscription</h4>
<p>Set the default subscription that the ARO resources will be installed in.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_set">https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_set</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az account set -s &quot;${ARO_SUBSCRIPTION_NAME}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="65-verify-default-subscription">6.5 - Verify Default Subscription</h4>
<p>The Azure CLI Default Subscription will be used to provision all ARO resources.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_list">https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_list</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az account list --query '[?isDefault == `true`]'
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">[
  {
    &quot;cloudName&quot;: &quot;AzureCloud&quot;,
    &quot;homeTenantId&quot;: &quot;25fe96e7-85ec-4e6a-b93f-779b16ff751d&quot;,
    &quot;id&quot;: &quot;12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
    &quot;isDefault&quot;: true,
    &quot;managedByTenants&quot;: [],
    &quot;name&quot;: &quot;Azure subscription for mitaei&quot;,
    &quot;state&quot;: &quot;Enabled&quot;,
    &quot;tenantId&quot;: &quot;25fe96e7-85ec-4e6a-b93f-779b16ff751d&quot;,
    &quot;user&quot;: {
      &quot;name&quot;: &quot;joseph.tingiris@mitaei.net&quot;,
      &quot;type&quot;: &quot;user&quot;
    }
  }
]
</code></pre>

<h3 id="7-subscription-owners">7 - Subscription Owners</h3>
<p>There should be at least two (2) Subscription Owners.  This step is optional, but recommended.  It will use the ${ARO_SUBSCRIPTION_OWNERS} environment value and ensure all User Principal Names (UPNs) are added as Subscription Owners.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#owner">https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#owner</a></li>
</ul>
<h4 id="71-create-subscription-owners">7.1 - Create Subscription Owners</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/role/assignment?view=azure-cli-latest#az_role_assignment_create">https://docs.microsoft.com/en-us/cli/azure/role/assignment?view=azure-cli-latest#az_role_assignment_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">for ARO_SUBSCRIPTION_OWNER in ${ARO_SUBSCRIPTION_OWNERS[@]}; do az role assignment create --assignee ${ARO_SUBSCRIPTION_OWNER} --role Owner; done
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/c3649109-4f94-47cf-9c05-2677f6f1a9a8&quot;,
  &quot;name&quot;: &quot;c3649109-4f94-47cf-9c05-2677f6f1a9a8&quot;,
  &quot;principalId&quot;: &quot;52f7dd5d-ad08-4b40-878f-40686c51c24e&quot;,
  &quot;principalName&quot;: &quot;christy.walsh@mitaei.net&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635&quot;,
  &quot;roleDefinitionName&quot;: &quot;Owner&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}
</code></pre>

<pre><code class="json">{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/0e3fa58c-ed20-4ead-bc53-47578faf7b8e&quot;,
  &quot;name&quot;: &quot;0e3fa58c-ed20-4ead-bc53-47578faf7b8e&quot;,
  &quot;principalId&quot;: &quot;83525d38-8d7f-4476-81aa-14c46c4cb876&quot;,
  &quot;principalName&quot;: &quot;joseph.tingiris@mitaei.net&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635&quot;,
  &quot;roleDefinitionName&quot;: &quot;Owner&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}
</code></pre>

<h4 id="72-verify-subscription-owners">7.2 - Verify Subscription Owners</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/role/assignment?view=azure-cli-latest#az_role_assignment_list">https://docs.microsoft.com/en-us/cli/azure/role/assignment?view=azure-cli-latest#az_role_assignment_list</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az role assignment list --role Owner --output table
</code></pre>

<pre><code class="bash">Principal                   Role    Scope
--------------------------  ------  ---------------------------------------------------
christy.walsh@mitaei.net    Owner   /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
joseph.tingiris@mitaei.net  Owner   /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
</code></pre>

<h3 id="8-subscription-details">8 - Subscription Details</h3>
<p>Uze <code>az</code> to verify Azure Subscription details.  The subscription may also be manually verified via the Azure Portal Subscription blade.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep -e '^ARO_SUBSCRIPTION_NAME|^ARO_SUBSCRIPTION_ID|^ARO_TENANT_ID|^ARO_LOCATION_NAME'
echo &quot;ARO_SUBSCRIPTION_OWNERS=${ARO_SUBSCRIPTION_OWNERS[@]}&quot;
echo &quot;ARO_VERIFY_QUOTA_NAMES=${ARO_VERIFY_QUOTA_NAMES[@]}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_LOCATION_NAME=eastus
ARO_TENANT_ID=25fe96e7-85ec-4e6a-b93f-779b16ff751d
ARO_SUBSCRIPTION_ID=12c7070f-83e5-453b-96d0-90770d2cf942
ARO_SUBSCRIPTION_NAME=Azure subscription for mitaei
ARO_SUBSCRIPTION_OWNERS=christy.walsh@mitaei.net joseph.tingiris@mitaei.net
ARO_VERIFY_QUOTA_NAMES=Standard DSv3 Family vCPUs Standard Dv2 Family vCPUs
</code></pre>

<h4 id="81-verify-subscription-name">8.1 - Verify Subscription Name</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-list">https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-list</a></li>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-show">https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-show</a></li>
<li><a href="https://portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade">https://portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az account list --output table
az account show --subscription &quot;${ARO_SUBSCRIPTION_ID}&quot; --query &quot;[{subscription_name:name},{subscription_id:id}]&quot;
export AZ_SUBSCRIPTION_NAME=$(az account show --query 'name' --output tsv)
if [ &quot;${AZ_SUBSCRIPTION_NAME}&quot; != &quot;${ARO_SUBSCRIPTION_NAME}&quot; ]; then echo &quot;ERROR! az subscription name \&quot;${AZ_SUBSCRIPTION_NAME}\&quot; does not match aro subscription name \&quot;${ARO_SUBSCRIPTION_NAME}\&quot;&quot;; fi
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>Name                           CloudName    SubscriptionId                        State    IsDefault
-----------------------------  -----------  ------------------------------------  -------  -----------
N/A(tenant level account)      AzureCloud   fe47e621-b8dd-44c8-ba00-c07e41e4b3d1  Enabled  False
N/A(tenant level account)      AzureCloud   300a380f-b8d0-46c1-be0e-3b8e1af971b6  Enabled  False
AP_BASE                        AzureCloud   54f592d8-63d3-48f3-9f92-a15651f96255  Enabled  False
Azure subscription for mitaei  AzureCloud   12c7070f-83e5-453b-96d0-90770d2cf942  Enabled  True
</code></pre>

<pre><code>[
  {
    &quot;subscription_name&quot;: &quot;Azure subscription for mitaei&quot;
  },
  {
    &quot;subscription_id&quot;: &quot;12c7070f-83e5-453b-96d0-90770d2cf942&quot;
  }
]
</code></pre>

<h4 id="82-verify-subscription-id">8.2 - Verify Subscription ID</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-list">https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-list</a></li>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-show">https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az account show --subscription &quot;${ARO_SUBSCRIPTION_ID}&quot; --query &quot;[{subscription_name:name},{subscription_id:id}]&quot;
export AZ_SUBSCRIPTION_ID=$(az account show --query 'id' --output tsv 2&gt; /dev/null)
if [ &quot;${AZ_SUBSCRIPTION_ID}&quot; != &quot;${ARO_SUBSCRIPTION_ID}&quot; ]; then echo &quot;ERROR! az subscription name \&quot;${AZ_SUBSCRIPTION_ID}\&quot; does not match aro subscription name \&quot;${ARO_SUBSCRIPTION_ID}\&quot;&quot;; fi
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>[
  {
    &quot;subscription_name&quot;: &quot;Azure subscription for mitaei&quot;
  },
  {
    &quot;subscription_id&quot;: &quot;12c7070f-83e5-453b-96d0-90770d2cf942&quot;
  }
]
</code></pre>

<h4 id="83-verify-subscription-location">8.3 - Verify Subscription Location</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Azure Red Hat OpenShift is only available in certain Microsoft geographies, or locations.  Please use the links in the references of this section to determine the most suitable location for the installation.  The location name will be used throughout this document.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://azure.microsoft.com/en-us/global-infrastructure/services/?products=openshift">https://azure.microsoft.com/en-us/global-infrastructure/services/?products=openshift</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az account list-locations --query &quot;[?name=='${ARO_LOCATION_NAME}']&quot; --output table
export AZ_LOCATION_NAME=$(az account list-locations --query &quot;[?name=='${ARO_LOCATION_NAME}'].name&quot; --output tsv)
if [ &quot;${AZ_LOCATION_NAME}&quot; != &quot;${ARO_LOCATION_NAME}&quot; ]; then echo &quot;ERROR! az location name \&quot;${AZ_LOCATION_NAME}\&quot; does not match aro location name \&quot;${ARO_LOCATION_NAME}\&quot;&quot;; fi
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>Name    DisplayName    RegionalDisplayName
------  -------------  ---------------------
eastus  East US        (US) East US
</code></pre>

<h4 id="84-verify-subscription-limits">8.4 - Verify Subscription Limits</h4>
<p>An ARO cluster uses several Microsoft Azure components.  It requires a minimum of 40 Total Regional vCPUs and 36 Standard DSv3 Family vCPUs.</p>
<p><strong><em>The Azure subscription and service limits, quotas, and constraints may be insufficient to install ARO.</em></strong></p>
<p>Default limits vary by offer category types, such as Free Trial and Pay-As-You-Go, and by series, such as Dv2, F, and G. For example, the default for Enterprise Agreement subscriptions is 350 cores.</p>
<p>It is wise to check the limits for the subscription type and if necessary, increase quota limits before the installation of an Azure OpenShift cluster.</p>
<p>ARO minimum limits are required for:</p>
<ul>
<li>Standard DSv3 Family vCPUs</li>
<li>Standard Dv2 Family vCPUs</li>
</ul>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits">https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules">https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/networking/check-usage-against-limits">https://docs.microsoft.com/en-us/azure/networking/check-usage-against-limits</a></li>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az-vm-list-usage">https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az-vm-list-usage</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.5/installing/installing_azure/installing-azure-account.html">https://docs.openshift.com/container-platform/4.5/installing/installing_azure/installing-azure-account.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">if [ &quot;${ARO_VERIFY_QUOTA_NAMES}&quot; == &quot;&quot; ]; then echo &quot;WARNING! ARO_VERIFY_QUOTA_NAMES is not set&quot;; fi
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="85-verify-subscription-quotas">8.5 - Verify Subscription Quotas</h4>
<p>Requesting a quota increase can take 24-48 hours to complete.  The Subscription Owner must do this step.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To increase the quota limits, a support case must be opened with Microsoft. They will communicate directly to the person who requested the increase.  An increase in the VM series quotas will automatically increase the total regional vCPU limit by the same amount.</p>
<p><em>Links to Microsoft's directions on how to request a quota increase are provided in the Reference(s) section.</em></p>
</div>
<p>Ensure the quota increase requests a minimum of 50 for the following VM families, 100 is preferred.</p>
<p>Verify subscription quotas for:</p>
<ul>
<li>Standard DSv3 Family vCPUs</li>
<li>Standard Dv2 Family vCPUs</li>
</ul>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/azure-portal/supportability/per-vm-quota-requests">https://docs.microsoft.com/en-us/azure/azure-portal/supportability/per-vm-quota-requests</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/azure-portal/supportability/regional-quota-requests">https://docs.microsoft.com/en-us/azure/azure-portal/supportability/regional-quota-requests</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">for ARO_VERIFY_QUOTA_NAME in &quot;${ARO_VERIFY_QUOTA_NAMES[@]}&quot;; do echo &quot;ARO_VERIFY_QUOTA_NAME=${ARO_VERIFY_QUOTA_NAME}&quot;; done; unset ARO_VERIFY_QUOTA_NAMES
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<p>ARO_VERIFY_QUOTA_NAME=Standard DSv3 Family vCPUs
ARO_VERIFY_QUOTA_NAME=Standard Dv2 Family vCPUs</p>
<h3 id="9-openshift-administrators">9 - OpenShift Administrators</h3>
<p>Identify the people who will be responsible for administering the OpenShift cluster.  These individuals will need Microsoft accounts and elevated roles and responsibilities.</p>
<p>The details for how to use <code>az</code> to create users, groups, and add the necessary subscription roles is described below.</p>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep -e '^ARO_DOMAIN_NAME'
echo &quot;ARO_ADMINISTRATORS=${ARO_ADMINISTRATORS[@]}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_DOMAIN_NAME=mitaei.net
ARO_ADMINISTRATORS=openshift-admin@mitaei.net arun.babu@mitaei.net joseph.tingiris@mitaei.net sivaprasad.k@mitaei.net
</code></pre>

<h4 id="91-create-administrators">9.1 - Create Administrators</h4>
<p>This is a good time for the Global Administrator to create Microsoft accounts for the OpenShift Administrators.</p>
<p>Ideally, the OpenShift Administrators would also have the Global Administrator role for the tenant.  However, this is not always possible.  If you are the Global Administrator then please take note that the <strong><em>OpenShift Administrators must have Microsoft accounts in the tenant</em></strong>, and their Microsoft accounts must have at least the Contributor and User Access Administrator roles for the Azure Subscription in which ARO is to be deployed.</p>
<p>Creating users may be done with <code>az</code>, via the AAD portal, or [https://admin.microsoft.com].</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The openshift-admin user created is an <strong>example</strong> and should <strong><em>not</em></strong> be used.  We strongly recommend using real names and individual accounts, not ficticous names or group accounts.</p>
</div>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az ad user create --display-name openshift-admin@mitaei.net --user-principal-name openshift-admin@mitaei.net --password &quot;DIl3*lks)-${ARO}-r4d0m!&quot; --force-change-password-next-login
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;accountEnabled&quot;: true,
  &quot;ageGroup&quot;: null,
  &quot;assignedLicenses&quot;: [],
  &quot;assignedPlans&quot;: [],
  &quot;city&quot;: null,
  &quot;companyName&quot;: null,
  &quot;consentProvidedForMinor&quot;: null,
  &quot;country&quot;: null,
  &quot;createdDateTime&quot;: null,
  &quot;creationType&quot;: null,
  &quot;deletionTimestamp&quot;: null,
  &quot;department&quot;: null,
  &quot;dirSyncEnabled&quot;: null,
  &quot;displayName&quot;: &quot;openshift-admin@mitaei.net&quot;,
  &quot;employeeId&quot;: null,
  &quot;facsimileTelephoneNumber&quot;: null,
  &quot;givenName&quot;: null,
  &quot;immutableId&quot;: null,
  &quot;isCompromised&quot;: null,
  &quot;jobTitle&quot;: null,
  &quot;lastDirSyncTime&quot;: null,
  &quot;legalAgeGroupClassification&quot;: null,
  &quot;mail&quot;: null,
  &quot;mailNickname&quot;: &quot;openshift-admin&quot;,
  &quot;mobile&quot;: null,
  &quot;objectId&quot;: &quot;95ccd40a-9c98-4d4f-9846-eaed016e3ef9&quot;,
  &quot;objectType&quot;: &quot;User&quot;,
  &quot;odata.metadata&quot;: &quot;https://graph.windows.net/25fe96e7-85ec-4e6a-b93f-779b16ff751d/$metadata#directoryObjects/@Element&quot;,
  &quot;odata.type&quot;: &quot;Microsoft.DirectoryServices.User&quot;,
  &quot;onPremisesDistinguishedName&quot;: null,
  &quot;onPremisesSecurityIdentifier&quot;: null,
  &quot;otherMails&quot;: [],
  &quot;passwordPolicies&quot;: null,
  &quot;passwordProfile&quot;: {
    &quot;enforceChangePasswordPolicy&quot;: false,
    &quot;forceChangePasswordNextLogin&quot;: true,
    &quot;password&quot;: null
  },
  &quot;physicalDeliveryOfficeName&quot;: null,
  &quot;postalCode&quot;: null,
  &quot;preferredLanguage&quot;: null,
  &quot;provisionedPlans&quot;: [],
  &quot;provisioningErrors&quot;: [],
  &quot;proxyAddresses&quot;: [],
  &quot;refreshTokensValidFromDateTime&quot;: &quot;2020-09-27T02:58:50.8444883Z&quot;,
  &quot;showInAddressList&quot;: null,
  &quot;signInNames&quot;: [],
  &quot;sipProxyAddress&quot;: null,
  &quot;state&quot;: null,
  &quot;streetAddress&quot;: null,
  &quot;surname&quot;: null,
  &quot;telephoneNumber&quot;: null,
  &quot;thumbnailPhoto@odata.mediaEditLink&quot;: &quot;directoryObjects/95ccd40a-9c98-4d4f-9846-eaed016e3ef9/Microsoft.DirectoryServices.User/thumbnailPhoto&quot;,
  &quot;usageLocation&quot;: null,
  &quot;userIdentities&quot;: [],
  &quot;userPrincipalName&quot;: &quot;openshift-admin@mitaei.net&quot;,
  &quot;userState&quot;: null,
  &quot;userStateChangedOn&quot;: null,
  &quot;userType&quot;: &quot;Member&quot;
}
</code></pre>

<h4 id="92-verify-administrators">9.2 - Verify Administrators</h4>
<p>Verify the OpenShift Administrator accounts listed in ${ARO_ADMINISTRATORS} exist.</p>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">for ARO_ADMINISTRATOR in ${ARO_ADMINISTRATORS[@]}; do az ad user show --id ${ARO_ADMINISTRATOR} --query '[{userPrincipalName:userPrincipalName}, {principalId:objectId}]'; if [ $? -ne 0 ]; then echo &quot;WARNING! ${ADMINISTRATOR} aad account was not found&quot;; fi; done
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>[
  {
    &quot;userPrincipalName&quot;: &quot;openshift-admin@mitaei.net&quot;
  },
  {
    &quot;principalId&quot;: &quot;95ccd40a-9c98-4d4f-9846-eaed016e3ef9&quot;
  }
]
[
  {
    &quot;userPrincipalName&quot;: &quot;arun.babu@mitaei.net&quot;
  },
  {
    &quot;principalId&quot;: &quot;4c3b0f6a-3e08-4d7e-9161-2a540bea4dc8&quot;
  }
]
[
  {
    &quot;userPrincipalName&quot;: &quot;joseph.tingiris@mitaei.net&quot;
  },
  {
    &quot;principalId&quot;: &quot;83525d38-8d7f-4476-81aa-14c46c4cb876&quot;
  }
]
[
  {
    &quot;userPrincipalName&quot;: &quot;sivaprasad.k@mitaei.net&quot;
  },
  {
    &quot;principalId&quot;: &quot;26d953e1-003f-4f61-9e68-4f3a5216d8e9&quot;
  }
]
</code></pre>

<h4 id="93-create-administrator-roles">9.3 - Create Administrator Roles</h4>
<p>The <em>Contributor</em> and <em>User Access Administrator</em> subscription roles are required to administer ARO.</p>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">for ARO_ADMINISTRATOR in ${ARO_ADMINISTRATORS[@]}; do az role assignment create --assignee ${ARO_ADMINISTRATOR} --role &quot;Contributor&quot;; if [ $? -ne 0 ]; then echo &quot;ERROR! could not assign Contributor role to ${ARO_ADMINISTRATOR}&quot;; fi; done
for ARO_ADMINISTRATOR in ${ARO_ADMINISTRATORS[@]}; do az role assignment create --assignee ${ARO_ADMINISTRATOR} --role &quot;User Access Administrator&quot;; if [ $? -ne 0 ]; then echo &quot;ERROR! could not assign User Access Administrator role to ${ARO_ADMINISTRATOR}&quot;; fi; done
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/00c1ec40-d6b3-40b0-b784-41c9ab6250f5&quot;,
  &quot;name&quot;: &quot;00c1ec40-d6b3-40b0-b784-41c9ab6250f5&quot;,
  &quot;principalId&quot;: &quot;95ccd40a-9c98-4d4f-9846-eaed016e3ef9&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}

{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/e25a7a15-d599-4cb7-8593-c34c6d31b448&quot;,
  &quot;name&quot;: &quot;e25a7a15-d599-4cb7-8593-c34c6d31b448&quot;,
  &quot;principalId&quot;: &quot;95ccd40a-9c98-4d4f-9846-eaed016e3ef9&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/18d7d88d-d35e-4fb5-a5c3-7773c20a72d9&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}

{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/8f458612-ca5f-4ff2-832a-d00e700975b0&quot;,
  &quot;name&quot;: &quot;8f458612-ca5f-4ff2-832a-d00e700975b0&quot;,
  &quot;principalId&quot;: &quot;4c3b0f6a-3e08-4d7e-9161-2a540bea4dc8&quot;,
  &quot;principalName&quot;: &quot;arun.babu@mitaei.net&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c&quot;,
  &quot;roleDefinitionName&quot;: &quot;Contributor&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}

{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/7f1ba7da-c858-489f-a988-39123faa181f&quot;,
  &quot;name&quot;: &quot;7f1ba7da-c858-489f-a988-39123faa181f&quot;,
  &quot;principalId&quot;: &quot;4c3b0f6a-3e08-4d7e-9161-2a540bea4dc8&quot;,
  &quot;principalName&quot;: &quot;arun.babu@mitaei.net&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/18d7d88d-d35e-4fb5-a5c3-7773c20a72d9&quot;,
  &quot;roleDefinitionName&quot;: &quot;User Access Administrator&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}

{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/6f98e077-c161-453d-a903-b00acb9bd5f2&quot;,
  &quot;name&quot;: &quot;6f98e077-c161-453d-a903-b00acb9bd5f2&quot;,
  &quot;principalId&quot;: &quot;83525d38-8d7f-4476-81aa-14c46c4cb876&quot;,
  &quot;principalName&quot;: &quot;joseph.tingiris@mitaei.net&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c&quot;,
  &quot;roleDefinitionName&quot;: &quot;Contributor&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}

{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/91ea94dc-f9aa-486b-8c92-7c1911bced00&quot;,
  &quot;name&quot;: &quot;91ea94dc-f9aa-486b-8c92-7c1911bced00&quot;,
  &quot;principalId&quot;: &quot;83525d38-8d7f-4476-81aa-14c46c4cb876&quot;,
  &quot;principalName&quot;: &quot;joseph.tingiris@mitaei.net&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/18d7d88d-d35e-4fb5-a5c3-7773c20a72d9&quot;,
  &quot;roleDefinitionName&quot;: &quot;User Access Administrator&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}

{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/1bf7b433-935b-4160-a634-43bd291739c8&quot;,
  &quot;name&quot;: &quot;1bf7b433-935b-4160-a634-43bd291739c8&quot;,
  &quot;principalId&quot;: &quot;26d953e1-003f-4f61-9e68-4f3a5216d8e9&quot;,
  &quot;principalName&quot;: &quot;sivaprasad.k@mitaei.net&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c&quot;,
  &quot;roleDefinitionName&quot;: &quot;Contributor&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}

{
  &quot;canDelegate&quot;: null,
  &quot;condition&quot;: null,
  &quot;conditionVersion&quot;: null,
  &quot;description&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleAssignments/13f30fcc-49ed-45dd-b971-0566b2c3220b&quot;,
  &quot;name&quot;: &quot;13f30fcc-49ed-45dd-b971-0566b2c3220b&quot;,
  &quot;principalId&quot;: &quot;26d953e1-003f-4f61-9e68-4f3a5216d8e9&quot;,
  &quot;principalName&quot;: &quot;sivaprasad.k@mitaei.net&quot;,
  &quot;principalType&quot;: &quot;User&quot;,
  &quot;roleDefinitionId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.Authorization/roleDefinitions/18d7d88d-d35e-4fb5-a5c3-7773c20a72d9&quot;,
  &quot;roleDefinitionName&quot;: &quot;User Access Administrator&quot;,
  &quot;scope&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942&quot;,
  &quot;type&quot;: &quot;Microsoft.Authorization/roleAssignments&quot;
}

</code></pre>

<h4 id="94-verify-administrator-roles">9.4 - Verify Administrator Roles</h4>
<p>Verify all ${ARO_ADMINISTRATORS} have the <em>Contributor</em> and <em>User Access Administrator</em> subscription roles.</p>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">for ARO_ADMINISTRATOR in ${ARO_ADMINISTRATORS[@]}; do az role assignment list --assignee ${ARO_ADMINISTRATOR} --output table; if [ $? -ne 0 ]; then echo &quot;ERROR! failed retrieving subscription roles for \&quot;${ADMINISTRATOR}\&quot;&quot;; fi; echo; done
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>Principal                   Role                       Scope
--------------------------  -------------------------  ---------------------------------------------------
openshift-admin@mitaei.net  User Access Administrator  /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
openshift-admin@mitaei.net  Contributor                /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942

Principal             Role                       Scope
--------------------  -------------------------  ---------------------------------------------------
arun.babu@mitaei.net  User Access Administrator  /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
arun.babu@mitaei.net  Contributor                /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942

Principal                   Role                       Scope
--------------------------  -------------------------  ---------------------------------------------------
joseph.tingiris@mitaei.net  User Access Administrator  /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
joseph.tingiris@mitaei.net  Owner                      /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
joseph.tingiris@mitaei.net  Contributor                /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942

Principal                Role                       Scope
-----------------------  -------------------------  ---------------------------------------------------
sivaprasad.k@mitaei.net  User Access Administrator  /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942
sivaprasad.k@mitaei.net  Contributor                /subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942

</code></pre>

<h3 id="10-resource-providers">10 - Resource Providers</h3>
<p>Make sure you are logged in to Azure via az <code>az login</code> and have the <em>Contributor</em> or <em>Owner</em> role.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul>
<li><em>These steps will fail with only the <strong>User Access Administrator</strong> role.  An unauthorized message will be received.</em></li>
<li><em>These steps will fail without the <strong>--wait</strong> flag.  Dependent providers are automatically registered and they must be registered first.</em></li>
</ul>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types">https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">echo &quot;ARO_RESOURCE_PROVIDERS=${ARO_RESOURCE_PROVIDERS[@]}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_RESOURCE_PROVIDERS=Microsoft.Compute Microsoft.RedHatOpenShift Microsoft.Storage
</code></pre>

<h4 id="101-register-provider-microsoftcompute">10.1 - Register Provider Microsoft.Compute</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_register">https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_register</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az provider register -n Microsoft.Compute --wait
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="102-verify-provider-microsoftcompute">10.2 - Verify Provider Microsoft.Compute</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show">https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az provider show --namespace Microsoft.Compute --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Namespace          RegistrationPolicy    RegistrationState
-----------------  --------------------  -------------------
Microsoft.Compute  RegistrationRequired  Registered
</code></pre>

<h4 id="103-register-provider-microsoftredhatopenshift">10.3 - Register Provider Microsoft.RedHatOpenShift</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_register">https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_register</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az provider register -n Microsoft.RedHatOpenShift --wait
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="104-verify-provider-microsoftredhatopenshift">10.4 - Verify Provider Microsoft.RedHatOpenShift</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show">https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az provider show --namespace Microsoft.RedHatOpenShift --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Namespace                  RegistrationPolicy    RegistrationState
-------------------------  --------------------  -------------------
Microsoft.RedHatOpenShift  RegistrationRequired  Registered
</code></pre>

<h4 id="105-register-provider-microsoftstorage">10.5 - Register Provider Microsoft.Storage</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_register">https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_register</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az provider register -n Microsoft.Storage --wait
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="106-verify-provider-microsoftstorage">10.6 - Verify Provider Microsoft.Storage</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show">https://docs.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az_provider_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az provider show --namespace Microsoft.Storage --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Namespace          RegistrationPolicy    RegistrationState
-----------------  --------------------  -------------------
Microsoft.Storage  RegistrationRequired  Registered
</code></pre>

<h3 id="11-resource-group">11 - Resource Group</h3>
<p>An Azure resource group is a logical group in which Azure resources are deployed and managed.</p>
<p>To create ARO resources, a resource group location must be specified. This is where the physical datacenter is located, where resource group metadata is stored, and where the Azure resources are hosted.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep '^ARO_RESOURCE_GROUP_NAME|^ARO_LOCATION_NAME'
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_LOCATION_NAME=eastus
ARO_RESOURCE_GROUP_NAME=ipm-eastus
</code></pre>

<h4 id="111-create-resource-group">11.1 - Create Resource Group</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest#az-group-create">https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest#az-group-create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az group create --name ${ARO_RESOURCE_GROUP_NAME} --location ${ARO_LOCATION_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus&quot;,
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;managedBy&quot;: null,
  &quot;name&quot;: &quot;ipm-eastus&quot;,
  &quot;properties&quot;: {
    &quot;provisioningState&quot;: &quot;Succeeded&quot;
  },
  &quot;tags&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Resources/resourceGroups&quot;
}
</code></pre>

<h4 id="112-verify-resource-group">11.2 - Verify Resource Group</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest#az-group-show">https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest#az-group-show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az group show --name ${ARO_RESOURCE_GROUP_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus&quot;,
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;managedBy&quot;: null,
  &quot;name&quot;: &quot;ipm-eastus&quot;,
  &quot;properties&quot;: {
    &quot;provisioningState&quot;: &quot;Succeeded&quot;
  },
  &quot;tags&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Resources/resourceGroups&quot;
}
</code></pre>

<h3 id="12-virtual-network">12 - Virtual Network</h3>
<p>An Azure Virtual Network (VNet) is the fundamental building block for private networks in Azure. VNet enables many types of Azure resources, such as Azure Virtual Machines (VM), to securely communicate with each other, the internet, and on-premises networks. VNet is similar to a traditional network that you'd operate in your own data center, but brings with it additional benefits of Azure's infrastructure such as scale, availability, and isolation.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview">https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | grep ^ARO_VNET | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_VNET_CIDR=10.10.0.0/16
ARO_VNET_NAME=ipm-vnet
</code></pre>

<h4 id="121-create-virtual-network">12.1 - Create Virtual Network</h4>
<p>In addition to the VNet CIDR, to be able to route to the Service &amp; POD CIDRs then include them as address prefixes too.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest#az-network-vnet-create">https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest#az-network-vnet-create</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x">https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet create --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VNET_NAME} --address-prefixes ${ARO_VNET_CIDR} ${ARO_SUBNET_SERVICE_CIDR} ${ARO_SUBNET_POD_CIDR}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;newVNet&quot;: {
    &quot;addressSpace&quot;: {
      &quot;addressPrefixes&quot;: [
        &quot;10.10.0.0/16&quot;,
        &quot;10.11.0.0/16&quot;,
        &quot;10.12.0.0/14&quot;
      ]
    },
    &quot;bgpCommunities&quot;: null,
    &quot;ddosProtectionPlan&quot;: null,
    &quot;dhcpOptions&quot;: {
      &quot;dnsServers&quot;: []
    },
    &quot;enableDdosProtection&quot;: false,
    &quot;enableVmProtection&quot;: false,
    &quot;etag&quot;: &quot;W/\&quot;3fe1740b-d54f-4543-bd34-eb70a25c3285\&quot;&quot;,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet&quot;,
    &quot;ipAllocations&quot;: null,
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;name&quot;: &quot;ipm-vnet&quot;,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;e6da571b-7213-4fa5-ad7b-9164be85e48a&quot;,
    &quot;subnets&quot;: [],
    &quot;tags&quot;: {},
    &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks&quot;,
    &quot;virtualNetworkPeerings&quot;: []
  }
}
</code></pre>

<h4 id="122-verify-virtual-network">12.2 - Verify Virtual Network</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest#az-network-vnet-show">https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest#az-network-vnet-show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VNET_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressSpace&quot;: {
    &quot;addressPrefixes&quot;: [
      &quot;10.10.0.0/16&quot;,
      &quot;10.11.0.0/16&quot;,
      &quot;10.12.0.0/14&quot;
    ]
  },
  &quot;bgpCommunities&quot;: null,
  &quot;ddosProtectionPlan&quot;: null,
  &quot;dhcpOptions&quot;: {
    &quot;dnsServers&quot;: []
  },
  &quot;enableDdosProtection&quot;: false,
  &quot;enableVmProtection&quot;: false,
  &quot;etag&quot;: &quot;W/\&quot;3fe1740b-d54f-4543-bd34-eb70a25c3285\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;name&quot;: &quot;ipm-vnet&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceGuid&quot;: &quot;e6da571b-7213-4fa5-ad7b-9164be85e48a&quot;,
  &quot;subnets&quot;: [],
  &quot;tags&quot;: {},
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks&quot;,
  &quot;virtualNetworkPeerings&quot;: []
}
</code></pre>

<h3 id="13-openshift-subnets">13 - OpenShift Subnets</h3>
<p>Before installing, Azure Red Hat OpenShift clusters require manually creating a virtual network with two empty subnets for the master and worker VMs.   Additionally, the Pod &amp; Service subnets will automatically assigned during the installation.  The networks must be in the same resource group.  The network numbers should be IPv4 RFC1918 compliant and prefixed.</p>
<p>Additional subnets are needed for related virtual machines and a VPN.  The VPN subnet must be named GatewaySubnet.</p>
<p>These are the subnets used in this document, and the suggested CIDR prefixes for installing ARO and IPM.</p>
<ul>
<li>10.10.0.0/16 - VNet</li>
<li>10.10.0.0/23 - Master</li>
<li>10.10.2.0/23 - Worker</li>
<li>10.10.10.0/24 - VPN Gateway (GatewaySubnet)</li>
<li>10.10.11.0/24 - Application Gateway</li>
<li>10.10.12.0/24 - Database</li>
<li>10.10.13.0/24 - DMZ</li>
<li>10.10.14.0/24 - Trusted</li>
<li>10.11.0.0/16 - Service</li>
<li>10.12.4.0/14 - Pod</li>
<li>172.16.13.0/24 - VPN Gateway (Pool)</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul>
<li>Pod and Service Network CIDRs are configurable.</li>
<li>Workers and masters must be in different subnets.</li>
<li>Workers and masters virtual network subnets should be minimum /27.</li>
<li>Pod CIDR should be minimum /18 in size.</li>
<li>The pod network is non-routable IPs, and is only used inside the OpenShift SDN.</li>
<li>Each node is allocated /23 subnet (512 IPs) for its pods. This value cannot be changed.</li>
<li>You cannot attach a pod to multiple networks.</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In 2018, Microsoft started automatically enabling Network Watcher when a new vnet is created.  There is not strictly required for ARO and there is an additional cost associated.  This will be seen as a new resource group named NetworkWatcherRG and a new vnet named NetworkWatercher_<region>; Please see the references in this section for more details.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-create">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-create</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/openshift/concepts-networking">https://docs.microsoft.com/en-us/azure/openshift/concepts-networking</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview">https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview</a></li>
<li><a href="https://azure.microsoft.com/en-us/updates/azure-network-watcher-will-be-enabled-by-default-for-subscriptions-containing-virtual-networks/">https://azure.microsoft.com/en-us/updates/azure-network-watcher-will-be-enabled-by-default-for-subscriptions-containing-virtual-networks/</a></li>
<li><a href="https://azure.microsoft.com/en-us/pricing/details/network-watcher/">https://azure.microsoft.com/en-us/pricing/details/network-watcher/</a></li>
<li><a href="https://docs.openshift.com/aro/4/networking/understanding-networking.html">https://docs.openshift.com/aro/4/networking/understanding-networking.html</a></li>
<li><a href="https://tools.ietf.org/html/rfc1918">https://tools.ietf.org/html/rfc1918</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | grep ^ARO_SUBNET | egrep -e 'MASTER|WORKER' | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_SUBNET_MASTER_CIDR=10.10.0.0/23
ARO_SUBNET_MASTER_NAME=ipm-vnet-master-subnet
ARO_SUBNET_MASTER_NSG_NAME=ipm-vnet-master-subnet-nsg
ARO_SUBNET_WORKER_CIDR=10.10.2.0/23
ARO_SUBNET_WORKER_NAME=ipm-vnet-worker-subnet
ARO_SUBNET_WORKER_NSG_NAME=ipm-vnet-worker-subnet-nsg
</code></pre>

<h4 id="131-verify-openshift-cluster">13.1 - Verify OpenShift Cluster</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest#az_aro_show">https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest#az_aro_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az aro show --name &quot;${ARO_CLUSTER_NAME}&quot; --resource-group &quot;${ARO_RESOURCE_GROUP_NAME}&quot; --output table 2&gt; /dev/null; if [ $? -eq 0 ]; then echo &quot;ERROR! ARO cluster ${ARO_CLUSTER_NAME} exists; do not recreate the master or worker subnets&quot;; fi
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="132-create-master-subnet">13.2 - Create Master Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x">https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet create --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_MASTER_NAME} --address-prefixes ${ARO_SUBNET_MASTER_CIDR} --service-endpoints Microsoft.ContainerRegistry
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressPrefix&quot;: &quot;10.10.0.0/23&quot;,
  &quot;addressPrefixes&quot;: null,
  &quot;delegations&quot;: [],
  &quot;etag&quot;: &quot;W/\&quot;a4a4f3f3-7031-4349-a4db-918e078ca7ad\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-master-subnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;ipConfigurationProfiles&quot;: null,
  &quot;ipConfigurations&quot;: null,
  &quot;name&quot;: &quot;ipm-vnet-master-subnet&quot;,
  &quot;natGateway&quot;: null,
  &quot;networkSecurityGroup&quot;: null,
  &quot;privateEndpointNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;privateEndpoints&quot;: null,
  &quot;privateLinkServiceNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;purpose&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceNavigationLinks&quot;: null,
  &quot;routeTable&quot;: null,
  &quot;serviceAssociationLinks&quot;: null,
  &quot;serviceEndpointPolicies&quot;: null,
  &quot;serviceEndpoints&quot;: [
    {
      &quot;locations&quot;: [
        &quot;*&quot;
      ],
      &quot;provisioningState&quot;: &quot;Succeeded&quot;,
      &quot;service&quot;: &quot;Microsoft.ContainerRegistry&quot;
    }
  ],
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks/subnets&quot;
}
</code></pre>

<h4 id="133-disable-master-subnet-private-link-service">13.3 - Disable Master Subnet Private Link Service</h4>
<p>This is required to be able to connect and manage the cluster.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_update">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_update</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x">https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet update --name ${ARO_SUBNET_MASTER_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --disable-private-link-service-network-policies true
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressPrefix&quot;: &quot;10.10.0.0/23&quot;,
  &quot;addressPrefixes&quot;: null,
  &quot;delegations&quot;: [],
  &quot;etag&quot;: &quot;W/\&quot;9611966b-4097-4d4f-bc93-b42cc963488a\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-master-subnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;ipConfigurationProfiles&quot;: null,
  &quot;ipConfigurations&quot;: null,
  &quot;name&quot;: &quot;ipm-vnet-master-subnet&quot;,
  &quot;natGateway&quot;: null,
  &quot;networkSecurityGroup&quot;: null,
  &quot;privateEndpointNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;privateEndpoints&quot;: null,
  &quot;privateLinkServiceNetworkPolicies&quot;: &quot;Disabled&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;purpose&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceNavigationLinks&quot;: null,
  &quot;routeTable&quot;: null,
  &quot;serviceAssociationLinks&quot;: null,
  &quot;serviceEndpointPolicies&quot;: null,
  &quot;serviceEndpoints&quot;: [
    {
      &quot;locations&quot;: [
        &quot;*&quot;
      ],
      &quot;provisioningState&quot;: &quot;Succeeded&quot;,
      &quot;service&quot;: &quot;Microsoft.ContainerRegistry&quot;
    }
  ],
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks/subnets&quot;
}
</code></pre>

<h4 id="134-verify-master-subnet">13.4 - Verify Master Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_MASTER_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">AddressPrefix    Name                    PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  ----------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.10.0.0/23     ipm-vnet-master-subnet  Enabled                           Disabled                             Succeeded            ipm-eastus
</code></pre>

<h4 id="135-create-worker-subnet">13.5 - Create Worker Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x">https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet create --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_WORKER_NAME} --address-prefixes ${ARO_SUBNET_WORKER_CIDR} --service-endpoints Microsoft.ContainerRegistry
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressPrefix&quot;: &quot;10.10.2.0/23&quot;,
  &quot;addressPrefixes&quot;: null,
  &quot;delegations&quot;: [],
  &quot;etag&quot;: &quot;W/\&quot;5ab0e900-d3cf-4f86-a3d8-c447f29eb66c\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-worker-subnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;ipConfigurationProfiles&quot;: null,
  &quot;ipConfigurations&quot;: null,
  &quot;name&quot;: &quot;ipm-vnet-worker-subnet&quot;,
  &quot;natGateway&quot;: null,
  &quot;networkSecurityGroup&quot;: null,
  &quot;privateEndpointNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;privateEndpoints&quot;: null,
  &quot;privateLinkServiceNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;purpose&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceNavigationLinks&quot;: null,
  &quot;routeTable&quot;: null,
  &quot;serviceAssociationLinks&quot;: null,
  &quot;serviceEndpointPolicies&quot;: null,
  &quot;serviceEndpoints&quot;: [
    {
      &quot;locations&quot;: [
        &quot;*&quot;
      ],
      &quot;provisioningState&quot;: &quot;Succeeded&quot;,
      &quot;service&quot;: &quot;Microsoft.ContainerRegistry&quot;
    }
  ],
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks/subnets&quot;
}
</code></pre>

<h4 id="136-verify-worker-subnet">13.6 - Verify Worker Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_WORKER_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">AddressPrefix    Name                    PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  ----------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.10.2.0/23     ipm-vnet-worker-subnet  Enabled                           Enabled                              Succeeded            ipm-eastus
</code></pre>

<h3 id="14-network-security-groups">14 - Network Security Groups</h3>
<p>An Azure Network Security Group (NSG) filters network traffic to and from Azure resources in an Azure virtual network. An NSG contains security rules that allow/deny network traffic to/from several types of Azure resources.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><em>The Network Security Groups for the Master &amp; Worker subnets will be automatically created when ARO is setup.</em></li>
<li><em>The Network Security Group for the GatewaySubnet will be created when the VPN Gateway is setup.</em></li>
</ul>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/nsg?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/network/nsg?view=azure-cli-latest</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep -e 'ARO_SUBNET(.*)NSG' | egrep -ve 'MASTER|WORKER|VGW' | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_SUBNET_AGW_NSG_NAME=ipm-vnet-agw-subnet-nsg
ARO_SUBNET_DB_NSG_NAME=ipm-vnet-db-subnet-nsg
ARO_SUBNET_DMZ_NSG_NAME=ipm-vnet-dmz-subnet-nsg
ARO_SUBNET_TRUSTED_NSG_NAME=ipm-vnet-trusted-subnet-nsg
</code></pre>

<h4 id="141-create-network-security-groups">14.1 - Create Network Security Groups</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/nsg?view=azure-cli-latest#az_network_nsg_create">https://docs.microsoft.com/en-us/cli/azure/network/nsg?view=azure-cli-latest#az_network_nsg_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network nsg create --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_AGW_NSG_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>{
  &quot;NewNSG&quot;: {
    &quot;defaultSecurityRules&quot;: [
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow inbound traffic from all VMs in VNET&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;9a1dec9f-4adf-43c4-8401-7f5fe1fedaad\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-agw-subnet-nsg/defaultSecurityRules/AllowVnetInBound&quot;,
        &quot;name&quot;: &quot;AllowVnetInBound&quot;,
        &quot;priority&quot;: 65000,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow inbound traffic from azure load balancer&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;9a1dec9f-4adf-43c4-8401-7f5fe1fedaad\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-agw-subnet-nsg/defaultSecurityRules/AllowAzureLoadBalancerInBound&quot;,
        &quot;name&quot;: &quot;AllowAzureLoadBalancerInBound&quot;,
        &quot;priority&quot;: 65001,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;AzureLoadBalancer&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Deny&quot;,
        &quot;description&quot;: &quot;Deny all inbound traffic&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;9a1dec9f-4adf-43c4-8401-7f5fe1fedaad\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-agw-subnet-nsg/defaultSecurityRules/DenyAllInBound&quot;,
        &quot;name&quot;: &quot;DenyAllInBound&quot;,
        &quot;priority&quot;: 65500,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow outbound traffic from all VMs to all VMs in VNET&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;9a1dec9f-4adf-43c4-8401-7f5fe1fedaad\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-agw-subnet-nsg/defaultSecurityRules/AllowVnetOutBound&quot;,
        &quot;name&quot;: &quot;AllowVnetOutBound&quot;,
        &quot;priority&quot;: 65000,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow outbound traffic from all VMs to Internet&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;Internet&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;9a1dec9f-4adf-43c4-8401-7f5fe1fedaad\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-agw-subnet-nsg/defaultSecurityRules/AllowInternetOutBound&quot;,
        &quot;name&quot;: &quot;AllowInternetOutBound&quot;,
        &quot;priority&quot;: 65001,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Deny&quot;,
        &quot;description&quot;: &quot;Deny all outbound traffic&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;9a1dec9f-4adf-43c4-8401-7f5fe1fedaad\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-agw-subnet-nsg/defaultSecurityRules/DenyAllOutBound&quot;,
        &quot;name&quot;: &quot;DenyAllOutBound&quot;,
        &quot;priority&quot;: 65500,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      }
    ],
    &quot;etag&quot;: &quot;W/\&quot;9a1dec9f-4adf-43c4-8401-7f5fe1fedaad\&quot;&quot;,
    &quot;flowLogs&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-agw-subnet-nsg&quot;,
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;name&quot;: &quot;ipm-vnet-agw-subnet-nsg&quot;,
    &quot;networkInterfaces&quot;: null,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;be4701a3-7c2d-492a-a689-adc40198cba7&quot;,
    &quot;securityRules&quot;: [],
    &quot;subnets&quot;: null,
    &quot;tags&quot;: null,
    &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups&quot;
  }
}
{
  &quot;NewNSG&quot;: {
    &quot;defaultSecurityRules&quot;: [
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow inbound traffic from all VMs in VNET&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;54c747c1-0cd8-49b4-b623-ad0a53342f9a\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-db-subnet-nsg/defaultSecurityRules/AllowVnetInBound&quot;,
        &quot;name&quot;: &quot;AllowVnetInBound&quot;,
        &quot;priority&quot;: 65000,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow inbound traffic from azure load balancer&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;54c747c1-0cd8-49b4-b623-ad0a53342f9a\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-db-subnet-nsg/defaultSecurityRules/AllowAzureLoadBalancerInBound&quot;,
        &quot;name&quot;: &quot;AllowAzureLoadBalancerInBound&quot;,
        &quot;priority&quot;: 65001,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;AzureLoadBalancer&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Deny&quot;,
        &quot;description&quot;: &quot;Deny all inbound traffic&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;54c747c1-0cd8-49b4-b623-ad0a53342f9a\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-db-subnet-nsg/defaultSecurityRules/DenyAllInBound&quot;,
        &quot;name&quot;: &quot;DenyAllInBound&quot;,
        &quot;priority&quot;: 65500,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow outbound traffic from all VMs to all VMs in VNET&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;54c747c1-0cd8-49b4-b623-ad0a53342f9a\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-db-subnet-nsg/defaultSecurityRules/AllowVnetOutBound&quot;,
        &quot;name&quot;: &quot;AllowVnetOutBound&quot;,
        &quot;priority&quot;: 65000,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow outbound traffic from all VMs to Internet&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;Internet&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;54c747c1-0cd8-49b4-b623-ad0a53342f9a\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-db-subnet-nsg/defaultSecurityRules/AllowInternetOutBound&quot;,
        &quot;name&quot;: &quot;AllowInternetOutBound&quot;,
        &quot;priority&quot;: 65001,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Deny&quot;,
        &quot;description&quot;: &quot;Deny all outbound traffic&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;54c747c1-0cd8-49b4-b623-ad0a53342f9a\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-db-subnet-nsg/defaultSecurityRules/DenyAllOutBound&quot;,
        &quot;name&quot;: &quot;DenyAllOutBound&quot;,
        &quot;priority&quot;: 65500,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      }
    ],
    &quot;etag&quot;: &quot;W/\&quot;54c747c1-0cd8-49b4-b623-ad0a53342f9a\&quot;&quot;,
    &quot;flowLogs&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-db-subnet-nsg&quot;,
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;name&quot;: &quot;ipm-vnet-db-subnet-nsg&quot;,
    &quot;networkInterfaces&quot;: null,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;a58d572b-dfba-4a3e-b95e-a7c131b01f62&quot;,
    &quot;securityRules&quot;: [],
    &quot;subnets&quot;: null,
    &quot;tags&quot;: null,
    &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups&quot;
  }
}
{
  &quot;NewNSG&quot;: {
    &quot;defaultSecurityRules&quot;: [
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow inbound traffic from all VMs in VNET&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;7152f348-c858-4b09-9a4e-f6963fc67291\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg/defaultSecurityRules/AllowVnetInBound&quot;,
        &quot;name&quot;: &quot;AllowVnetInBound&quot;,
        &quot;priority&quot;: 65000,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow inbound traffic from azure load balancer&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;7152f348-c858-4b09-9a4e-f6963fc67291\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg/defaultSecurityRules/AllowAzureLoadBalancerInBound&quot;,
        &quot;name&quot;: &quot;AllowAzureLoadBalancerInBound&quot;,
        &quot;priority&quot;: 65001,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;AzureLoadBalancer&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Deny&quot;,
        &quot;description&quot;: &quot;Deny all inbound traffic&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;7152f348-c858-4b09-9a4e-f6963fc67291\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg/defaultSecurityRules/DenyAllInBound&quot;,
        &quot;name&quot;: &quot;DenyAllInBound&quot;,
        &quot;priority&quot;: 65500,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow outbound traffic from all VMs to all VMs in VNET&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;7152f348-c858-4b09-9a4e-f6963fc67291\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg/defaultSecurityRules/AllowVnetOutBound&quot;,
        &quot;name&quot;: &quot;AllowVnetOutBound&quot;,
        &quot;priority&quot;: 65000,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow outbound traffic from all VMs to Internet&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;Internet&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;7152f348-c858-4b09-9a4e-f6963fc67291\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg/defaultSecurityRules/AllowInternetOutBound&quot;,
        &quot;name&quot;: &quot;AllowInternetOutBound&quot;,
        &quot;priority&quot;: 65001,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Deny&quot;,
        &quot;description&quot;: &quot;Deny all outbound traffic&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;7152f348-c858-4b09-9a4e-f6963fc67291\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg/defaultSecurityRules/DenyAllOutBound&quot;,
        &quot;name&quot;: &quot;DenyAllOutBound&quot;,
        &quot;priority&quot;: 65500,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      }
    ],
    &quot;etag&quot;: &quot;W/\&quot;7152f348-c858-4b09-9a4e-f6963fc67291\&quot;&quot;,
    &quot;flowLogs&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg&quot;,
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;name&quot;: &quot;ipm-vnet-dmz-subnet-nsg&quot;,
    &quot;networkInterfaces&quot;: null,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;ed09e48f-c160-4d63-ad0c-a6df53b6e9eb&quot;,
    &quot;securityRules&quot;: [],
    &quot;subnets&quot;: null,
    &quot;tags&quot;: null,
    &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups&quot;
  }
}
{
  &quot;NewNSG&quot;: {
    &quot;defaultSecurityRules&quot;: [
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow inbound traffic from all VMs in VNET&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;b420118b-11d2-490f-b07c-b6201dc54b50\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-trusted-subnet-nsg/defaultSecurityRules/AllowVnetInBound&quot;,
        &quot;name&quot;: &quot;AllowVnetInBound&quot;,
        &quot;priority&quot;: 65000,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow inbound traffic from azure load balancer&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;b420118b-11d2-490f-b07c-b6201dc54b50\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-trusted-subnet-nsg/defaultSecurityRules/AllowAzureLoadBalancerInBound&quot;,
        &quot;name&quot;: &quot;AllowAzureLoadBalancerInBound&quot;,
        &quot;priority&quot;: 65001,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;AzureLoadBalancer&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Deny&quot;,
        &quot;description&quot;: &quot;Deny all inbound traffic&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Inbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;b420118b-11d2-490f-b07c-b6201dc54b50\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-trusted-subnet-nsg/defaultSecurityRules/DenyAllInBound&quot;,
        &quot;name&quot;: &quot;DenyAllInBound&quot;,
        &quot;priority&quot;: 65500,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow outbound traffic from all VMs to all VMs in VNET&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;b420118b-11d2-490f-b07c-b6201dc54b50\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-trusted-subnet-nsg/defaultSecurityRules/AllowVnetOutBound&quot;,
        &quot;name&quot;: &quot;AllowVnetOutBound&quot;,
        &quot;priority&quot;: 65000,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;VirtualNetwork&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Allow&quot;,
        &quot;description&quot;: &quot;Allow outbound traffic from all VMs to Internet&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;Internet&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;b420118b-11d2-490f-b07c-b6201dc54b50\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-trusted-subnet-nsg/defaultSecurityRules/AllowInternetOutBound&quot;,
        &quot;name&quot;: &quot;AllowInternetOutBound&quot;,
        &quot;priority&quot;: 65001,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      },
      {
        &quot;access&quot;: &quot;Deny&quot;,
        &quot;description&quot;: &quot;Deny all outbound traffic&quot;,
        &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
        &quot;destinationAddressPrefixes&quot;: [],
        &quot;destinationApplicationSecurityGroups&quot;: null,
        &quot;destinationPortRange&quot;: &quot;*&quot;,
        &quot;destinationPortRanges&quot;: [],
        &quot;direction&quot;: &quot;Outbound&quot;,
        &quot;etag&quot;: &quot;W/\&quot;b420118b-11d2-490f-b07c-b6201dc54b50\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-trusted-subnet-nsg/defaultSecurityRules/DenyAllOutBound&quot;,
        &quot;name&quot;: &quot;DenyAllOutBound&quot;,
        &quot;priority&quot;: 65500,
        &quot;protocol&quot;: &quot;*&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
        &quot;sourceAddressPrefixes&quot;: [],
        &quot;sourceApplicationSecurityGroups&quot;: null,
        &quot;sourcePortRange&quot;: &quot;*&quot;,
        &quot;sourcePortRanges&quot;: [],
        &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/defaultSecurityRules&quot;
      }
    ],
    &quot;etag&quot;: &quot;W/\&quot;b420118b-11d2-490f-b07c-b6201dc54b50\&quot;&quot;,
    &quot;flowLogs&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-trusted-subnet-nsg&quot;,
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;name&quot;: &quot;ipm-vnet-trusted-subnet-nsg&quot;,
    &quot;networkInterfaces&quot;: null,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;b415518e-9aa4-447c-abbe-80ebea22c62b&quot;,
    &quot;securityRules&quot;: [],
    &quot;subnets&quot;: null,
    &quot;tags&quot;: null,
    &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups&quot;
  }
}
</code></pre>

<h4 id="142-verify-network-security-groups">14.2 - Verify Network Security Groups</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/nsg?view=azure-cli-latest#az_network_nsg_show">https://docs.microsoft.com/en-us/cli/azure/network/nsg?view=azure-cli-latest#az_network_nsg_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_AGW_NSG_NAME} --output table &amp;&amp; echo
az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_DB_NSG_NAME} --output table &amp;&amp; echo
az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_DMZ_NSG_NAME} --output table &amp;&amp; echo
az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_TRUSTED_NSG_NAME} --output table &amp;&amp; echo
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>Location    Name                     ProvisioningState    ResourceGroup    ResourceGuid
----------  -----------------------  -------------------  ---------------  ------------------------------------
eastus      ipm-vnet-agw-subnet-nsg  Succeeded            ipm-eastus       be4701a3-7c2d-492a-a689-adc40198cba7

Location    Name                    ProvisioningState    ResourceGroup    ResourceGuid
----------  ----------------------  -------------------  ---------------  ------------------------------------
eastus      ipm-vnet-db-subnet-nsg  Succeeded            ipm-eastus       a58d572b-dfba-4a3e-b95e-a7c131b01f62

Location    Name                     ProvisioningState    ResourceGroup    ResourceGuid
----------  -----------------------  -------------------  ---------------  ------------------------------------
eastus      ipm-vnet-dmz-subnet-nsg  Succeeded            ipm-eastus       ed09e48f-c160-4d63-ad0c-a6df53b6e9eb

Location    Name                         ProvisioningState    ResourceGroup    ResourceGuid
----------  ---------------------------  -------------------  ---------------  ------------------------------------
eastus      ipm-vnet-trusted-subnet-nsg  Succeeded            ipm-eastus       b415518e-9aa4-447c-abbe-80ebea22c62b

</code></pre>

<h3 id="15-network-security-group-rules">15 - Network Security Group Rules</h3>
<p>Network Security Group (NSG) Rules are evaluated by priority using the 5-tuple information (source, source port, destination, destination port, and protocol) to allow or deny the traffic. A flow record is created for existing connections. Communication is allowed or denied based on the connection state of the flow record. The flow record allows an NSG to be stateful.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | grep ARO.*NSG | egrep -ve 'MASTER|WORKER|VGW' | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_SUBNET_AGW_NSG_NAME=ipm-vnet-agw-subnet-nsg
ARO_SUBNET_DB_NSG_NAME=ipm-vnet-db-subnet-nsg
ARO_SUBNET_DMZ_NSG_NAME=ipm-vnet-dmz-subnet-nsg
ARO_SUBNET_TRUSTED_NSG_NAME=ipm-vnet-trusted-subnet-nsg
</code></pre>

<h4 id="151-create-dmz-nsg-rule-allowssh">15.1 - Create DMZ NSG Rule (AllowSSH)</h4>
<p>To be able to access the Jump Server (jumpbox) via the Internet, without a VPN setup, tcp port 22 must be opened for ssh.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/nsg/rule?view=azure-cli-latest#az_network_nsg_rule_create">https://docs.microsoft.com/en-us/cli/azure/network/nsg/rule?view=azure-cli-latest#az_network_nsg_rule_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network nsg rule create --resource-group ${ARO_RESOURCE_GROUP_NAME} --nsg-name ${ARO_SUBNET_DMZ_NSG_NAME} --name AllowSSH --protocol tcp --priority 1000 --destination-port-range 22 --access allow
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;access&quot;: &quot;Allow&quot;,
  &quot;description&quot;: null,
  &quot;destinationAddressPrefix&quot;: &quot;*&quot;,
  &quot;destinationAddressPrefixes&quot;: [],
  &quot;destinationApplicationSecurityGroups&quot;: null,
  &quot;destinationPortRange&quot;: &quot;22&quot;,
  &quot;destinationPortRanges&quot;: [],
  &quot;direction&quot;: &quot;Inbound&quot;,
  &quot;etag&quot;: &quot;W/\&quot;fafcaf82-35be-48e1-9461-561a4b71e119\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg/securityRules/AllowSSH&quot;,
  &quot;name&quot;: &quot;AllowSSH&quot;,
  &quot;priority&quot;: 1000,
  &quot;protocol&quot;: &quot;Tcp&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;sourceAddressPrefix&quot;: &quot;*&quot;,
  &quot;sourceAddressPrefixes&quot;: [],
  &quot;sourceApplicationSecurityGroups&quot;: null,
  &quot;sourcePortRange&quot;: &quot;*&quot;,
  &quot;sourcePortRanges&quot;: [],
  &quot;type&quot;: &quot;Microsoft.Network/networkSecurityGroups/securityRules&quot;
}
</code></pre>

<h4 id="152-verify-dmz-nsg-rules">15.2 - Verify DMZ NSG Rules</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/nsg/rule?view=azure-cli-latest#az_network_nsg_rule_show">https://docs.microsoft.com/en-us/cli/azure/network/nsg/rule?view=azure-cli-latest#az_network_nsg_rule_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network nsg show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_SUBNET_DMZ_NSG_NAME} --query securityRules --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">Protocol    SourcePortRange    DestinationPortRange    SourceAddressPrefix    DestinationAddressPrefix    Access    Priority    Direction    ProvisioningState    Name      ResourceGroup
----------  -----------------  ----------------------  ---------------------  --------------------------  --------  ----------  -----------  -------------------  --------  ---------------
Tcp         *                  22                      *                      *                           Allow     1000        Inbound      Succeeded            AllowSSH  ipm-eastus
</code></pre>

<h3 id="16-related-subnets">16 - Related Subnets</h3>
<p>IBM Product Manager requires related subnets for supplementary virtual machines, to host applications such as DB2.  These subnets should be within the same resource group and VNet range previously defined.  The network numbers should be IPv4 RFC1918 compliant and prefixed.</p>
<p>These are the subnets used in this document, and the suggested CIDR prefixes for installing ARO and IPM.</p>
<ul>
<li>10.10.0.0/16 - VNet</li>
<li>10.10.0.0/23 - Master</li>
<li>10.10.2.0/23 - Worker</li>
<li>10.10.10.0/24 - VPN Gateway (GatewaySubnet)</li>
<li>10.10.11.0/24 - Application Gateway</li>
<li>10.10.12.0/24 - Database</li>
<li>10.10.13.0/24 - DMZ</li>
<li>10.10.14.0/24 - Trusted</li>
<li>10.11.0.0/16 - Service</li>
<li>10.12.4.0/14 - Pod</li>
<li>172.16.13.0/24 - VPN Gateway (Pool)</li>
</ul>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x">https://docs.microsoft.com/en-us/azure/openshift/howto-create-private-cluster-4x</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview">https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview</a></li>
<li><a href="https://azure.microsoft.com/en-us/updates/azure-network-watcher-will-be-enabled-by-default-for-subscriptions-containing-virtual-networks/">https://azure.microsoft.com/en-us/updates/azure-network-watcher-will-be-enabled-by-default-for-subscriptions-containing-virtual-networks/</a></li>
<li><a href="https://azure.microsoft.com/en-us/pricing/details/network-watcher/">https://azure.microsoft.com/en-us/pricing/details/network-watcher/</a></li>
<li><a href="https://tools.ietf.org/html/rfc1918">https://tools.ietf.org/html/rfc1918</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | grep ^ARO_SUBNET | egrep -ve 'MASTER|WORKER|VGW' | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code>ARO_SUBNET_AGW_CIDR=10.10.11.0/24
ARO_SUBNET_AGW_NAME=ipm-vnet-agw-subnet
ARO_SUBNET_AGW_NSG_NAME=ipm-vnet-agw-subnet-nsg
ARO_SUBNET_DB_CIDR=10.10.12.0/24
ARO_SUBNET_DB_NAME=ipm-vnet-db-subnet
ARO_SUBNET_DB_NSG_NAME=ipm-vnet-db-subnet-nsg
ARO_SUBNET_DMZ_CIDR=10.10.13.0/24
ARO_SUBNET_DMZ_NAME=ipm-vnet-dmz-subnet
ARO_SUBNET_DMZ_NSG_NAME=ipm-vnet-dmz-subnet-nsg
ARO_SUBNET_POD_CIDR=10.12.0.0/14
ARO_SUBNET_SERVICE_CIDR=10.11.0.0/16
ARO_SUBNET_TRUSTED_CIDR=10.10.14.0/24
ARO_SUBNET_TRUSTED_NAME=ipm-vnet-trusted-subnet
ARO_SUBNET_TRUSTED_NSG_NAME=ipm-vnet-trusted-subnet-nsg
</code></pre>

<h4 id="161-create-application-gateway-subnet">16.1 - Create Application Gateway Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet create --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_AGW_NAME} --address-prefixes ${ARO_SUBNET_AGW_CIDR} --network-security-group=${ARO_SUBNET_AGW_NSG_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressPrefix&quot;: &quot;10.10.11.0/24&quot;,
  &quot;addressPrefixes&quot;: null,
  &quot;delegations&quot;: [],
  &quot;etag&quot;: &quot;W/\&quot;e4ad09d4-d5f7-4a42-872f-8821dcd23248\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-agw-subnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;ipConfigurationProfiles&quot;: null,
  &quot;ipConfigurations&quot;: null,
  &quot;name&quot;: &quot;ipm-vnet-agw-subnet&quot;,
  &quot;natGateway&quot;: null,
  &quot;networkSecurityGroup&quot;: {
    &quot;defaultSecurityRules&quot;: null,
    &quot;etag&quot;: null,
    &quot;flowLogs&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-agw-subnet-nsg&quot;,
    &quot;location&quot;: null,
    &quot;name&quot;: null,
    &quot;networkInterfaces&quot;: null,
    &quot;provisioningState&quot;: null,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: null,
    &quot;securityRules&quot;: null,
    &quot;subnets&quot;: null,
    &quot;tags&quot;: null,
    &quot;type&quot;: null
  },
  &quot;privateEndpointNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;privateEndpoints&quot;: null,
  &quot;privateLinkServiceNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;purpose&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceNavigationLinks&quot;: null,
  &quot;routeTable&quot;: null,
  &quot;serviceAssociationLinks&quot;: null,
  &quot;serviceEndpointPolicies&quot;: null,
  &quot;serviceEndpoints&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks/subnets&quot;
}
</code></pre>

<h4 id="162-verify-application-gateway-subnet">16.2 - Verify Application Gateway Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_AGW_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">AddressPrefix    Name                 PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  -------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.10.11.0/24    ipm-vnet-agw-subnet  Enabled                           Enabled                              Succeeded            ipm-eastus
</code></pre>

<h4 id="163-create-database-subnet">16.3 - Create Database Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet create --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_DB_NAME} --address-prefixes ${ARO_SUBNET_DB_CIDR} --network-security-group=${ARO_SUBNET_DB_NSG_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressPrefix&quot;: &quot;10.10.12.0/24&quot;,
  &quot;addressPrefixes&quot;: null,
  &quot;delegations&quot;: [],
  &quot;etag&quot;: &quot;W/\&quot;2aa8c48d-8c85-4eee-98ff-19d5a5f9e6dd\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-db-subnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;ipConfigurationProfiles&quot;: null,
  &quot;ipConfigurations&quot;: null,
  &quot;name&quot;: &quot;ipm-vnet-db-subnet&quot;,
  &quot;natGateway&quot;: null,
  &quot;networkSecurityGroup&quot;: {
    &quot;defaultSecurityRules&quot;: null,
    &quot;etag&quot;: null,
    &quot;flowLogs&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-db-subnet-nsg&quot;,
    &quot;location&quot;: null,
    &quot;name&quot;: null,
    &quot;networkInterfaces&quot;: null,
    &quot;provisioningState&quot;: null,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: null,
    &quot;securityRules&quot;: null,
    &quot;subnets&quot;: null,
    &quot;tags&quot;: null,
    &quot;type&quot;: null
  },
  &quot;privateEndpointNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;privateEndpoints&quot;: null,
  &quot;privateLinkServiceNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;purpose&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceNavigationLinks&quot;: null,
  &quot;routeTable&quot;: null,
  &quot;serviceAssociationLinks&quot;: null,
  &quot;serviceEndpointPolicies&quot;: null,
  &quot;serviceEndpoints&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks/subnets&quot;
}
</code></pre>

<h4 id="164-verify-database-subnet">16.4 - Verify Database Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_DB_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">AddressPrefix    Name                PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  ------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.10.12.0/24    ipm-vnet-db-subnet  Enabled                           Enabled                              Succeeded            ipm-eastus
</code></pre>

<h4 id="165-create-dmz-subnet">16.5 - Create DMZ Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet create --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_DMZ_NAME} --address-prefixes ${ARO_SUBNET_DMZ_CIDR} --network-security-group=${ARO_SUBNET_DMZ_NSG_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressPrefix&quot;: &quot;10.10.13.0/24&quot;,
  &quot;addressPrefixes&quot;: null,
  &quot;delegations&quot;: [],
  &quot;etag&quot;: &quot;W/\&quot;026bbc03-cf38-45c8-b813-6283fe479fcc\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-dmz-subnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;ipConfigurationProfiles&quot;: null,
  &quot;ipConfigurations&quot;: null,
  &quot;name&quot;: &quot;ipm-vnet-dmz-subnet&quot;,
  &quot;natGateway&quot;: null,
  &quot;networkSecurityGroup&quot;: {
    &quot;defaultSecurityRules&quot;: null,
    &quot;etag&quot;: null,
    &quot;flowLogs&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg&quot;,
    &quot;location&quot;: null,
    &quot;name&quot;: null,
    &quot;networkInterfaces&quot;: null,
    &quot;provisioningState&quot;: null,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: null,
    &quot;securityRules&quot;: null,
    &quot;subnets&quot;: null,
    &quot;tags&quot;: null,
    &quot;type&quot;: null
  },
  &quot;privateEndpointNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;privateEndpoints&quot;: null,
  &quot;privateLinkServiceNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;purpose&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceNavigationLinks&quot;: null,
  &quot;routeTable&quot;: null,
  &quot;serviceAssociationLinks&quot;: null,
  &quot;serviceEndpointPolicies&quot;: null,
  &quot;serviceEndpoints&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks/subnets&quot;
}
</code></pre>

<h4 id="166-verify-dmz-subnet">16.6 - Verify DMZ Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_DMZ_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">AddressPrefix    Name                 PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  -------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.10.13.0/24    ipm-vnet-dmz-subnet  Enabled                           Enabled                              Succeeded            ipm-eastus
</code></pre>

<h4 id="167-create-trusted-subnet">16.7 - Create Trusted Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet create --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_TRUSTED_NAME} --address-prefixes ${ARO_SUBNET_TRUSTED_CIDR} --network-security-group ${ARO_SUBNET_TRUSTED_NSG_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressPrefix&quot;: &quot;10.10.14.0/24&quot;,
  &quot;addressPrefixes&quot;: null,
  &quot;delegations&quot;: [],
  &quot;etag&quot;: &quot;W/\&quot;40b5794b-9c55-4230-8f97-84ccda8b94e1\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-trusted-subnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;ipConfigurationProfiles&quot;: null,
  &quot;ipConfigurations&quot;: null,
  &quot;name&quot;: &quot;ipm-vnet-trusted-subnet&quot;,
  &quot;natGateway&quot;: null,
  &quot;networkSecurityGroup&quot;: {
    &quot;defaultSecurityRules&quot;: null,
    &quot;etag&quot;: null,
    &quot;flowLogs&quot;: null,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-trusted-subnet-nsg&quot;,
    &quot;location&quot;: null,
    &quot;name&quot;: null,
    &quot;networkInterfaces&quot;: null,
    &quot;provisioningState&quot;: null,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: null,
    &quot;securityRules&quot;: null,
    &quot;subnets&quot;: null,
    &quot;tags&quot;: null,
    &quot;type&quot;: null
  },
  &quot;privateEndpointNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;privateEndpoints&quot;: null,
  &quot;privateLinkServiceNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;purpose&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceNavigationLinks&quot;: null,
  &quot;routeTable&quot;: null,
  &quot;serviceAssociationLinks&quot;: null,
  &quot;serviceEndpointPolicies&quot;: null,
  &quot;serviceEndpoints&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks/subnets&quot;
}
</code></pre>

<h4 id="168-verify-trusted-subnet">16.8 - Verify Trusted Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az_network_vnet_subnet_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_TRUSTED_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">AddressPrefix    Name                     PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  -----------------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.10.14.0/24    ipm-vnet-trusted-subnet  Enabled                           Enabled                              Succeeded            ipm-eastus
</code></pre>

<h3 id="17-jump-server-vm">17 - Jump Server VM</h3>
<p>A jump server, jump host, or jump box is a system on a network used to access and manage devices in a separate security zone. A jump server is a hardened and monitored device that spans two dissimilar security zones and provides a controlled means of access between them. The most common example of a jump server is a host in a DMZ.</p>
<p>All hosts within the DMZ may be prevented from connecting to the internal network by the Network Security Group (firewall) that separates them, unless the Network Security Group (firewall) permits the connection.</p>
<p>In the following steps, the jump server (jumpbox) will be put on the DMZ subnet, with tcp port 22 opened from the Internet. It will be allowed to communicate with the other internal subnets.  The NSGs may be further tune to allow specific access, as it will be done for the ARO master subnet when ARO is installed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The jumpbox should be created prior to the VPN Gateway, so that there is at least one machine available for connectivity testing from two different security zones: Public (Internet) and Private (RFC1918).</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/create-cli-complete">https://docs.microsoft.com/en-us/azure/virtual-machines/linux/create-cli-complete</a></li>
<li><a href="https://en.wikipedia.org/wiki/Jump_server">https://en.wikipedia.org/wiki/Jump_server</a></li>
<li><a href="https://en.wikipedia.org/wiki/DMZ">https://en.wikipedia.org/wiki/DMZ</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep ARO.*JUMP | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">ARO_VM_JUMP_ADMIN_NAME=ipm-vm-jumpbox-admin
ARO_VM_JUMP_IMAGE_MARKETPLACE=true
ARO_VM_JUMP_IMAGE_URN=cognosys:docker-ce-with-centos-8-0-free:docker-ce-with-centos-8-0-free:1.2019.0710
ARO_VM_JUMP_NAME=ipm-vm-jumpbox
ARO_VM_JUMP_PUBLIC_ADDRESS_NAME=ipm-vm-jumpbox-public-ip
ARO_VM_JUMP_SIZE=Standard_B1ms
</code></pre>

<h4 id="171-create-jump-server-address">17.1 - Create Jump Server Address</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az-network-public-ip-create">https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az-network-public-ip-create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network public-ip create --name ${ARO_VM_JUMP_PUBLIC_ADDRESS_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --sku &quot;Basic&quot; --allocation-method &quot;Dynamic&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;publicIp&quot;: {
    &quot;ddosSettings&quot;: null,
    &quot;dnsSettings&quot;: null,
    &quot;etag&quot;: &quot;W/\&quot;db3f0454-61e8-4b8d-840e-694b71e697a2\&quot;&quot;,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/publicIPAddresses/ipm-vm-jumpbox-public-ip&quot;,
    &quot;idleTimeoutInMinutes&quot;: 4,
    &quot;ipAddress&quot;: null,
    &quot;ipConfiguration&quot;: null,
    &quot;ipTags&quot;: [],
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;name&quot;: &quot;ipm-vm-jumpbox-public-ip&quot;,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;publicIpAddressVersion&quot;: &quot;IPv4&quot;,
    &quot;publicIpAllocationMethod&quot;: &quot;Dynamic&quot;,
    &quot;publicIpPrefix&quot;: null,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;3ea50ce6-bb5b-41fe-94f6-9d95e8103cbe&quot;,
    &quot;sku&quot;: {
      &quot;name&quot;: &quot;Basic&quot;
    },
    &quot;tags&quot;: null,
    &quot;type&quot;: &quot;Microsoft.Network/publicIPAddresses&quot;,
    &quot;zones&quot;: null
  }
}
</code></pre>

<h4 id="172-verify-jump-server-address">17.2 - Verify Jump Server Address</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az_network_public_ip_show">https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az_network_public_ip_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network public-ip show --name ${ARO_VM_JUMP_PUBLIC_ADDRESS_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;ddosSettings&quot;: null,
  &quot;dnsSettings&quot;: null,
  &quot;etag&quot;: &quot;W/\&quot;db3f0454-61e8-4b8d-840e-694b71e697a2\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/publicIPAddresses/ipm-vm-jumpbox-public-ip&quot;,
  &quot;idleTimeoutInMinutes&quot;: 4,
  &quot;ipAddress&quot;: null,
  &quot;ipConfiguration&quot;: null,
  &quot;ipTags&quot;: [],
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;name&quot;: &quot;ipm-vm-jumpbox-public-ip&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;publicIpAddressVersion&quot;: &quot;IPv4&quot;,
  &quot;publicIpAllocationMethod&quot;: &quot;Dynamic&quot;,
  &quot;publicIpPrefix&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceGuid&quot;: &quot;3ea50ce6-bb5b-41fe-94f6-9d95e8103cbe&quot;,
  &quot;sku&quot;: {
    &quot;name&quot;: &quot;Basic&quot;
  },
  &quot;tags&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Network/publicIPAddresses&quot;,
  &quot;zones&quot;: null
}
</code></pre>

<h4 id="173-create-jump-server-nic">17.3 - Create Jump Server NIC</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/nic?view=azure-cli-latest#az_network_nic_create">https://docs.microsoft.com/en-us/cli/azure/network/nic?view=azure-cli-latest#az_network_nic_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network nic create --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME}-nic --vnet-name ${ARO_VNET_NAME} --subnet ${ARO_SUBNET_DMZ_NAME} --public-ip-address ${ARO_VM_JUMP_PUBLIC_ADDRESS_NAME} --network-security-group ${ARO_SUBNET_DMZ_NSG_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;NewNIC&quot;: {
    &quot;dnsSettings&quot;: {
      &quot;appliedDnsServers&quot;: [],
      &quot;dnsServers&quot;: [],
      &quot;internalDnsNameLabel&quot;: null,
      &quot;internalDomainNameSuffix&quot;: &quot;dnl3vzqtoksu5ll1sfsl3bperc.bx.internal.cloudapp.net&quot;,
      &quot;internalFqdn&quot;: null
    },
    &quot;dscpConfiguration&quot;: null,
    &quot;enableAcceleratedNetworking&quot;: false,
    &quot;enableIpForwarding&quot;: false,
    &quot;etag&quot;: &quot;W/\&quot;f1db4270-6f99-494b-bae8-c4077bb8c482\&quot;&quot;,
    &quot;hostedWorkloads&quot;: [],
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkInterfaces/ipm-vm-jumpbox-nic&quot;,
    &quot;ipConfigurations&quot;: [
      {
        &quot;applicationGatewayBackendAddressPools&quot;: null,
        &quot;applicationSecurityGroups&quot;: null,
        &quot;etag&quot;: &quot;W/\&quot;f1db4270-6f99-494b-bae8-c4077bb8c482\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkInterfaces/ipm-vm-jumpbox-nic/ipConfigurations/ipconfig1&quot;,
        &quot;loadBalancerBackendAddressPools&quot;: null,
        &quot;loadBalancerInboundNatRules&quot;: null,
        &quot;name&quot;: &quot;ipconfig1&quot;,
        &quot;primary&quot;: true,
        &quot;privateIpAddress&quot;: &quot;10.10.13.4&quot;,
        &quot;privateIpAddressVersion&quot;: &quot;IPv4&quot;,
        &quot;privateIpAllocationMethod&quot;: &quot;Dynamic&quot;,
        &quot;privateLinkConnectionProperties&quot;: null,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;publicIpAddress&quot;: {
          &quot;ddosSettings&quot;: null,
          &quot;dnsSettings&quot;: null,
          &quot;etag&quot;: null,
          &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/publicIPAddresses/ipm-vm-jumpbox-public-ip&quot;,
          &quot;idleTimeoutInMinutes&quot;: null,
          &quot;ipAddress&quot;: null,
          &quot;ipConfiguration&quot;: null,
          &quot;ipTags&quot;: null,
          &quot;location&quot;: null,
          &quot;name&quot;: null,
          &quot;provisioningState&quot;: null,
          &quot;publicIpAddressVersion&quot;: null,
          &quot;publicIpAllocationMethod&quot;: null,
          &quot;publicIpPrefix&quot;: null,
          &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
          &quot;resourceGuid&quot;: null,
          &quot;sku&quot;: null,
          &quot;tags&quot;: null,
          &quot;type&quot;: null,
          &quot;zones&quot;: null
        },
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;subnet&quot;: {
          &quot;addressPrefix&quot;: null,
          &quot;addressPrefixes&quot;: null,
          &quot;delegations&quot;: null,
          &quot;etag&quot;: null,
          &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-dmz-subnet&quot;,
          &quot;ipAllocations&quot;: null,
          &quot;ipConfigurationProfiles&quot;: null,
          &quot;ipConfigurations&quot;: null,
          &quot;name&quot;: null,
          &quot;natGateway&quot;: null,
          &quot;networkSecurityGroup&quot;: null,
          &quot;privateEndpointNetworkPolicies&quot;: null,
          &quot;privateEndpoints&quot;: null,
          &quot;privateLinkServiceNetworkPolicies&quot;: null,
          &quot;provisioningState&quot;: null,
          &quot;purpose&quot;: null,
          &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
          &quot;resourceNavigationLinks&quot;: null,
          &quot;routeTable&quot;: null,
          &quot;serviceAssociationLinks&quot;: null,
          &quot;serviceEndpointPolicies&quot;: null,
          &quot;serviceEndpoints&quot;: null
        },
        &quot;type&quot;: &quot;Microsoft.Network/networkInterfaces/ipConfigurations&quot;,
        &quot;virtualNetworkTaps&quot;: null
      }
    ],
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;macAddress&quot;: null,
    &quot;name&quot;: &quot;ipm-vm-jumpbox-nic&quot;,
    &quot;networkSecurityGroup&quot;: {
      &quot;defaultSecurityRules&quot;: null,
      &quot;etag&quot;: null,
      &quot;flowLogs&quot;: null,
      &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkSecurityGroups/ipm-vnet-dmz-subnet-nsg&quot;,
      &quot;location&quot;: null,
      &quot;name&quot;: null,
      &quot;networkInterfaces&quot;: null,
      &quot;provisioningState&quot;: null,
      &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
      &quot;resourceGuid&quot;: null,
      &quot;securityRules&quot;: null,
      &quot;subnets&quot;: null,
      &quot;tags&quot;: null,
      &quot;type&quot;: null
    },
    &quot;primary&quot;: null,
    &quot;privateEndpoint&quot;: null,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;16debdd3-c550-4941-8c5c-729ed79686e7&quot;,
    &quot;tags&quot;: null,
    &quot;tapConfigurations&quot;: [],
    &quot;type&quot;: &quot;Microsoft.Network/networkInterfaces&quot;,
    &quot;virtualMachine&quot;: null
  }
}
</code></pre>

<h4 id="174-verify-jump-server-nic">17.4 - Verify Jump Server NIC</h4>
<p>A network interface enables an Azure Virtual Machine to communicate with internet, Azure, and on-premises resources.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/nic?view=azure-cli-latest#az_network_nic_show">https://docs.microsoft.com/en-us/cli/azure/network/nic?view=azure-cli-latest#az_network_nic_show</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-network-interface">https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-network-interface</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network nic show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME}-nic --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">EnableAcceleratedNetworking    EnableIpForwarding    Location    Name                ProvisioningState    ResourceGroup    ResourceGuid
-----------------------------  --------------------  ----------  ------------------  -------------------  ---------------  ------------------------------------
False                          False                 eastus      ipm-vm-jumpbox-nic  Succeeded            ipm-eastus       16debdd3-c550-4941-8c5c-729ed79686e7
</code></pre>

<h4 id="175-create-jump-server-as">17.5 - Create Jump Server AS</h4>
<p>An Availability Set (AS) helps spread VMs across fault domains and update domains. It's best practice to use availability sets for VMs, to make it easier to expand in the future.</p>
<p>Fault domains define a grouping of virtual machines that share a common power source and network switch. By default, the virtual machines that are configured within the availability set are separated across up to three fault domains. A hardware issue in one of these fault domains does not affect the VM.</p>
<p>Update domains indicate groups of virtual machines and underlying physical hardware that can be rebooted at the same time. During planned maintenance, the order in which update domains are rebooted might not be sequential, but only one update domain is rebooted at a time.</p>
<p>Azure automatically distributes VMs across the fault and update domains when placing them in an availability set. For more information, see managing the availability of VMs.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/vm/availability-set?view=azure-cli-latest#az_vm_availability_set_create">https://docs.microsoft.com/en-us/cli/azure/vm/availability-set?view=azure-cli-latest#az_vm_availability_set_create</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/manage-availability">https://docs.microsoft.com/en-us/azure/virtual-machines/linux/manage-availability</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az vm availability-set create --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME}-as
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Compute/availabilitySets/ipm-vm-jumpbox-as&quot;,
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;name&quot;: &quot;ipm-vm-jumpbox-as&quot;,
  &quot;platformFaultDomainCount&quot;: 2,
  &quot;platformUpdateDomainCount&quot;: 5,
  &quot;proximityPlacementGroup&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;sku&quot;: {
    &quot;capacity&quot;: null,
    &quot;name&quot;: &quot;Aligned&quot;,
    &quot;tier&quot;: null
  },
  &quot;statuses&quot;: null,
  &quot;tags&quot;: {},
  &quot;type&quot;: &quot;Microsoft.Compute/availabilitySets&quot;,
  &quot;virtualMachines&quot;: []
}
</code></pre>

<h4 id="176-verify-jump-server-as">17.6 - Verify Jump Server AS</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/vm/availability-set?view=azure-cli-latest#az_vm_availability_set_show">https://docs.microsoft.com/en-us/cli/azure/vm/availability-set?view=azure-cli-latest#az_vm_availability_set_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az vm availability-set show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME}-as --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Location    Name               PlatformFaultDomainCount    PlatformUpdateDomainCount    ResourceGroup
----------  -----------------  --------------------------  ---------------------------  ---------------
eastus      ipm-vm-jumpbox-as  2                           5                            ipm-eastus
</code></pre>

<h4 id="177-accept-jump-server-image-urn">17.7 - Accept Jump Server Image URN</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/vm/image/terms?view=azure-cli-latest#az_vm_image_terms_accept">https://docs.microsoft.com/en-us/cli/azure/vm/image/terms?view=azure-cli-latest#az_vm_image_terms_accept</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/cli-ps-findimage">https://docs.microsoft.com/en-us/azure/virtual-machines/windows/cli-ps-findimage</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az vm image terms accept --urn ${ARO_VM_JUMP_IMAGE_URN}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;accepted&quot;: true,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/providers/Microsoft.MarketplaceOrdering/offerTypes/Microsoft.MarketplaceOrdering/offertypes/publishers/cognosys/offers/docker-ce-with-centos-8-0-free/plans/docker-ce-with-centos-8-0-free/agreements/current&quot;,
  &quot;licenseTextLink&quot;: &quot;https://storelegalterms.blob.core.windows.net/legalterms/3E5ED_legalterms_COGNOSYS%253a24DOCKER%253a2DCE%253a2DWITH%253a2DCENTOS%253a2D8%253a2D0%253a2DFREE%253a24DOCKER%253a2DCE%253a2DWITH%253a2DCENTOS%253a2D8%253a2D0%253a2DFREE%253a24T622IBUBKL6J3MHL5NUAWG2XNZ5H5FVSJGLCOC54LB63AGIONYH5CDZVDEYDONEFK2NHKCZROAP7ZU5PLZHXJ5ZNBFEUCBOWWMC4DSY.txt&quot;,
  &quot;name&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
  &quot;plan&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
  &quot;privacyPolicyLink&quot;: &quot;http://www.cogno-sys.com/cognosys-technologies-partners/privacy-policy/&quot;,
  &quot;product&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
  &quot;publisher&quot;: &quot;cognosys&quot;,
  &quot;retrieveDatetime&quot;: &quot;2020-09-27T03:03:24.6212864Z&quot;,
  &quot;signature&quot;: &quot;7TK6WC7YUSEVPL5URUWHBHRILKUK5JO6RZ5WSTOPBEKJ6QQTKWXNX5F627R4U3FMPQQTPDJIXNOJZEPSFH324RLHXNMZ3MSEOCJ7ZII&quot;,
  &quot;type&quot;: &quot;Microsoft.MarketplaceOrdering/offertypes&quot;
}
</code></pre>

<h4 id="178-verify-jump-server-image-urn">17.8 - Verify Jump Server Image URN</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/vm/image/terms?view=azure-cli-latest#az_vm_image_terms_show">https://docs.microsoft.com/en-us/cli/azure/vm/image/terms?view=azure-cli-latest#az_vm_image_terms_show</a></li>
<li><a href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps/cognosys.docker-ce-with-centos-8-0-free?tab=Overview">https://azuremarketplace.microsoft.com/en-us/marketplace/apps/cognosys.docker-ce-with-centos-8-0-free?tab=Overview</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az vm image terms show --urn ${ARO_VM_JUMP_IMAGE_URN} --query '[{accepted:accepted, name:name, plan:plan, product:product, publisher:publisher, type:type}]' --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Accepted    Name                            Plan                            Product                         Publisher
----------  ------------------------------  ------------------------------  ------------------------------  -----------
True        docker-ce-with-centos-8-0-free  docker-ce-with-centos-8-0-free  docker-ce-with-centos-8-0-free  cognosys
</code></pre>

<h4 id="179-create-jump-server-vm">17.9 - Create Jump Server VM</h4>
<p>An Azure Virtual Machines (VM) is one of several types of on-demand, scalable computing resources that Azure offers.  An Azure VM gives you the flexibility of virtualization without having to buy and maintain the physical hardware that runs it. However, you still need to maintain the VM by performing tasks, such as configuring, patching, and installing the software that runs on it.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az_vm_create">https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az_vm_create</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/tutorial-manage-vm">https://docs.microsoft.com/en-us/azure/virtual-machines/linux/tutorial-manage-vm</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/">https://docs.microsoft.com/en-us/azure/virtual-machines/linux/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az vm create --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME} --location ${ARO_LOCATION_NAME} --availability-set ${ARO_VM_JUMP_NAME}-as --nics ${ARO_VM_JUMP_NAME}-nic --image ${ARO_VM_JUMP_IMAGE_URN} --admin-username ${ARO_VM_JUMP_ADMIN_NAME} --size ${ARO_VM_JUMP_SIZE} --generate-ssh-keys
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;fqdns&quot;: &quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Compute/virtualMachines/ipm-vm-jumpbox&quot;,
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;macAddress&quot;: &quot;00-0D-3A-9E-B0-AB&quot;,
  &quot;powerState&quot;: &quot;VM running&quot;,
  &quot;privateIpAddress&quot;: &quot;10.10.13.4&quot;,
  &quot;publicIpAddress&quot;: &quot;40.88.33.248&quot;,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;zones&quot;: &quot;&quot;
}
</code></pre>

<h4 id="1710-verify-jump-server-vm">17.10 - Verify Jump Server VM</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az_vm_show">https://docs.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest#az_vm_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az vm show -d -g ${ARO_RESOURCE_GROUP_NAME} -n ${ARO_VM_JUMP_NAME} --query publicIps -o tsv
az vm show --resource-group ${ARO_RESOURCE_GROUP_NAME} --name ${ARO_VM_JUMP_NAME}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">40.88.33.248
</code></pre>

<pre><code class="json">{
  &quot;additionalCapabilities&quot;: null,
  &quot;availabilitySet&quot;: {
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Compute/availabilitySets/IPM-VM-JUMPBOX-AS&quot;,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;
  },
  &quot;billingProfile&quot;: null,
  &quot;diagnosticsProfile&quot;: null,
  &quot;evictionPolicy&quot;: null,
  &quot;extensionsTimeBudget&quot;: null,
  &quot;hardwareProfile&quot;: {
    &quot;vmSize&quot;: &quot;Standard_B1ms&quot;
  },
  &quot;host&quot;: null,
  &quot;hostGroup&quot;: null,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Compute/virtualMachines/ipm-vm-jumpbox&quot;,
  &quot;identity&quot;: null,
  &quot;instanceView&quot;: null,
  &quot;licenseType&quot;: null,
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;name&quot;: &quot;ipm-vm-jumpbox&quot;,
  &quot;networkProfile&quot;: {
    &quot;networkInterfaces&quot;: [
      {
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/networkInterfaces/ipm-vm-jumpbox-nic&quot;,
        &quot;primary&quot;: true,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;
      }
    ]
  },
  &quot;osProfile&quot;: {
    &quot;adminPassword&quot;: null,
    &quot;adminUsername&quot;: &quot;ipm-vm-jumpbox-admin&quot;,
    &quot;allowExtensionOperations&quot;: true,
    &quot;computerName&quot;: &quot;ipm-vm-jumpbox&quot;,
    &quot;customData&quot;: null,
    &quot;linuxConfiguration&quot;: {
      &quot;disablePasswordAuthentication&quot;: true,
      &quot;patchSettings&quot;: {
        &quot;patchMode&quot;: &quot;ImageDefault&quot;
      },
      &quot;provisionVmAgent&quot;: true,
      &quot;ssh&quot;: {
        &quot;publicKeys&quot;: [
          {
            &quot;keyData&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDec9G5K26hxFj+Ha0gQChwhSW4fT6mlZrb0066h+moGMJKMJ2YiHMaNMUULFT8SkJch4KYjQfqgJE8YnSGRHPzmUWwF/v7AwcozIlwralduUdYNIScDnzaFCBa55pLQwCWIN7zXFCdtEG935XwaV+A+tOgokiGvGXMAUj/Dz0A5ClIhbD/i3dr2AFKuuSwMGpFc1EqZDh72ZsYTcDaZT5hhPPUCUyTqOfEJuWQYeE3DAuA1EoI2tmBQWNl2S1jtdHa/69BBAmA6t0MZXuMKpk0udzQjw/d6b64hKYHDDlfxaTEBnt1Vbd8Rv5bxJSI1y2QgCutRZwVa/dt1X71fwpAq4yr0H8JCrabKrIumgqyZ6VQyCTVu3AXZ3E/yMQmJhLK2RvPHrHp8DedZ3su62zvU9aUACyd6b89R6S4eYOmIE+nNG/M/yqS2Ru3GPUalsQXE5/auCsg6rPetxMNoEbZz5qTfJUfq3Xx61WQuLrAsyvEiIiM5rrgA/FhYbthxKKacYr0b6oi6HQW6KQ3JnPMm/QF2UxDxoNOG+NHi2UBfgiXLEHZQ3YnkS4QkB9aCK4YJyOJ5I/34gAGcUIPQ8nkUSky7btjsQlHNB6pHPI+8Xd2SntRmfgBwJwOUS+LqjK4OCCpkqUTSopXQ8vL8L/e2gw+8QIdTYe47/P0IG5zVQ== jtingiris@jt\n&quot;,
            &quot;path&quot;: &quot;/home/ipm-vm-jumpbox-admin/.ssh/authorized_keys&quot;
          }
        ]
      }
    },
    &quot;requireGuestProvisionSignal&quot;: true,
    &quot;secrets&quot;: [],
    &quot;windowsConfiguration&quot;: null
  },
  &quot;plan&quot;: {
    &quot;name&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
    &quot;product&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
    &quot;promotionCode&quot;: null,
    &quot;publisher&quot;: &quot;cognosys&quot;
  },
  &quot;priority&quot;: null,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;proximityPlacementGroup&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resources&quot;: null,
  &quot;securityProfile&quot;: null,
  &quot;storageProfile&quot;: {
    &quot;dataDisks&quot;: [],
    &quot;imageReference&quot;: {
      &quot;exactVersion&quot;: &quot;1.2019.0710&quot;,
      &quot;id&quot;: null,
      &quot;offer&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
      &quot;publisher&quot;: &quot;cognosys&quot;,
      &quot;sku&quot;: &quot;docker-ce-with-centos-8-0-free&quot;,
      &quot;version&quot;: &quot;1.2019.0710&quot;
    },
    &quot;osDisk&quot;: {
      &quot;caching&quot;: &quot;ReadWrite&quot;,
      &quot;createOption&quot;: &quot;FromImage&quot;,
      &quot;diffDiskSettings&quot;: null,
      &quot;diskSizeGb&quot;: 30,
      &quot;encryptionSettings&quot;: null,
      &quot;image&quot;: null,
      &quot;managedDisk&quot;: {
        &quot;diskEncryptionSet&quot;: null,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/IPM-EASTUS/providers/Microsoft.Compute/disks/ipm-vm-jumpbox_OsDisk_1_30aa79f1b3f44738b4fffb0818c1f500&quot;,
        &quot;resourceGroup&quot;: &quot;IPM-EASTUS&quot;,
        &quot;storageAccountType&quot;: &quot;Premium_LRS&quot;
      },
      &quot;name&quot;: &quot;ipm-vm-jumpbox_OsDisk_1_30aa79f1b3f44738b4fffb0818c1f500&quot;,
      &quot;osType&quot;: &quot;Linux&quot;,
      &quot;vhd&quot;: null,
      &quot;writeAcceleratorEnabled&quot;: null
    }
  },
  &quot;tags&quot;: {},
  &quot;type&quot;: &quot;Microsoft.Compute/virtualMachines&quot;,
  &quot;virtualMachineScaleSet&quot;: null,
  &quot;vmId&quot;: &quot;c6af84ea-fe96-4e23-a3ff-11770109f080&quot;,
  &quot;zones&quot;: null
}
</code></pre>

<h4 id="1711-login-to-jump-server-vm">17.11 - Login to Jump Server VM</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man1/ssh.1.html">https://man7.org/linux/man-pages/man1/ssh.1.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">export ARO_VM_JUMP_IP=$(az vm show -d -g ${ARO_RESOURCE_GROUP_NAME} -n ${ARO_VM_JUMP_NAME} --query publicIps -o tsv)
echo &quot;${ARO_VM_JUMP_IP}&quot;
ssh -i ~/.ssh/id_rsa.pub ${ARO_VM_JUMP_ADMIN_NAME}@${ARO_VM_JUMP_IP} &quot;hostname &amp;&amp; uptime&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">40.88.33.248
</code></pre>

<h3 id="18-vpn-gateway">18 - VPN Gateway</h3>
<p>A Virtual Private Network (VPN) Gateway is needed to connect to a private ARO cluster.  It is a specific type of gateway that is used to send encrypted traffic between an Azure VNet and a remote location, over the public Internet.</p>
<p>This document will focus on creating the newer, Resrouce Manager deployment model with Azure certificate authentication.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways">https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about">https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal">https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/create-routebased-vpn-gateway-cli">https://docs.microsoft.com/en-us/azure/vpn-gateway/create-routebased-vpn-gateway-cli</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep ARO.*VGW | egrep -ve 'PKI' | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">ARO_SUBNET_VGW_CIDR=10.10.10.0/24
ARO_SUBNET_VGW_NAME=GatewaySubnet
ARO_SUBNET_VGW_POOL_CIDR=172.16.13.0/24
ARO_SUBNET_VGW_POOL_NAME=ipm-vnet-vpn-pool-subnet
ARO_SUBNET_VGW_POOL_NSG_NAME=GatewaySubnet-nsg
ARO_VGW_NAME=ipm-vpn
ARO_VGW_PUBLIC_ADDRESS_NAME=ipm-vpn-public-ip
ARO_VGW_REDUNDANCY=true
ARO_VGW_SKU=VpnGw1AZ
ARO_VGW_TYPE=RouteBased
</code></pre>

<h4 id="181-create-vpn-subnet">18.1 - Create VPN Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-create">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-create</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpn-gateway-settings#gwsub">https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpn-gateway-settings#gwsub</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet create --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_VGW_NAME} --address-prefixes ${ARO_SUBNET_VGW_CIDR}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;addressPrefix&quot;: &quot;10.10.10.0/24&quot;,
  &quot;addressPrefixes&quot;: null,
  &quot;delegations&quot;: [],
  &quot;etag&quot;: &quot;W/\&quot;5719d87d-ccc4-4683-9638-12f7508a1950\&quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/GatewaySubnet&quot;,
  &quot;ipAllocations&quot;: null,
  &quot;ipConfigurationProfiles&quot;: null,
  &quot;ipConfigurations&quot;: null,
  &quot;name&quot;: &quot;GatewaySubnet&quot;,
  &quot;natGateway&quot;: null,
  &quot;networkSecurityGroup&quot;: null,
  &quot;privateEndpointNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;privateEndpoints&quot;: null,
  &quot;privateLinkServiceNetworkPolicies&quot;: &quot;Enabled&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;purpose&quot;: null,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceNavigationLinks&quot;: null,
  &quot;routeTable&quot;: null,
  &quot;serviceAssociationLinks&quot;: null,
  &quot;serviceEndpointPolicies&quot;: null,
  &quot;serviceEndpoints&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks/subnets&quot;
}
</code></pre>

<h4 id="182-verify-vpn-subnet">18.2 - Verify VPN Subnet</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show">https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest#az-network-vnet-subnet-show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet subnet show --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet-name ${ARO_VNET_NAME} --name ${ARO_SUBNET_VGW_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">AddressPrefix    Name           PrivateEndpointNetworkPolicies    PrivateLinkServiceNetworkPolicies    ProvisioningState    ResourceGroup
---------------  -------------  --------------------------------  -----------------------------------  -------------------  ---------------
10.10.10.0/24    GatewaySubnet  Enabled                           Enabled                              Succeeded            ipm-eastus
</code></pre>

<h4 id="183-create-vpn-address">18.3 - Create VPN Address</h4>
<p>The VPN Gateway requires a Public IP Address.</p>
<p>Zone-redundant VPN gateways and zonal gateways both rely on the Azure public IP resource Standard SKU. The configuration of the Azure public IP resource determines whether the gateway that you deploy is zone-redundant, or zonal. If you create a public IP resource with a Basic SKU, the gateway will not have any zone redundancy, and the gateway resources will be regional.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The public-ip --sku and --allocation-method may differ, depending on the needs of the VPN Gateway.  Refer to the Reference(s) for details.  A Redundant VPN Gateway is being created in this example.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az-network-public-ip-create">https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az-network-public-ip-create</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-network/public-ip-addresses">https://docs.microsoft.com/en-us/azure/virtual-network/public-ip-addresses</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network public-ip create --name ${ARO_VGW_PUBLIC_ADDRESS_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --sku &quot;${VPN_IP_SKU}&quot; --allocation-method &quot;${VPN_IP_ALLOCATION_METHOD}&quot; ${VPN_IP_ZONE}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;publicIp&quot;: {
    &quot;ddosSettings&quot;: null,
    &quot;dnsSettings&quot;: null,
    &quot;etag&quot;: &quot;W/\&quot;c516d2ba-28fa-4259-a9fd-8e0220e9d7d9\&quot;&quot;,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/publicIPAddresses/ipm-vpn-public-ip&quot;,
    &quot;idleTimeoutInMinutes&quot;: 4,
    &quot;ipAddress&quot;: &quot;20.55.32.58&quot;,
    &quot;ipConfiguration&quot;: null,
    &quot;ipTags&quot;: [],
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;name&quot;: &quot;ipm-vpn-public-ip&quot;,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;publicIpAddressVersion&quot;: &quot;IPv4&quot;,
    &quot;publicIpAllocationMethod&quot;: &quot;Static&quot;,
    &quot;publicIpPrefix&quot;: null,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;8a54cef2-c31d-4b8d-ae52-b1dbbf9d6802&quot;,
    &quot;sku&quot;: {
      &quot;name&quot;: &quot;Standard&quot;
    },
    &quot;tags&quot;: null,
    &quot;type&quot;: &quot;Microsoft.Network/publicIPAddresses&quot;,
    &quot;zones&quot;: [
      &quot;1&quot;
    ]
  }
}
</code></pre>

<h4 id="184-verify-vpn-address">18.4 - Verify VPN Address</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az_network_public_ip_show">https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest#az_network_public_ip_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network public-ip show --name ${ARO_VGW_PUBLIC_ADDRESS_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Name               ResourceGroup    Location    Zones    Address      AddressVersion    AllocationMethod    IdleTimeoutInMinutes    ProvisioningState
-----------------  ---------------  ----------  -------  -----------  ----------------  ------------------  ----------------------  -------------------
ipm-vpn-public-ip  ipm-eastus       eastus      1        20.55.32.58  IPv4              Static              4                       Succeeded
</code></pre>

<h4 id="185-create-vpn-gateway">18.5 - Create VPN Gateway</h4>
<p>There are two types of Azure VPN Gateways, the Classic and Resource Manager deployment models.</p>
<p>Each virtual network can have only one VPN gateway.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Creating a virtual network gateway can take up to 45 minutes to complete.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway?view=azure-cli-latest#az_network_vnet_gateway_create">https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway?view=azure-cli-latest#az_network_vnet_gateway_create</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet-gateway create --name ${ARO_VGW_NAME} --location ${ARO_LOCATION_NAME} --public-ip-address ${ARO_VGW_PUBLIC_ADDRESS_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --vnet ${ARO_VNET_NAME} --gateway-type VPN --sku ${ARO_VGW_SKU} --vpn-type ${ARO_VGW_TYPE} --address-prefixes ${ARO_SUBNET_VGW_POOL_CIDR}
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;vnetGateway&quot;: {
    &quot;activeActive&quot;: false,
    &quot;bgpSettings&quot;: {
      &quot;asn&quot;: 65515,
      &quot;bgpPeeringAddress&quot;: &quot;10.10.10.254&quot;,
      &quot;bgpPeeringAddresses&quot;: [
        {
          &quot;customBgpIpAddresses&quot;: [],
          &quot;defaultBgpIpAddresses&quot;: [
            &quot;10.10.10.254&quot;
          ],
          &quot;ipconfigurationId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworkGateways/ipm-vpn/ipConfigurations/vnetGatewayConfig0&quot;,
          &quot;tunnelIpAddresses&quot;: [
            &quot;20.55.32.58&quot;
          ]
        }
      ],
      &quot;peerWeight&quot;: 0
    },
    &quot;customRoutes&quot;: null,
    &quot;enableBgp&quot;: false,
    &quot;enableDnsForwarding&quot;: null,
    &quot;enablePrivateIpAddress&quot;: false,
    &quot;etag&quot;: &quot;W/\&quot;e794796d-23a5-40ea-b5d3-391b68595bfb\&quot;&quot;,
    &quot;gatewayDefaultSite&quot;: null,
    &quot;gatewayType&quot;: &quot;Vpn&quot;,
    &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworkGateways/ipm-vpn&quot;,
    &quot;inboundDnsForwardingEndpoint&quot;: null,
    &quot;ipConfigurations&quot;: [
      {
        &quot;etag&quot;: &quot;W/\&quot;e794796d-23a5-40ea-b5d3-391b68595bfb\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworkGateways/ipm-vpn/ipConfigurations/vnetGatewayConfig0&quot;,
        &quot;name&quot;: &quot;vnetGatewayConfig0&quot;,
        &quot;privateIpAddress&quot;: null,
        &quot;privateIpAllocationMethod&quot;: &quot;Dynamic&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;publicIpAddress&quot;: {
          &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/publicIPAddresses/ipm-vpn-public-ip&quot;,
          &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;
        },
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;subnet&quot;: {
          &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/GatewaySubnet&quot;,
          &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;
        },
        &quot;type&quot;: &quot;Microsoft.Network/virtualNetworkGateways/ipConfigurations&quot;
      }
    ],
    &quot;location&quot;: &quot;eastus&quot;,
    &quot;name&quot;: &quot;ipm-vpn&quot;,
    &quot;provisioningState&quot;: &quot;Succeeded&quot;,
    &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
    &quot;resourceGuid&quot;: &quot;20c26bff-2dad-4a88-8418-06ca4fa257af&quot;,
    &quot;sku&quot;: {
      &quot;capacity&quot;: 2,
      &quot;name&quot;: &quot;VpnGw1AZ&quot;,
      &quot;tier&quot;: &quot;VpnGw1AZ&quot;
    },
    &quot;tags&quot;: null,
    &quot;type&quot;: &quot;Microsoft.Network/virtualNetworkGateways&quot;,
    &quot;vpnClientConfiguration&quot;: {
      &quot;aadAudience&quot;: null,
      &quot;aadIssuer&quot;: null,
      &quot;aadTenant&quot;: null,
      &quot;radiusServerAddress&quot;: null,
      &quot;radiusServerSecret&quot;: null,
      &quot;radiusServers&quot;: [],
      &quot;vpnClientAddressPool&quot;: {
        &quot;addressPrefixes&quot;: [
          &quot;172.16.13.0/24&quot;
        ]
      },
      &quot;vpnClientConnectionHealth&quot;: {
        &quot;totalEgressBytesTransferred&quot;: 0,
        &quot;totalIngressBytesTransferred&quot;: 0,
        &quot;vpnClientConnectionsCount&quot;: 0
      },
      &quot;vpnClientIpsecPolicies&quot;: [],
      &quot;vpnClientProtocols&quot;: [
        &quot;IkeV2&quot;,
        &quot;OpenVPN&quot;
      ],
      &quot;vpnClientRevokedCertificates&quot;: [],
      &quot;vpnClientRootCertificates&quot;: []
    },
    &quot;vpnGatewayGeneration&quot;: &quot;Generation1&quot;,
    &quot;vpnType&quot;: &quot;RouteBased&quot;
  }
}
</code></pre>

<h4 id="186-verify-vpn-gateway">18.6 - Verify VPN Gateway</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway?view=azure-cli-latest#az_network_vnet_gateway_show">https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway?view=azure-cli-latest#az_network_vnet_gateway_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet-gateway show --name ${ARO_VGW_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --output table
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">ActiveActive    EnableBgp    EnablePrivateIpAddress    GatewayType    Location    Name     ProvisioningState    ResourceGroup    ResourceGuid                          VpnGatewayGeneration    VpnType
--------------  -----------  ------------------------  -------------  ----------  -------  -------------------  ---------------  ------------------------------------  ----------------------  ----------
False           False        False                     Vpn            eastus      ipm-vpn  Succeeded            ipm-eastus       20c26bff-2dad-4a88-8418-06ca4fa257af  Generation1             RouteBased
</code></pre>

<h3 id="19-vpn-gateway-pki">19 - VPN Gateway PKI</h3>
<p>An Azure VPN Gateway supports using a Public Key Infrastructure (PKI) for Certificate Authentication.</p>
<p>With VPN Gateway Certificate Authentication, a client certificate is used to authenticate the connecting user. Client certificates are generated from a trusted Root Certificate and then installed on each client computer.  The validation of the Client Certificate is performed by the VPN Gateway and happens during establishment of the point-to-site (P2S) VPN connection.</p>
<p>This series of steps establishes a private Certificate Authority (CA) by creating a Root Key &amp; Certificate.  The Certificate Data wil be uploaded to the Azure VPN Gateway, so that VPN Clients Certificates will be authenticated.  To be valid for authentication, the VPN Client Certificates must be signed by the Root Certificate.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VPN Client Certificates will be created later.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal">https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal</a></li>
<li><a href="https://en.wikipedia.org/wiki/Public_key_infrastructure">https://en.wikipedia.org/wiki/Public_key_infrastructure</a></li>
<li><a href="https://en.wikipedia.org/wiki/Root_certificate">https://en.wikipedia.org/wiki/Root_certificate</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | grep ARO_VGW_PKI | grep -v CLIENT | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">ARO_VGW_PKI_BITS=2048
ARO_VGW_PKI_DIR=/home/jtingiris/prj/mit/aei/pki
ARO_VGW_PKI_ROOT_CA_SERIAL_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.serial
ARO_VGW_PKI_ROOT_CRT_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.crt
ARO_VGW_PKI_ROOT_CRT_NAME=ipm-vpn-root.crt
ARO_VGW_PKI_ROOT_KEY_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.key
ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE=Pk1P4ssphr4s3!!
ARO_VGW_PKI_ROOT_KEY_NAME=ipm-vpn-root.key
</code></pre>

<h4 id="191-create-root-key">19.1 - Create Root Key</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-genrsa.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-genrsa.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl genrsa -aes256 -out ${ARO_VGW_PKI_ROOT_KEY_FILE} -passout env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE ${ARO_VGW_PKI_BITS} 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Generating RSA private key, 2048 bit long modulus (2 primes)
..+++++
.................+++++
e is 65537 (0x010001)
</code></pre>

<h4 id="192-verify-root-key">19.2 - Verify Root Key</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl rsa -in ${ARO_VGW_PKI_ROOT_KEY_FILE} -noout -passin env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="193-create-root-certificate">19.3 - Create Root Certificate</h4>
<p>This step creates a root certificate that is valid for 10 years (3650 days).</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl req -x509 -sha256 -new -key &quot;${ARO_VGW_PKI_ROOT_KEY_FILE}&quot; -out &quot;${ARO_VGW_PKI_ROOT_CRT_FILE}&quot; -days 3650 -subj /CN=&quot;${ARO_VGW_NAME}&quot; -passin env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE 2&gt;&amp;1 # 10 years
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="194-verify-root-certificate">19.4 - Verify Root Certificate</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl x509 -in &quot;${ARO_VGW_PKI_ROOT_CRT_FILE}&quot; -noout -text 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            0c:bf:8d:e4:7e:9c:40:ab:ba:39:b9:42:98:7f:80:a4:5e:36:a7:3e
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN = ipm-vpn
        Validity
            Not Before: Sep 27 03:28:52 2020 GMT
            Not After : Sep 25 03:28:52 2030 GMT
        Subject: CN = ipm-vpn
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:b3:82:e0:16:56:56:9b:c4:81:c4:a9:4d:67:b6:
                    3e:b4:1c:7c:38:2b:e8:f0:c0:23:5d:d2:d8:71:dc:
                    57:fb:e6:50:c8:f5:71:99:d0:36:b4:23:f2:4b:90:
                    1d:0a:7c:f3:0d:6f:81:2a:1d:07:81:65:19:45:de:
                    e2:dc:a0:c8:c1:ad:61:b7:a5:a5:e4:78:68:03:ef:
                    07:59:f5:de:ff:ce:4b:5c:fc:f3:0a:45:89:90:28:
                    0d:49:c2:40:95:40:57:7e:5c:ac:f7:9c:ce:67:7d:
                    f6:71:35:f9:85:dc:82:ad:9c:d5:af:0a:43:4e:e3:
                    61:d6:79:90:c0:02:55:37:ca:55:1a:26:ba:cf:05:
                    1f:c5:86:44:1a:54:d5:07:ba:38:b0:ca:5d:42:31:
                    3b:84:56:70:5b:f1:d4:39:17:be:8d:dc:25:cf:79:
                    f9:fc:9d:61:59:46:fa:47:59:9a:bb:a3:20:4d:d7:
                    c1:09:2b:4c:92:ae:2b:c4:f5:e0:3d:18:52:21:59:
                    f3:6c:e0:51:3a:85:eb:de:5d:9d:2b:ed:e5:58:ef:
                    5a:39:c4:5f:80:41:00:c3:9f:fc:a9:f5:3c:ec:fe:
                    65:44:c4:5a:e6:5f:79:7a:fd:50:bf:c4:14:ef:12:
                    13:89:77:c9:5a:3f:52:10:4f:83:31:43:bc:3e:94:
                    a8:33
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                07:F6:01:FE:90:60:6A:E7:9E:7A:94:3F:62:AE:A1:1C:6C:7F:41:5A
            X509v3 Authority Key Identifier: 
                keyid:07:F6:01:FE:90:60:6A:E7:9E:7A:94:3F:62:AE:A1:1C:6C:7F:41:5A

            X509v3 Basic Constraints: critical
                CA:TRUE
    Signature Algorithm: sha256WithRSAEncryption
         97:dc:d1:bd:95:37:2c:97:e7:76:9b:bc:9d:e4:5d:d7:73:6e:
         81:93:e4:87:02:77:ec:19:de:d4:c1:d4:d8:2b:32:6d:e3:89:
         fb:97:36:b6:01:62:8c:cf:e6:bd:ce:52:c1:03:c3:60:de:3f:
         5b:da:4f:fd:6c:cd:0b:47:65:af:4e:e2:d1:07:84:6c:50:6a:
         f8:e4:41:3b:ce:ae:f8:b2:66:68:b0:ed:32:04:f2:2f:8d:98:
         29:84:16:e7:a3:c4:ea:60:37:b6:0b:db:04:2a:d6:94:a4:aa:
         80:eb:2d:14:ad:25:1e:3e:7d:1b:7a:72:1a:06:44:f8:e6:51:
         02:3a:cf:36:6b:4b:d5:b4:6b:ee:1f:88:49:1a:22:06:39:ba:
         3a:71:19:fa:34:e2:a9:c0:08:3e:25:91:64:1c:74:24:1a:4b:
         06:3b:24:5e:62:89:6c:54:f3:b9:15:5b:5f:70:d6:d6:19:a1:
         eb:a3:52:db:35:53:cb:0b:6b:39:59:5a:23:d5:ed:ca:fc:44:
         71:93:a7:66:7c:51:4d:4e:0f:f5:15:57:de:a1:09:2f:e6:23:
         76:00:bf:68:d7:bd:7b:69:83:b5:0d:e8:bb:a1:fb:01:18:bf:
         7e:39:30:94:02:27:29:ac:c9:f3:18:a2:50:55:e4:58:94:29:
         f6:1f:d4:24
</code></pre>

<h4 id="195-verify-root-moduli">19.5 - Verify Root  Moduli</h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Mismatched moduli will prevent a successful connection to the VPN Gateway.  If the md5sums are different, then do not proceed until they match.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</a></li>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">echo -n &quot;md5sum for ${ARO_VGW_PKI_ROOT_KEY_FILE} = &quot;; openssl rsa -noout -modulus -in &quot;${ARO_VGW_PKI_ROOT_KEY_FILE}&quot; -passin env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE | md5sum
echo -n &quot;md5sum for ${ARO_VGW_PKI_ROOT_CRT_FILE} = &quot;; openssl x509 -noout -modulus -in &quot;${ARO_VGW_PKI_ROOT_CRT_FILE}&quot; | md5sum
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">md5sum for /home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.key = 4103146f0ffed8dfb840bfd8f79963af  -
md5sum for /home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.crt = 4103146f0ffed8dfb840bfd8f79963af  -
</code></pre>

<h4 id="196-create-root-data">19.6 - Create Root Data</h4>
<p>The VPN Gateway requires knowledge of the Root Data.  The Public certificate data must be uploaded to Azure in a specific format.</p>
<p>In a previous step, the root certificate was created in the Privacy Enhanced Mail (PEM) format.</p>
<p>PEM is the most common format for X.509 certificates. A PEM file is a text file containing one or more items, encoded in base64 ASCII, and identified by plain-text headers and footers</p>
<p>PEM, an example:</p>
<pre><code>-----BEGIN CERTIFICATE-----
DATA
-----END CERTIFICATE-----
</code></pre>

<p><em>DER files do <strong>NOT</strong> contain plain text headers</em>.  DER is a binary format for data structures described by ASN.1.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The Azure VPN Gateway requires the Root Public certificate data use the Distinguished Encoding Rules (DER) format, encoded as base64 ASCII.  The conversion from PEM to base64 DER is done by OpenSSL, in the Command(s).</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway/root-cert?view=azure-cli-latest#az_network_vnet_gateway_root_cert_create">https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway/root-cert?view=azure-cli-latest#az_network_vnet_gateway_root_cert_create</a></li>
<li><a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail">https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail</a></li>
<li><a href="https://en.wikipedia.org/wiki/X.690#DER_encoding">https://en.wikipedia.org/wiki/X.690#DER_encoding</a></li>
<li><a href="https://en.wikipedia.org/wiki/ASN.1">https://en.wikipedia.org/wiki/ASN.1</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az network vnet-gateway root-cert create --gateway-name ${ARO_VGW_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --name &quot;${ARO_VGW_PKI_ROOT_CRT_NAME}&quot; --public-cert-data &quot;$(openssl x509 -in &quot;${ARO_VGW_PKI_ROOT_CRT_FILE}&quot; -outform der | base64 -w0)&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;activeActive&quot;: false,
  &quot;bgpSettings&quot;: {
    &quot;asn&quot;: 65515,
    &quot;bgpPeeringAddress&quot;: &quot;10.10.10.254&quot;,
    &quot;bgpPeeringAddresses&quot;: [
      {
        &quot;customBgpIpAddresses&quot;: [],
        &quot;defaultBgpIpAddresses&quot;: [
          &quot;10.10.10.254&quot;
        ],
        &quot;ipconfigurationId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworkGateways/ipm-vpn/ipConfigurations/vnetGatewayConfig0&quot;,
        &quot;tunnelIpAddresses&quot;: [
          &quot;20.55.32.58&quot;
        ]
      }
    ],
    &quot;peerWeight&quot;: 0
  },
  &quot;customRoutes&quot;: null,
  &quot;enableBgp&quot;: false,
  &quot;enableDnsForwarding&quot;: null,
  &quot;enablePrivateIpAddress&quot;: false,
  &quot;etag&quot;: &quot;W/\&quot;521ee314-bc40-45ea-9f66-d30ced4626c3\&quot;&quot;,
  &quot;gatewayDefaultSite&quot;: null,
  &quot;gatewayType&quot;: &quot;Vpn&quot;,
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworkGateways/ipm-vpn&quot;,
  &quot;inboundDnsForwardingEndpoint&quot;: null,
  &quot;ipConfigurations&quot;: [
    {
      &quot;etag&quot;: &quot;W/\&quot;521ee314-bc40-45ea-9f66-d30ced4626c3\&quot;&quot;,
      &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworkGateways/ipm-vpn/ipConfigurations/vnetGatewayConfig0&quot;,
      &quot;name&quot;: &quot;vnetGatewayConfig0&quot;,
      &quot;privateIpAddress&quot;: null,
      &quot;privateIpAllocationMethod&quot;: &quot;Dynamic&quot;,
      &quot;provisioningState&quot;: &quot;Succeeded&quot;,
      &quot;publicIpAddress&quot;: {
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/publicIPAddresses/ipm-vpn-public-ip&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;
      },
      &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
      &quot;subnet&quot;: {
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/GatewaySubnet&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;
      },
      &quot;type&quot;: &quot;Microsoft.Network/virtualNetworkGateways/ipConfigurations&quot;
    }
  ],
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;name&quot;: &quot;ipm-vpn&quot;,
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;resourceGuid&quot;: &quot;20c26bff-2dad-4a88-8418-06ca4fa257af&quot;,
  &quot;sku&quot;: {
    &quot;capacity&quot;: 2,
    &quot;name&quot;: &quot;VpnGw1AZ&quot;,
    &quot;tier&quot;: &quot;VpnGw1AZ&quot;
  },
  &quot;tags&quot;: null,
  &quot;type&quot;: &quot;Microsoft.Network/virtualNetworkGateways&quot;,
  &quot;vpnClientConfiguration&quot;: {
    &quot;aadAudience&quot;: null,
    &quot;aadIssuer&quot;: null,
    &quot;aadTenant&quot;: null,
    &quot;radiusServerAddress&quot;: null,
    &quot;radiusServerSecret&quot;: null,
    &quot;radiusServers&quot;: [],
    &quot;vpnClientAddressPool&quot;: {
      &quot;addressPrefixes&quot;: [
        &quot;172.16.13.0/24&quot;
      ]
    },
    &quot;vpnClientConnectionHealth&quot;: {
      &quot;totalEgressBytesTransferred&quot;: 0,
      &quot;totalIngressBytesTransferred&quot;: 0,
      &quot;vpnClientConnectionsCount&quot;: 0
    },
    &quot;vpnClientIpsecPolicies&quot;: [],
    &quot;vpnClientProtocols&quot;: [
      &quot;IkeV2&quot;,
      &quot;OpenVPN&quot;
    ],
    &quot;vpnClientRevokedCertificates&quot;: [],
    &quot;vpnClientRootCertificates&quot;: [
      {
        &quot;etag&quot;: &quot;W/\&quot;521ee314-bc40-45ea-9f66-d30ced4626c3\&quot;&quot;,
        &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworkGateways/ipm-vpn/vpnClientRootCertificates/ipm-vpn-root.crt&quot;,
        &quot;name&quot;: &quot;ipm-vpn-root.crt&quot;,
        &quot;provisioningState&quot;: &quot;Succeeded&quot;,
        &quot;publicCertData&quot;: &quot;MIIDBTCCAe2gAwIBAgIUDL+N5H6cQKu6OblCmH+ApF42pz4wDQYJKoZIhvcNAQELBQAwEjEQMA4GA1UEAwwHaXBtLXZwbjAeFw0yMDA5MjcwMzI4NTJaFw0zMDA5MjUwMzI4NTJaMBIxEDAOBgNVBAMMB2lwbS12cG4wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCzguAWVlabxIHEqU1ntj60HHw4K+jwwCNd0thx3Ff75lDI9XGZ0Da0I/JLkB0KfPMNb4EqHQeBZRlF3uLcoMjBrWG3paXkeGgD7wdZ9d7/zktc/PMKRYmQKA1JwkCVQFd+XKz3nM5nffZxNfmF3IKtnNWvCkNO42HWeZDAAlU3ylUaJrrPBR/FhkQaVNUHujiwyl1CMTuEVnBb8dQ5F76N3CXPefn8nWFZRvpHWZq7oyBN18EJK0ySrivE9eA9GFIhWfNs4FE6heveXZ0r7eVY71o5xF+AQQDDn/yp9Tzs/mVExFrmX3l6/VC/xBTvEhOJd8laP1IQT4MxQ7w+lKgzAgMBAAGjUzBRMB0GA1UdDgQWBBQH9gH+kGBq5556lD9irqEcbH9BWjAfBgNVHSMEGDAWgBQH9gH+kGBq5556lD9irqEcbH9BWjAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCX3NG9lTcsl+d2m7yd5F3Xc26Bk+SHAnfsGd7UwdTYKzJt44n7lza2AWKMz+a9zlLBA8Ng3j9b2k/9bM0LR2WvTuLRB4RsUGr45EE7zq74smZosO0yBPIvjZgphBbno8TqYDe2C9sEKtaUpKqA6y0UrSUePn0benIaBkT45lECOs82a0vVtGvuH4hJGiIGObo6cRn6NOKpwAg+JZFkHHQkGksGOyReYolsVPO5FVtfcNbWGaHro1LbNVPLC2s5WVoj1e3K/ERxk6dmfFFNTg/1FVfeoQkv5iN2AL9o1717aYO1Dei7ofsBGL9+OTCUAicprMnzGKJQVeRYlCn2H9Qk&quot;,
        &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
        &quot;type&quot;: &quot;Microsoft.Network/virtualNetworkGateways/vpnClientRootCertificates&quot;
      }
    ]
  },
  &quot;vpnGatewayGeneration&quot;: &quot;Generation1&quot;,
  &quot;vpnType&quot;: &quot;RouteBased&quot;
}
</code></pre>

<h4 id="197-verify-root-data">19.7 - Verify Root Data</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway?view=azure-cli-latest#az_network_vnet_gateway_show">https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway?view=azure-cli-latest#az_network_vnet_gateway_show</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">AZ_UPLOAD_OK=false; while read AZ_VERIFY_CERTIFICATE_NAME; do echo &quot;found ${ARO_VGW_NAME} root certificate name = ${AZ_VERIFY_CERTIFICATE_NAME}&quot;; if [ &quot;${AZ_VERIFY_CERTIFICATE_NAME}&quot; == &quot;${ARO_VGW_PKI_ROOT_CRT_NAME}&quot; ]; then AZ_UPLOAD_OK=true; fi; done &lt;&lt;&lt; &quot;$(az network vnet-gateway show --name ${ARO_VGW_NAME} --resource-group ${ARO_RESOURCE_GROUP_NAME} --query vpnClientConfiguration.vpnClientRootCertificates[].[name] --output tsv)&quot;; if ${AZ_UPLOAD_OK}; then echo &quot;verified ${ARO_VGW_PKI_ROOT_CRT_NAME} exists as a root certificate name for ${ARO_VGW_NAME}&quot;; else echo &quot;failed to verify ${ARO_VGW_PKI_ROOT_CRT_NAME} exists as a root certificate name for ${ARO_VGW_NAME}&quot;; fi
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">found ipm-vpn root certificate name = ipm-vpn-root.crt
verified ipm-vpn-root.crt exists as a root certificate name for ipm-vpn
</code></pre>

<h3 id="20-client-certificates">20 - Client Certificates</h3>
<p>VPN Clients must present an X.509 version 3 certificate when connecting. Each user should have their own bundle of certificate files.</p>
<p>This step outlines a procedure to create them with OpenSSL v1.1.1.  It will need to be re-run for everyone who requires connectivity.</p>
<p>The Azure VPN Gateway supports both IKEv2 (ipsec) and OpenVPN (ssl) client connections.  Various VPN client software support these technologies.  It is most convenient to distribute a PKCS#12 file to the user, so they can connect to the VPN Gateway and access the private Azure Red Hat OpenShift cluster.</p>
<p>In cryptography, PKCS #12 defines an archive file format for storing many cryptography objects as a single file.  PKCS#12 evolved from Microsoft's Personal Information Exchange (PFX) standard and is used to exchange public and private objects.  It is commonly used to bundle a private key with its X.509 certificate or to bundle all the members of a chain of trust.</p>
<p>The terms PKCS #12 (pkcs12) and PFX (pfx) are often used interchangeably.</p>
<p><em>Successful execution of the commands in this step depends upon the previously created VPN Gateway Root Certificate files and exported environment variables.</em></p>
<p>Successful completion of the following steps will produce six (6) files, in this order:</p>
<ul>
<li>VPN Client Key (.key)</li>
<li>VPN Client Certificate Request (.req)</li>
<li>VPN Client Certificate Extensions (.ext)</li>
<li>VPN Client Certificate (.crt)</li>
<li>VPN Client Certificate Serial (.serial)</li>
<li>VPN Client Certificate Bundle (.pfx)</li>
</ul>
<p>The resulting PFX file is should be given to the user.</p>
<h4 id="201-set-vpn-client-environment-variables">20.1 - Set VPN Client Environment Variables</h4>
<p>These environment variables should be exported each time a new set of client certificate files are created.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>These are example values that must be changed for your installation.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">https://www.gnu.org/software/bash/manual/html_node/Environment.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">export ARO_VGW_PKI_CLIENT='example'
export ARO_VGW_PKI_CLIENT_NAME=&quot;${ARO_VGW_NAME}-client-${ARO_VGW_PKI_CLIENT}&quot;
export ARO_VGW_PKI_CLIENT_EXT_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.ext&quot;
export ARO_VGW_PKI_CLIENT_KEY_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.key&quot;
export ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE='!'&quot;${ARO_VGW_PKI_CLIENT}&quot;'!'
export ARO_VGW_PKI_CLIENT_REQ_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.req&quot;
export ARO_VGW_PKI_CLIENT_CRT_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.crt&quot;
export ARO_VGW_PKI_CLIENT_SERIAL_FILE=&quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.serial&quot;
export ARO_VGW_PKI_CLIENT_PFX_FILE='${ARO_VGW_PKI_DIR}/${ARO_VGW_PKI_CLIENT_NAME}.pfx'
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="202-verify-vpn-client-environment-variables">20.2 - Verify VPN Client Environment Variables</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Looping-Constructs.html">https://www.gnu.org/software/bash/manual/html_node/Looping-Constructs.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">ARO_VERIFY_VARIABLES=(ARO_VGW_NAME ARO_VGW_PKI_CLIENT_NAME ARO_VGW_PKI_CLIENT_EXT_FILE ARO_VGW_PKI_CLIENT_KEY_FILE ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE ARO_VGW_PKI_CLIENT_REQ_FILE ARO_VGW_PKI_CLIENT_CRT_FILE ARO_VGW_PKI_CLIENT_SERIAL_FILE ARO_VGW_PKI_CLIENT_PFX_FILE ARO_VGW_PKI_BITS ARO_VGW_PKI_DIR ARO_VGW_PKI_ROOT_KEY_FILE ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE)
for ARO_VERIFY_VARIABLE in ${ARO_VERIFY_VARIABLES[@]}; do if [ &quot;${!ARO_VERIFY_VARIABLE}&quot; == &quot;&quot; ]; then echo &quot;ERROR! Environment Variable ${ARO_VERIFY_VARIABLE} is NOT set&quot;; else echo &quot;${ARO_VERIFY_VARIABLE}=${!ARO_VERIFY_VARIABLE}&quot;; fi; done; unset ARO_VERIFY_VARIABLE
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">ARO_VGW_NAME=ipm-vpn
ARO_VGW_PKI_CLIENT_NAME=ipm-vpn-client-example
ARO_VGW_PKI_CLIENT_EXT_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.ext
ARO_VGW_PKI_CLIENT_KEY_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.key
ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE=!example!
ARO_VGW_PKI_CLIENT_REQ_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.req
ARO_VGW_PKI_CLIENT_CRT_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.crt
ARO_VGW_PKI_CLIENT_SERIAL_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.serial
ARO_VGW_PKI_CLIENT_PFX_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.pfx
ARO_VGW_PKI_BITS=2048
ARO_VGW_PKI_DIR=/home/jtingiris/prj/mit/aei/pki
ARO_VGW_PKI_ROOT_KEY_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.key
ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE=Pk1P4ssphr4s3!!
</code></pre>

<h4 id="203-create-vpn-client-key">20.3 - Create VPN Client Key</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-genrsa.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-genrsa.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl genrsa -aes256 -out &quot;${ARO_VGW_PKI_CLIENT_KEY_FILE}&quot; -passout env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE ${ARO_VGW_PKI_BITS} 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<p>Generating RSA private key, 2048 bit long modulus (2 primes)
.........................................+++++
...........+++++
e is 65537 (0x010001)</p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="204-verify-vpn-client-key">20.4 - Verify VPN Client Key</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl rsa -in &quot;${ARO_VGW_PKI_CLIENT_KEY_FILE}&quot; -noout -passin env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="205-create-client-certificate-request">20.5 - Create Client Certificate Request</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl req -new -out &quot;${ARO_VGW_PKI_CLIENT_REQ_FILE}&quot; -key &quot;${ARO_VGW_PKI_CLIENT_KEY_FILE}&quot; -passin env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE -subj /CN=&quot;${ARO_VGW_PKI_CLIENT_NAME}&quot; 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="206-verify-client-certificate-request">20.6 - Verify Client Certificate Request</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl req -in &quot;${ARO_VGW_PKI_CLIENT_REQ_FILE}&quot; -noout -text 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Certificate Request:
    Data:
        Version: 1 (0x0)
        Subject: CN = ipm-vpn-client-example
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:a8:dd:23:26:4e:ae:34:53:2a:f7:ed:52:b1:52:
                    80:eb:75:0d:76:d5:53:11:f2:f4:e9:a0:1b:2f:da:
                    7a:ee:63:c0:f1:d2:0d:8a:11:2a:7b:4c:11:7b:66:
                    04:3e:2a:2f:57:87:74:12:1e:fa:c8:ef:bb:69:76:
                    9d:a6:e4:8f:30:1f:6f:a3:dd:64:cd:b5:f8:ca:6c:
                    3e:ff:01:93:c8:ff:e4:e1:8a:63:7b:0c:ff:a0:73:
                    d3:60:ad:53:29:46:b8:17:69:3d:17:06:40:b4:44:
                    df:77:fc:7b:44:1e:4c:0e:02:fb:42:4e:a8:ab:55:
                    21:68:d0:45:7d:f3:5f:81:74:9a:8b:28:08:bd:d5:
                    8c:84:42:26:bc:fb:a4:c7:e9:2a:17:f6:b8:b2:2d:
                    44:34:ca:f1:f1:74:dc:16:3f:48:f7:93:3e:fd:21:
                    a4:35:c1:bb:c6:0c:29:a5:6a:a4:ee:34:b4:e2:22:
                    23:c9:fa:63:16:2a:83:72:20:27:38:aa:56:a8:9f:
                    50:37:e8:a2:f8:8c:98:d7:6c:60:44:b7:76:95:65:
                    42:a5:bc:e3:49:bd:74:d2:59:8c:c4:35:eb:bd:ec:
                    86:97:f6:17:ab:76:a3:1a:ab:19:c3:cd:85:74:5a:
                    42:32:ff:2c:51:f3:34:9d:46:3f:97:ad:b8:b0:01:
                    c1:c9
                Exponent: 65537 (0x10001)
        Attributes:
            a0:00
    Signature Algorithm: sha256WithRSAEncryption
         6b:ec:e9:52:ef:76:ad:c6:49:ad:ed:19:83:ab:01:4c:0c:b5:
         b6:3c:e0:47:c4:89:af:79:99:fa:69:c9:32:b0:35:97:99:05:
         c6:ca:60:1d:1a:05:ba:30:9c:b3:8f:f5:8b:a3:ce:c7:af:4c:
         af:98:d0:82:1d:ca:ec:a3:18:f9:05:d1:e7:79:90:5a:77:f1:
         b2:4a:41:a2:43:48:d8:52:c2:4d:8b:f6:0f:26:8c:ef:ad:a7:
         9c:14:49:b9:9f:ec:20:42:33:ea:12:78:0c:e9:98:a1:e7:bb:
         81:b6:44:de:df:f3:63:b8:b6:ac:91:6a:5c:3d:5b:1b:a8:69:
         cf:d7:4e:21:5a:47:91:7f:e9:e1:6b:5b:ef:29:ee:75:dd:55:
         81:ad:df:d7:4c:4c:77:e3:cf:8a:5c:ae:ec:c3:71:fc:b6:ce:
         f7:17:8a:1a:be:7e:a6:2f:85:a0:d5:16:eb:09:5e:7b:09:e9:
         a1:0e:d7:a2:55:a9:98:41:69:65:c3:70:ce:3d:04:ea:95:08:
         39:a3:ff:c5:41:b2:8f:a9:fe:1b:ae:e5:df:0e:61:5f:90:2c:
         35:d2:bb:41:e1:84:7a:54:e0:3d:c7:9d:1e:f5:15:37:a2:a7:
         2a:d7:09:5f:4c:ec:e7:33:c7:34:0e:6b:b3:4f:e1:6e:7d:e3:
         d3:32:40:8d
</code></pre>

<h4 id="207-create-client-certificate-extensions">20.7 - Create Client Certificate Extensions</h4>
<p>A Root Certificate Authority (CA) uses extensions to issue a certificate only for a specific purpose.  Certificate Extensions were introduced in X.509 version 3 (X509v3).</p>
<p>The Azure VPN Gateway requires specific Certificate Extensions on VPN Client certificates.  More specificially, a VPN Client certificate must have the <em>TLS Web Client Authentication</em> (clientAuth) extended key usage (eku) extension.  Additionally, <em>X509v3 Subject Alternative Name</em> (subjectAltName) must always be used per RFC 5280.</p>
<p>This step creates a certificate extension file that OpenSSL will read when creating the certificate, and apply the proper extensions.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc5280">https://tools.ietf.org/html/rfc5280</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">echo &quot;authorityKeyIdentifier=keyid,issuer&quot; &gt; &quot;${ARO_VGW_PKI_CLIENT_EXT_FILE}&quot;
echo &quot;basicConstraints=CA:FALSE&quot; &gt;&gt; &quot;${ARO_VGW_PKI_CLIENT_EXT_FILE}&quot;
echo &quot;extendedKeyUsage=clientAuth&quot; &gt;&gt; &quot;${ARO_VGW_PKI_CLIENT_EXT_FILE}&quot;
echo &quot;subjectAltName=DNS:${ARO_VGW_PKI_CLIENT_NAME}&quot; &gt;&gt; &quot;${ARO_VGW_PKI_CLIENT_EXT_FILE}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<pre><code class="diff">+ success does not produce any output
</code></pre>

<pre><code class="diff">+ success does not produce any output
</code></pre>

<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="208-verify-client-certificate-extensions">20.8 - Verify Client Certificate Extensions</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">grep ^authorityKeyIdentifier=keyid,issuer &quot;${ARO_VGW_PKI_CLIENT_EXT_FILE}&quot; &amp;&amp; grep ^extendedKeyUsage=clientAuth &quot;${ARO_VGW_PKI_CLIENT_EXT_FILE}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">authorityKeyIdentifier=keyid,issuer
extendedKeyUsage=clientAuth
</code></pre>

<h4 id="209-create-client-certificate">20.9 - Create Client Certificate</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl x509 -req -sha256 -in &quot;${ARO_VGW_PKI_CLIENT_REQ_FILE}&quot; -out &quot;${ARO_VGW_PKI_CLIENT_CRT_FILE}&quot; -CAkey &quot;${ARO_VGW_PKI_ROOT_KEY_FILE}&quot; -CA &quot;${ARO_VGW_PKI_ROOT_CRT_FILE}&quot; -passin env:ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE -days 1095 -CAcreateserial -CAserial &quot;${ARO_VGW_PKI_CLIENT_SERIAL_FILE}&quot; 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Signature ok
subject=CN = ipm-vpn-client-example
Getting CA Private Key
</code></pre>

<h4 id="2010-verify-client-certificate">20.10 - Verify Client Certificate</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl x509 -in &quot;${ARO_VGW_PKI_CLIENT_CRT_FILE}&quot; -noout -text 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            24:ac:31:61:b3:c2:b6:a2:51:50:cb:f3:7f:36:c5:7b:fa:f0:77:d3
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN = ipm-vpn
        Validity
            Not Before: Sep 27 03:31:32 2020 GMT
            Not After : Sep 27 03:31:32 2023 GMT
        Subject: CN = ipm-vpn-client-example
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:a8:dd:23:26:4e:ae:34:53:2a:f7:ed:52:b1:52:
                    80:eb:75:0d:76:d5:53:11:f2:f4:e9:a0:1b:2f:da:
                    7a:ee:63:c0:f1:d2:0d:8a:11:2a:7b:4c:11:7b:66:
                    04:3e:2a:2f:57:87:74:12:1e:fa:c8:ef:bb:69:76:
                    9d:a6:e4:8f:30:1f:6f:a3:dd:64:cd:b5:f8:ca:6c:
                    3e:ff:01:93:c8:ff:e4:e1:8a:63:7b:0c:ff:a0:73:
                    d3:60:ad:53:29:46:b8:17:69:3d:17:06:40:b4:44:
                    df:77:fc:7b:44:1e:4c:0e:02:fb:42:4e:a8:ab:55:
                    21:68:d0:45:7d:f3:5f:81:74:9a:8b:28:08:bd:d5:
                    8c:84:42:26:bc:fb:a4:c7:e9:2a:17:f6:b8:b2:2d:
                    44:34:ca:f1:f1:74:dc:16:3f:48:f7:93:3e:fd:21:
                    a4:35:c1:bb:c6:0c:29:a5:6a:a4:ee:34:b4:e2:22:
                    23:c9:fa:63:16:2a:83:72:20:27:38:aa:56:a8:9f:
                    50:37:e8:a2:f8:8c:98:d7:6c:60:44:b7:76:95:65:
                    42:a5:bc:e3:49:bd:74:d2:59:8c:c4:35:eb:bd:ec:
                    86:97:f6:17:ab:76:a3:1a:ab:19:c3:cd:85:74:5a:
                    42:32:ff:2c:51:f3:34:9d:46:3f:97:ad:b8:b0:01:
                    c1:c9
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Authority Key Identifier: 
                keyid:07:F6:01:FE:90:60:6A:E7:9E:7A:94:3F:62:AE:A1:1C:6C:7F:41:5A

            X509v3 Basic Constraints: 
                CA:FALSE
            X509v3 Extended Key Usage: 
                TLS Web Client Authentication
            X509v3 Subject Alternative Name: 
                DNS:ipm-vpn-client-example
    Signature Algorithm: sha256WithRSAEncryption
         5a:8d:83:db:fe:c6:54:a7:9a:db:dc:6e:56:25:6c:79:1c:f0:
         26:55:6c:41:3f:00:86:d8:12:96:6e:d7:0f:f0:67:7e:1f:08:
         7a:f4:f4:0b:07:92:60:3b:df:5d:26:95:1b:b8:5f:18:19:01:
         e0:d1:d7:ed:5f:52:21:33:ef:c3:70:ab:86:34:2a:71:25:8c:
         ae:4c:c9:76:92:a6:c0:f4:c5:06:5f:b7:e1:8c:4a:2d:86:4f:
         a1:79:8d:94:2c:60:e9:a9:ab:69:b4:01:34:0b:99:63:ab:3f:
         57:6c:49:9f:ed:d5:ed:0f:41:d8:af:2b:14:63:ae:b8:16:59:
         93:06:35:b1:43:81:7c:c4:68:d2:08:48:ec:36:19:71:a9:ac:
         c9:c1:70:f5:6d:14:fd:6d:15:e2:d1:fb:86:b6:91:86:e9:3b:
         1e:00:41:16:f3:95:49:98:86:30:7c:64:06:49:d1:27:94:b7:
         5f:64:ce:46:5d:91:16:74:93:d4:c7:9c:ec:0f:a4:2e:32:80:
         43:88:ee:12:33:2c:51:d9:a2:7e:cc:ff:b2:2f:c6:87:30:37:
         89:bc:e7:ee:6b:8a:74:6f:e4:69:60:32:54:b3:ea:03:ef:a3:
         37:ea:57:7f:fc:05:ef:ae:ce:cd:53:ea:4b:f9:95:b4:22:39:
         f5:75:01:d9
</code></pre>

<h4 id="2011-verify-client-moduli">20.11 - Verify Client  Moduli</h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Mismatched moduli will prevent a successful connection to the VPN Gateway.  If the md5sums are different, then do not proceed until they match.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-x509.html</a></li>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-rsa.html</a></li>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-req.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">echo -n &quot;md5sum for ${ARO_VGW_PKI_CLIENT_KEY_FILE} = &quot;; openssl rsa -noout -modulus -in &quot;${ARO_VGW_PKI_CLIENT_KEY_FILE}&quot; -passin env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE | md5sum
echo -n &quot;md5sum for ${ARO_VGW_PKI_CLIENT_CRT_FILE} = &quot;; openssl x509 -noout -modulus -in &quot;${ARO_VGW_PKI_CLIENT_CRT_FILE}&quot; | md5sum
echo -n &quot;md5sum for ${ARO_VGW_PKI_CLIENT_REQ_FILE} = &quot;; openssl req -noout -modulus -in &quot;${ARO_VGW_PKI_CLIENT_REQ_FILE}&quot; | md5sum
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">md5sum for /home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.key = 1ec497f88cbce7449554078dce627bb4  -
md5sum for /home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.crt = 1ec497f88cbce7449554078dce627bb4  -
md5sum for /home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.req = 1ec497f88cbce7449554078dce627bb4  -
</code></pre>

<h4 id="2012-create-vpn-client-pfx">20.12 - Create VPN Client PFX</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-pkcs12.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-pkcs12.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl pkcs12 -in &quot;${ARO_VGW_PKI_CLIENT_CRT_FILE}&quot; -out &quot;${ARO_VGW_PKI_CLIENT_PFX_FILE}&quot; -inkey &quot;${ARO_VGW_PKI_CLIENT_KEY_FILE}&quot; -passin env:ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE -passout pass: -certfile &quot;${ARO_VGW_PKI_ROOT_CRT_FILE}&quot; -export 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<h4 id="2013-verify-vpn-client-pfx">20.13 - Verify VPN Client PFX</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-pkcs12.html">https://www.openssl.org/docs/man1.1.1/man1/openssl-pkcs12.html</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">openssl x509 -in &quot;${ARO_VGW_PKI_CLIENT_PFX_FILE}&quot; -noout -text 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Bag Attributes
    localKeyID: A0 FD 44 81 5B C9 B3 66 B8 F6 3E 4E 76 98 7E 26 32 7A D1 4B 
subject=CN = ipm-vpn-client-example

issuer=CN = ipm-vpn

-----BEGIN CERTIFICATE-----
MIIDJzCCAg+gAwIBAgIUJKwxYbPCtqJRUMvzfzbFe/rwd9MwDQYJKoZIhvcNAQEL
BQAwEjEQMA4GA1UEAwwHaXBtLXZwbjAeFw0yMDA5MjcwMzMxMzJaFw0yMzA5Mjcw
MzMxMzJaMCExHzAdBgNVBAMMFmlwbS12cG4tY2xpZW50LWV4YW1wbGUwggEiMA0G
CSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCo3SMmTq40Uyr37VKxUoDrdQ121VMR
8vTpoBsv2nruY8Dx0g2KESp7TBF7ZgQ+Ki9Xh3QSHvrI77tpdp2m5I8wH2+j3WTN
tfjKbD7/AZPI/+ThimN7DP+gc9NgrVMpRrgXaT0XBkC0RN93/HtEHkwOAvtCTqir
VSFo0EV981+BdJqLKAi91YyEQia8+6TH6SoX9riyLUQ0yvHxdNwWP0j3kz79IaQ1
wbvGDCmlaqTuNLTiIiPJ+mMWKoNyICc4qlaon1A36KL4jJjXbGBEt3aVZUKlvONJ
vXTSWYzENeu97IaX9herdqMaqxnDzYV0WkIy/yxR8zSdRj+XrbiwAcHJAgMBAAGj
ZjBkMB8GA1UdIwQYMBaAFAf2Af6QYGrnnnqUP2KuoRxsf0FaMAkGA1UdEwQCMAAw
EwYDVR0lBAwwCgYIKwYBBQUHAwIwIQYDVR0RBBowGIIWaXBtLXZwbi1jbGllbnQt
ZXhhbXBsZTANBgkqhkiG9w0BAQsFAAOCAQEAWo2D2/7GVKea29xuViVseRzwJlVs
QT8AhtgSlm7XD/Bnfh8IevT0CweSYDvfXSaVG7hfGBkB4NHX7V9SITPvw3CrhjQq
cSWMrkzJdpKmwPTFBl+34YxKLYZPoXmNlCxg6amrabQBNAuZY6s/V2xJn+3V7Q9B
2K8rFGOuuBZZkwY1sUOBfMRo0ghI7DYZcamsycFw9W0U/W0V4tH7hraRhuk7HgBB
FvOVSZiGMHxkBknRJ5S3X2TORl2RFnST1Mec7A+kLjKAQ4juEjMsUdmifsz/si/G
hzA3ibzn7muKdG/kaWAyVLPqA++jN+pXf/wF767OzVPqS/mVtCI59XUB2Q==
-----END CERTIFICATE-----
Bag Attributes: &lt;No Attributes&gt;
subject=CN = ipm-vpn

issuer=CN = ipm-vpn

-----BEGIN CERTIFICATE-----
MIIDBTCCAe2gAwIBAgIUDL+N5H6cQKu6OblCmH+ApF42pz4wDQYJKoZIhvcNAQEL
BQAwEjEQMA4GA1UEAwwHaXBtLXZwbjAeFw0yMDA5MjcwMzI4NTJaFw0zMDA5MjUw
MzI4NTJaMBIxEDAOBgNVBAMMB2lwbS12cG4wggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQCzguAWVlabxIHEqU1ntj60HHw4K+jwwCNd0thx3Ff75lDI9XGZ
0Da0I/JLkB0KfPMNb4EqHQeBZRlF3uLcoMjBrWG3paXkeGgD7wdZ9d7/zktc/PMK
RYmQKA1JwkCVQFd+XKz3nM5nffZxNfmF3IKtnNWvCkNO42HWeZDAAlU3ylUaJrrP
BR/FhkQaVNUHujiwyl1CMTuEVnBb8dQ5F76N3CXPefn8nWFZRvpHWZq7oyBN18EJ
K0ySrivE9eA9GFIhWfNs4FE6heveXZ0r7eVY71o5xF+AQQDDn/yp9Tzs/mVExFrm
X3l6/VC/xBTvEhOJd8laP1IQT4MxQ7w+lKgzAgMBAAGjUzBRMB0GA1UdDgQWBBQH
9gH+kGBq5556lD9irqEcbH9BWjAfBgNVHSMEGDAWgBQH9gH+kGBq5556lD9irqEc
bH9BWjAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCX3NG9lTcs
l+d2m7yd5F3Xc26Bk+SHAnfsGd7UwdTYKzJt44n7lza2AWKMz+a9zlLBA8Ng3j9b
2k/9bM0LR2WvTuLRB4RsUGr45EE7zq74smZosO0yBPIvjZgphBbno8TqYDe2C9sE
KtaUpKqA6y0UrSUePn0benIaBkT45lECOs82a0vVtGvuH4hJGiIGObo6cRn6NOKp
wAg+JZFkHHQkGksGOyReYolsVPO5FVtfcNbWGaHro1LbNVPLC2s5WVoj1e3K/ERx
k6dmfFFNTg/1FVfeoQkv5iN2AL9o1717aYO1Dei7ofsBGL9+OTCUAicprMnzGKJQ
VeRYlCn2H9Qk
-----END CERTIFICATE-----
</code></pre>

<h3 id="21-vpn-client">21 - VPN Client</h3>
<p>Please follow Microsoft's instructions for installing the VPN Client for your operating system.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Commands for using az and wget are given below.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/X.509">https://en.wikipedia.org/wiki/X.509</a></li>
<li><a href="https://en.wikipedia.org/wiki/PKCS_12">https://en.wikipedia.org/wiki/PKCS_12</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-how-to-vpn-client-install-azure-cert">https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-how-to-vpn-client-install-azure-cert</a></li>
<li><a href="https://www.openssl.org/">https://www.openssl.org/</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep -e &quot;ARO.*PKI_CLIENT|ARO_VGW_NAME|ARO_VGW_PKI_BITS|ARO_VGW_PKI_DIR|ARO_VGW_PKI_ROOT_KEY&quot; | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">ARO_KEY=ARO_VGW_PKI_ROOT_KEY_FILE
ARO_VGW_NAME=ipm-vpn
ARO_VGW_PKI_BITS=2048
ARO_VGW_PKI_CLIENT=example
ARO_VGW_PKI_CLIENT_CRT_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.crt
ARO_VGW_PKI_CLIENT_EXT_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.ext
ARO_VGW_PKI_CLIENT_KEY_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.key
ARO_VGW_PKI_CLIENT_KEY_FILE_PASSPHRASE=!example!
ARO_VGW_PKI_CLIENT_NAME=ipm-vpn-client-example
ARO_VGW_PKI_CLIENT_PFX_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.pfx
ARO_VGW_PKI_CLIENT_REQ_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.req
ARO_VGW_PKI_CLIENT_SERIAL_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-client-example.serial
ARO_VGW_PKI_DIR=/home/jtingiris/prj/mit/aei/pki
ARO_VGW_PKI_ROOT_KEY_FILE=/home/jtingiris/prj/mit/aei/pki/ipm-vpn-root.key
ARO_VGW_PKI_ROOT_KEY_FILE_PASSPHRASE=Pk1P4ssphr4s3!!
ARO_VGW_PKI_ROOT_KEY_NAME=ipm-vpn-root.key
</code></pre>

<h4 id="211-verify-vpn-client-url">21.1 - Verify VPN Client URL</h4>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway/vpn-client?view=azure-cli-latest#az_network_vnet_gateway_vpn_client_generate">https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway/vpn-client?view=azure-cli-latest#az_network_vnet_gateway_vpn_client_generate</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">export ARO_VGW_CONFIGURATION_URL=$(az network vnet-gateway vpn-client generate -g ${ARO_RESOURCE_GROUP_NAME} -n ${ARO_VGW_NAME} --processor-architecture Amd64)
echo &quot;ARO_VGW_CONFIGURATION_URL=${ARO_VGW_CONFIGURATION_URL}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="diff">+ success does not produce any output
</code></pre>

<pre><code class="bash">ARO_VGW_CONFIGURATION_URL=&quot;https://nfvprodsuppbl.blob.core.windows.net/vpnprofileimmutable/cf9d0077-d7e7-4c7f-aae7-7f15cc7d58d8/vpnprofile/c55a6b34-3e2f-4747-b19f-6c8ff8c5d22a/vpnclientconfiguration.zip?sv=2018-03-28&amp;sr=b&amp;sig=lt%2FYNiNekY3VCic3qMxtz772%2FyX30OuSiUD0NBZewU0%3D&amp;st=2020-09-27T03%3A26%3A39Z&amp;se=2020-09-27T04%3A26%3A39Z&amp;sp=r&amp;fileExtension=.zip&quot;
</code></pre>

<h4 id="212-download-vpn-client">21.2 - Download VPN Client</h4>
<p>The necessary VPN Client Configuration files may be downloaded via the Azure porta or with the following commands.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway/vpn-client?view=azure-cli-latest#az_network_vnet_gateway_vpn_client_generate">https://docs.microsoft.com/en-us/cli/azure/network/vnet-gateway/vpn-client?view=azure-cli-latest#az_network_vnet_gateway_vpn_client_generate</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">eval wget &quot;${ARO_VGW_CONFIGURATION_URL}&quot; -O &quot;${ARO_VGW_PKI_DIR}/${ARO_VGW_NAME}.zip&quot; 2&gt;&amp;1
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">--2020-09-26 23:31:47--  https://nfvprodsuppbl.blob.core.windows.net/vpnprofileimmutable/cf9d0077-d7e7-4c7f-aae7-7f15cc7d58d8/vpnprofile/c55a6b34-3e2f-4747-b19f-6c8ff8c5d22a/vpnclientconfiguration.zip?sv=2018-03-28&amp;sr=b&amp;sig=lt%2FYNiNekY3VCic3qMxtz772%2FyX30OuSiUD0NBZewU0%3D&amp;st=2020-09-27T03%3A26%3A39Z&amp;se=2020-09-27T04%3A26%3A39Z&amp;sp=r&amp;fileExtension=.zip
Resolving nfvprodsuppbl.blob.core.windows.net (nfvprodsuppbl.blob.core.windows.net)... 52.239.153.36
Connecting to nfvprodsuppbl.blob.core.windows.net (nfvprodsuppbl.blob.core.windows.net)|52.239.153.36|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 303372 (296K) [application/octet-stream]
Saving to: ‘/home/jtingiris/prj/mit/aei/pki/ipm-vpn.zip’

     0K .......... .......... .......... .......... .......... 16% 1.01M 0s
    50K .......... .......... .......... .......... .......... 33% 1.90M 0s
   100K .......... .......... .......... .......... .......... 50% 92.1M 0s
   150K .......... .......... .......... .......... .......... 67% 1.95M 0s
   200K .......... .......... .......... .......... .......... 84% 50.7M 0s
   250K .......... .......... .......... .......... ......    100% 16.2M=0.1s

2020-09-26 23:31:47 (2.80 MB/s) - ‘/home/jtingiris/prj/mit/aei/pki/ipm-vpn.zip’ saved [303372/303372]

</code></pre>

<h4 id="213-distribute-vpn-client-pfx">21.3 - Distribute VPN Client &amp; PFX</h4>
<h3 id="22-obtain-pull-secrets">22 - Obtain Pull Secrets</h3>
<p>Pull secrets are required when referencing images across OpenShift Container Platform projects or from secured registries.</p>
<h4 id="221-obtain-red-hat-pull-secret">22.1 - Obtain Red Hat Pull Secret</h4>
<p>A Red Hat pull secret enables access to Red Hat container registries that contain additional OpenShift content.</p>
<p>To obtain a Red Hat pull secret, go to the Red Hat OpenShift cluster manager portal:</p>
<ul>
<li><a href="https://cloud.redhat.com/openshift/install/azure/aro-provisioned">https://cloud.redhat.com/openshift/install/azure/aro-provisioned</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong><em>This step must be done manually, via a web browser.</em></strong>  It is optional though recommended.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure to update ${ARO_REDHAT_PULL_SECRET_FILE} with the path where the pull secret was saved.</p>
</div>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://access.redhat.com/solutions/4844461">https://access.redhat.com/solutions/4844461</a></li>
</ul>
<h4 id="222-verify-red-hat-pull-secret">22.2 - Verify Red Hat Pull Secret</h4>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">ls -ld &quot;${ARO_REDHAT_PULL_SECRET_FILE}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">-rw-rw----. 1 jtingiris mit 2835 Sep 12 10:26 /home/jtingiris/prj/mit/aei/secrets/ipm-redhat-pull-secret.txt
</code></pre>

<h3 id="23-azure-red-hat-openshift">23 - Azure Red Hat OpenShift</h3>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://azure.microsoft.com/en-us/services/openshift/">https://azure.microsoft.com/en-us/services/openshift/</a></li>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest">https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">env | egrep -e 'ARO_CLUSTER|ARO_REDHAT_PULL_SECRET_FILE|ARO_RESOURCE_GROUP_NAME|ARO_VNET_NAME|ARO_SUBNET_MASTER_NAME|ARO_SUBNET_WORKER_NAME' | sort -V
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">ARO_CLUSTER_DOMAIN_NAME=ipm.mitaei.net
ARO_CLUSTER_NAME=ipm-cluster
ARO_CLUSTER_VISIBILITY_API=Private
ARO_CLUSTER_VISIBILITY_INGRESS=Private
ARO_CLUSTER_VM_MASTER_SIZE=Standard_D8s_v3
ARO_CLUSTER_VM_WORKER_COUNT=3
ARO_CLUSTER_VM_WORKER_DISK_GB=128
ARO_CLUSTER_VM_WORKER_SIZE=Standard_D8s_v3
ARO_REDHAT_PULL_SECRET_FILE=/home/jtingiris/prj/mit/aei/secrets/ipm-redhat-pull-secret.txt
ARO_RESOURCE_GROUP_NAME=ipm-eastus
ARO_SUBNET_MASTER_NAME=ipm-vnet-master-subnet
ARO_SUBNET_WORKER_NAME=ipm-vnet-worker-subnet
ARO_VNET_NAME=ipm-vnet
</code></pre>

<h4 id="231-create-aro-cluster">23.1 - Create ARO Cluster</h4>
<p>This can take up to an hour.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest#az_aro_create">https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest#az_aro_create</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/installing/installing_azure/installing-azure-network-customizations.html#modifying-nwoperator-config-startup_installing-azure-network-customizations">https://docs.openshift.com/container-platform/4.4/installing/installing_azure/installing-azure-network-customizations.html#modifying-nwoperator-config-startup_installing-azure-network-customizations</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az aro create --resource-group &quot;${ARO_RESOURCE_GROUP_NAME}&quot; --name &quot;${ARO_CLUSTER_NAME}&quot; --master-subnet &quot;${ARO_SUBNET_MASTER_NAME}&quot; --master-vm-size &quot;${ARO_CLUSTER_VM_MASTER_SIZE}&quot; --worker-subnet &quot;${ARO_SUBNET_WORKER_NAME}&quot; --worker-count ${ARO_CLUSTER_VM_WORKER_COUNT} --worker-vm-size &quot;${ARO_CLUSTER_VM_WORKER_SIZE}&quot; --worker-vm-disk-size-gb ${ARO_CLUSTER_VM_WORKER_DISK_GB} --apiserver-visibility &quot;${ARO_CLUSTER_VISIBILITY_INGRESS}&quot; --ingress-visibility &quot;${ARO_CLUSTER_VISIBILITY_API}&quot; --pod-cidr &quot;${ARO_SUBNET_POD_CIDR}&quot; --service-cidr &quot;${ARO_SUBNET_SERVICE_CIDR}&quot; --vnet &quot;${ARO_VNET_NAME}&quot; --pull-secret @&quot;${ARO_REDHAT_PULL_SECRET_FILE}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="json">{
  &quot;apiserverProfile&quot;: {
    &quot;ip&quot;: &quot;10.10.0.4&quot;,
    &quot;url&quot;: &quot;https://api.my4zz953.eastus.aroapp.io:6443/&quot;,
    &quot;visibility&quot;: &quot;Private&quot;
  },
  &quot;clusterProfile&quot;: {
    &quot;domain&quot;: &quot;my4zz953&quot;,
    &quot;pullSecret&quot;: null,
    &quot;resourceGroupId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/aro-my4zz953&quot;,
    &quot;version&quot;: &quot;4.4.17&quot;
  },
  &quot;consoleProfile&quot;: {
    &quot;url&quot;: &quot;https://console-openshift-console.apps.my4zz953.eastus.aroapp.io/&quot;
  },
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.RedHatOpenShift/openShiftClusters/ipm-cluster&quot;,
  &quot;ingressProfiles&quot;: [
    {
      &quot;ip&quot;: &quot;10.10.2.4&quot;,
      &quot;name&quot;: &quot;default&quot;,
      &quot;visibility&quot;: &quot;Private&quot;
    }
  ],
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;masterProfile&quot;: {
    &quot;subnetId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-master-subnet&quot;,
    &quot;vmSize&quot;: &quot;Standard_D8s_v3&quot;
  },
  &quot;name&quot;: &quot;ipm-cluster&quot;,
  &quot;networkProfile&quot;: {
    &quot;podCidr&quot;: &quot;10.12.0.0/14&quot;,
    &quot;serviceCidr&quot;: &quot;10.11.0.0/16&quot;
  },
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;servicePrincipalProfile&quot;: {
    &quot;clientId&quot;: &quot;de8651b4-5479-47c4-8be4-0081ee8ae5d6&quot;,
    &quot;clientSecret&quot;: null
  },
  &quot;tags&quot;: null,
  &quot;type&quot;: &quot;Microsoft.RedHatOpenShift/openShiftClusters&quot;,
  &quot;workerProfiles&quot;: [
    {
      &quot;count&quot;: 1,
      &quot;diskSizeGb&quot;: 128,
      &quot;name&quot;: &quot;ipm-cluster-rvdxb-worker-eastus1&quot;,
      &quot;subnetId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-worker-subnet&quot;,
      &quot;vmSize&quot;: &quot;Standard_D8s_v3&quot;
    },
    {
      &quot;count&quot;: 1,
      &quot;diskSizeGb&quot;: 128,
      &quot;name&quot;: &quot;ipm-cluster-rvdxb-worker-eastus2&quot;,
      &quot;subnetId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-worker-subnet&quot;,
      &quot;vmSize&quot;: &quot;Standard_D8s_v3&quot;
    },
    {
      &quot;count&quot;: 1,
      &quot;diskSizeGb&quot;: 128,
      &quot;name&quot;: &quot;ipm-cluster-rvdxb-worker-eastus3&quot;,
      &quot;subnetId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-worker-subnet&quot;,
      &quot;vmSize&quot;: &quot;Standard_D8s_v3&quot;
    }
  ]
}
</code></pre>

<h4 id="232-verify-aro-cluster">23.2 - Verify ARO Cluster</h4>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">az aro show --name &quot;${ARO_CLUSTER_NAME}&quot; --resource-group &quot;${ARO_RESOURCE_GROUP_NAME}&quot; --query consoleProfile.url --output tsv
az aro show --name &quot;${ARO_CLUSTER_NAME}&quot; --resource-group &quot;${ARO_RESOURCE_GROUP_NAME}&quot;
az aro list-credentials --name &quot;${ARO_CLUSTER_NAME}&quot; --resource-group &quot;${ARO_RESOURCE_GROUP_NAME}&quot;
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">https://console-openshift-console.apps.my4zz953.eastus.aroapp.io/
</code></pre>

<pre><code class="json">{
  &quot;apiserverProfile&quot;: {
    &quot;ip&quot;: &quot;10.10.0.4&quot;,
    &quot;url&quot;: &quot;https://api.my4zz953.eastus.aroapp.io:6443/&quot;,
    &quot;visibility&quot;: &quot;Private&quot;
  },
  &quot;clusterProfile&quot;: {
    &quot;domain&quot;: &quot;my4zz953&quot;,
    &quot;pullSecret&quot;: null,
    &quot;resourceGroupId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/aro-my4zz953&quot;,
    &quot;version&quot;: &quot;4.4.17&quot;
  },
  &quot;consoleProfile&quot;: {
    &quot;url&quot;: &quot;https://console-openshift-console.apps.my4zz953.eastus.aroapp.io/&quot;
  },
  &quot;id&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.RedHatOpenShift/openShiftClusters/ipm-cluster&quot;,
  &quot;ingressProfiles&quot;: [
    {
      &quot;ip&quot;: &quot;10.10.2.4&quot;,
      &quot;name&quot;: &quot;default&quot;,
      &quot;visibility&quot;: &quot;Private&quot;
    }
  ],
  &quot;location&quot;: &quot;eastus&quot;,
  &quot;masterProfile&quot;: {
    &quot;subnetId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-master-subnet&quot;,
    &quot;vmSize&quot;: &quot;Standard_D8s_v3&quot;
  },
  &quot;name&quot;: &quot;ipm-cluster&quot;,
  &quot;networkProfile&quot;: {
    &quot;podCidr&quot;: &quot;10.12.0.0/14&quot;,
    &quot;serviceCidr&quot;: &quot;10.11.0.0/16&quot;
  },
  &quot;provisioningState&quot;: &quot;Succeeded&quot;,
  &quot;resourceGroup&quot;: &quot;ipm-eastus&quot;,
  &quot;servicePrincipalProfile&quot;: {
    &quot;clientId&quot;: &quot;de8651b4-5479-47c4-8be4-0081ee8ae5d6&quot;,
    &quot;clientSecret&quot;: null
  },
  &quot;tags&quot;: null,
  &quot;type&quot;: &quot;Microsoft.RedHatOpenShift/openShiftClusters&quot;,
  &quot;workerProfiles&quot;: [
    {
      &quot;count&quot;: 1,
      &quot;diskSizeGb&quot;: 128,
      &quot;name&quot;: &quot;ipm-cluster-rvdxb-worker-eastus1&quot;,
      &quot;subnetId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-worker-subnet&quot;,
      &quot;vmSize&quot;: &quot;Standard_D8s_v3&quot;
    },
    {
      &quot;count&quot;: 1,
      &quot;diskSizeGb&quot;: 128,
      &quot;name&quot;: &quot;ipm-cluster-rvdxb-worker-eastus2&quot;,
      &quot;subnetId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-worker-subnet&quot;,
      &quot;vmSize&quot;: &quot;Standard_D8s_v3&quot;
    },
    {
      &quot;count&quot;: 1,
      &quot;diskSizeGb&quot;: 128,
      &quot;name&quot;: &quot;ipm-cluster-rvdxb-worker-eastus3&quot;,
      &quot;subnetId&quot;: &quot;/subscriptions/12c7070f-83e5-453b-96d0-90770d2cf942/resourceGroups/ipm-eastus/providers/Microsoft.Network/virtualNetworks/ipm-vnet/subnets/ipm-vnet-worker-subnet&quot;,
      &quot;vmSize&quot;: &quot;Standard_D8s_v3&quot;
    }
  ]
}
{
  &quot;kubeadminPassword&quot;: &quot;TSx2J-LY56j-KznE7-SzIU3&quot;,
  &quot;kubeadminUsername&quot;: &quot;kubeadmin&quot;
}
</code></pre>

<h3 id="24-openshift-cli">24 - OpenShift CLI</h3>
<p>The OpenShift CLI client <code>oc</code> simplifies working with Kubernetes and OpenShift clusters, offering a number of advantages over <code>kubectl</code> such as easy login, kube config file management, and access to developer tools. The <code>kubectl</code> binary is included for when strict Kubernetes compliance is necessary.</p>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest#az_aro_list_credentials">https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest#az_aro_list_credentials</a></li>
<li><a href="https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest#az_aro_show">https://docs.microsoft.com/en-us/cli/azure/aro?view=azure-cli-latest#az_aro_show</a></li>
<li><a href="https://cloud.redhat.com/openshift/install/azure/installer-provisioned">https://cloud.redhat.com/openshift/install/azure/installer-provisioned</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/cli_reference/openshift_cli/getting-started-cli.html">https://docs.openshift.com/container-platform/4.4/cli_reference/openshift_cli/getting-started-cli.html</a></li>
</ul>
<h4 id="241-install-openshift-cli">24.1 - Install OpenShift CLI</h4>
<p>Download the latest archive for Azure Red Hat OpenShift from here:</p>
<p><a href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz">https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz</a></p>
<p>After extracting the archive, move the <code>oc</code> and <code>kubectl</code> binaries to a location in the PATH, such as <code>/usr/local/bin</code>.</p>
<p>To start a session with the OpenShift cluster, login.</p>
<pre><code>oc login [API_URL]
</code></pre>
<p><strong><em>Reference(s):</em></strong></p>
<ul>
<li><a href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz">https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz</a></li>
</ul>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">wget -q https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz -O /tmp/openshift-client-linux.tar.gz 2&gt;&amp;1
cd /tmp
tar zxvf openshift-client-linux.tar.gz
mv -f oc /usr/local/bin
mv -f kubectl /usr/local/in
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">README.md
oc
kubectl
</code></pre>

<h4 id="242-verify-openshift-cli">24.2 - Verify OpenShift CLI</h4>
<p>missing './help/Verify OpenShift CLI.md'</p>
<p><strong><em>Command(s):</em></strong></p>
<pre><code class="bash">oc version
kubectl version
</code></pre>

<p><strong><em>Example Output:</em></strong></p>
<pre><code class="bash">Client Version: 4.5.11
Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;18&quot;, GitVersion:&quot;v1.18.2-0-g52c56ce&quot;, GitCommit:&quot;d7f3ccf9a5bdc96ba92e31526cf014b3de4c46aa&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2020-09-11T23:48:53Z&quot;, GoVersion:&quot;go1.13.4&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
</code></pre>

<h3 id="25-openshift-authentication">25 - OpenShift Authentication</h3>
<p>missing './help/OpenShift Authentication.md'</p>
<p>TODO</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>&copy; 2020 Mastech InfoTrellis</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
